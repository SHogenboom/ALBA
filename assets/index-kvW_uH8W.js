var yo=Object.defineProperty;var vo=(i,t,r)=>t in i?yo(i,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[t]=r;var x=(i,t,r)=>(vo(i,typeof t!="symbol"?t+"":t,r),r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))u(d);new MutationObserver(d=>{for(const p of d)if(p.type==="childList")for(const M of p.addedNodes)M.tagName==="LINK"&&M.rel==="modulepreload"&&u(M)}).observe(document,{childList:!0,subtree:!0});function r(d){const p={};return d.integrity&&(p.integrity=d.integrity),d.referrerPolicy&&(p.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?p.credentials="include":d.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function u(d){if(d.ep)return;d.ep=!0;const p=r(d);fetch(d.href,p)}})();var Vo=Object.defineProperty,o=(i,t)=>Vo(i,"name",{value:t,configurable:!0}),xo=(()=>{for(var i=new Uint8Array(128),t=0;t<64;t++)i[t<26?t+65:t<52?t+71:t<62?t-4:t*4-205]=t;return r=>{for(var u=r.length,d=new Uint8Array((u-(r[u-1]=="=")-(r[u-2]=="="))*3/4|0),p=0,M=0;p<u;){var C=i[r.charCodeAt(p++)],N=i[r.charCodeAt(p++)],v=i[r.charCodeAt(p++)],W=i[r.charCodeAt(p++)];d[M++]=C<<2|N>>4,d[M++]=N<<4|v>>2,d[M++]=v<<6|W}return d}})();function Qt(i){return i*Math.PI/180}o(Qt,"deg2rad");function He(i){return i*180/Math.PI}o(He,"rad2deg");function _t(i,t,r){return t>r?_t(i,r,t):Math.min(Math.max(i,t),r)}o(_t,"clamp");function te(i,t,r){if(typeof i=="number"&&typeof t=="number")return i+(t-i)*r;if(i instanceof E&&t instanceof E||i instanceof ot&&t instanceof ot)return i.lerp(t,r);throw new Error(`Bad value for lerp(): ${i}, ${t}. Only number, Vec2 and Color is supported.`)}o(te,"lerp");function oe(i,t,r,u,d){return u+(i-t)/(r-t)*(d-u)}o(oe,"map");function En(i,t,r,u,d){return _t(oe(i,t,r,u,d),u,d)}o(En,"mapc");var ft,E=(ft=class{constructor(t=0,r=t){x(this,"x",0);x(this,"y",0);this.x=t,this.y=r}static fromAngle(t){let r=Qt(t);return new ft(Math.cos(r),Math.sin(r))}clone(){return new ft(this.x,this.y)}add(...t){let r=P(...t);return new ft(this.x+r.x,this.y+r.y)}sub(...t){let r=P(...t);return new ft(this.x-r.x,this.y-r.y)}scale(...t){let r=P(...t);return new ft(this.x*r.x,this.y*r.y)}dist(...t){let r=P(...t);return this.sub(r).len()}sdist(...t){let r=P(...t);return this.sub(r).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let t=this.len();return t===0?new ft(0):this.scale(1/t)}normal(){return new ft(this.y,-this.x)}reflect(t){return this.sub(t.scale(2*this.dot(t)))}project(t){return t.scale(t.dot(this)/t.len())}reject(t){return this.sub(this.project(t))}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}angle(...t){let r=P(...t);return He(Math.atan2(this.y-r.y,this.x-r.x))}angleBetween(...t){let r=P(...t);return He(Math.atan2(this.cross(r),this.dot(r)))}lerp(t,r){return new ft(te(this.x,t.x,r),te(this.y,t.y,r))}slerp(t,r){let u=this.dot(t),d=this.cross(t),p=Math.atan2(d,u);return this.scale(Math.sin((1-r)*p)).add(t.scale(Math.sin(r*p))).scale(1/d)}isZero(){return this.x===0&&this.y===0}toFixed(t){return new ft(Number(this.x.toFixed(t)),Number(this.y.toFixed(t)))}transform(t){return t.multVec2(this)}eq(t){return this.x===t.x&&this.y===t.y}bbox(){return new Tt(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}},o(ft,"Vec2"),x(ft,"LEFT",new ft(-1,0)),x(ft,"RIGHT",new ft(1,0)),x(ft,"UP",new ft(0,-1)),x(ft,"DOWN",new ft(0,1)),ft);function P(...i){if(i.length===1){if(i[0]instanceof E)return new E(i[0].x,i[0].y);if(Array.isArray(i[0])&&i[0].length===2)return new E(...i[0])}return new E(...i)}o(P,"vec2");var $,ot=($=class{constructor(t,r,u){x(this,"r",255);x(this,"g",255);x(this,"b",255);this.r=_t(t,0,255),this.g=_t(r,0,255),this.b=_t(u,0,255)}static fromArray(t){return new $(t[0],t[1],t[2])}static fromHex(t){if(typeof t=="number")return new $(t>>16&255,t>>8&255,t>>0&255);if(typeof t=="string"){let r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return new $(parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(t,r,u){if(r==0)return new $(255*u,255*u,255*u);let d=o((W,S,K)=>(K<0&&(K+=1),K>1&&(K-=1),K<1/6?W+(S-W)*6*K:K<1/2?S:K<2/3?W+(S-W)*(2/3-K)*6:W),"hue2rgb"),p=u<.5?u*(1+r):u+r-u*r,M=2*u-p,C=d(M,p,t+1/3),N=d(M,p,t),v=d(M,p,t-1/3);return new $(Math.round(C*255),Math.round(N*255),Math.round(v*255))}clone(){return new $(this.r,this.g,this.b)}lighten(t){return new $(this.r+t,this.g+t,this.b+t)}darken(t){return this.lighten(-t)}invert(){return new $(255-this.r,255-this.g,255-this.b)}mult(t){return new $(this.r*t.r/255,this.g*t.g/255,this.b*t.b/255)}lerp(t,r){return new $(te(this.r,t.r,r),te(this.g,t.g,r),te(this.b,t.b,r))}toHSL(){let t=this.r/255,r=this.g/255,u=this.b/255,d=Math.max(t,r,u),p=Math.min(t,r,u),M=(d+p)/2,C=M,N=M;if(d==p)M=C=0;else{let v=d-p;switch(C=N>.5?v/(2-d-p):v/(d+p),d){case t:M=(r-u)/v+(r<u?6:0);break;case r:M=(u-t)/v+2;break;case u:M=(t-r)/v+4;break}M/=6}return[M,C,N]}eq(t){return this.r===t.r&&this.g===t.g&&this.b===t.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}},o($,"Color"),x($,"RED",new $(255,0,0)),x($,"GREEN",new $(0,255,0)),x($,"BLUE",new $(0,0,255)),x($,"YELLOW",new $(255,255,0)),x($,"MAGENTA",new $(255,0,255)),x($,"CYAN",new $(0,255,255)),x($,"WHITE",new $(255,255,255)),x($,"BLACK",new $(0,0,0)),$);function et(...i){if(i.length===0)return new ot(255,255,255);if(i.length===1){if(i[0]instanceof ot)return i[0].clone();if(typeof i[0]=="string")return ot.fromHex(i[0]);if(Array.isArray(i[0])&&i[0].length===3)return ot.fromArray(i[0])}return new ot(...i)}o(et,"rgb");var bo=o((i,t,r)=>ot.fromHSL(i,t,r),"hsl2rgb"),Ae,Et=(Ae=class{constructor(t,r,u,d){x(this,"x",0);x(this,"y",0);x(this,"w",1);x(this,"h",1);this.x=t,this.y=r,this.w=u,this.h=d}scale(t){return new Ae(this.x+this.w*t.x,this.y+this.h*t.y,this.w*t.w,this.h*t.h)}pos(){return new E(this.x,this.y)}clone(){return new Ae(this.x,this.y,this.w,this.h)}eq(t){return this.x===t.x&&this.y===t.y&&this.w===t.w&&this.h===t.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}},o(Ae,"Quad"),Ae);function wt(i,t,r,u){return new Et(i,t,r,u)}o(wt,"quad");var Dt,Kt=(Dt=class{constructor(t){x(this,"m",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);t&&(this.m=t)}static translate(t){return new Dt([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,0,1])}static scale(t){return new Dt([t.x,0,0,0,0,t.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(t){t=Qt(-t);let r=Math.cos(t),u=Math.sin(t);return new Dt([1,0,0,0,0,r,-u,0,0,u,r,0,0,0,0,1])}static rotateY(t){t=Qt(-t);let r=Math.cos(t),u=Math.sin(t);return new Dt([r,0,u,0,0,1,0,0,-u,0,r,0,0,0,0,1])}static rotateZ(t){t=Qt(-t);let r=Math.cos(t),u=Math.sin(t);return new Dt([r,-u,0,0,u,r,0,0,0,0,1,0,0,0,0,1])}translate(t){return this.m[12]+=this.m[0]*t.x+this.m[4]*t.y,this.m[13]+=this.m[1]*t.x+this.m[5]*t.y,this.m[14]+=this.m[2]*t.x+this.m[6]*t.y,this.m[15]+=this.m[3]*t.x+this.m[7]*t.y,this}scale(t){return this.m[0]*=t.x,this.m[4]*=t.y,this.m[1]*=t.x,this.m[5]*=t.y,this.m[2]*=t.x,this.m[6]*=t.y,this.m[3]*=t.x,this.m[7]*=t.y,this}rotate(t){t=Qt(-t);let r=Math.cos(t),u=Math.sin(t),d=this.m[0],p=this.m[1],M=this.m[4],C=this.m[5];return this.m[0]=d*r+p*u,this.m[1]=-d*u+p*r,this.m[4]=M*r+C*u,this.m[5]=-M*u+C*r,this}mult(t){let r=[];for(let u=0;u<4;u++)for(let d=0;d<4;d++)r[u*4+d]=this.m[0*4+d]*t.m[u*4+0]+this.m[1*4+d]*t.m[u*4+1]+this.m[2*4+d]*t.m[u*4+2]+this.m[3*4+d]*t.m[u*4+3];return new Dt(r)}multVec2(t){return new E(t.x*this.m[0]+t.y*this.m[4]+this.m[12],t.x*this.m[1]+t.y*this.m[5]+this.m[13])}getTranslation(){return new E(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],r=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new E(r,t/r)}else if(this.m[4]!=0||this.m[5]!=0){let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],r=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new E(t/r,r)}else return new E(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return He(this.m[1]>0?Math.acos(this.m[0]/t):-Math.acos(this.m[0]/t))}else if(this.m[4]!=0||this.m[5]!=0){let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return He(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/t):-Math.acos(this.m[4]/t)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new E(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t),0)}else if(this.m[4]!=0||this.m[5]!=0){let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new E(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t))}else return new E(0,0)}invert(){let t=[],r=this.m[10]*this.m[15]-this.m[14]*this.m[11],u=this.m[9]*this.m[15]-this.m[13]*this.m[11],d=this.m[9]*this.m[14]-this.m[13]*this.m[10],p=this.m[8]*this.m[15]-this.m[12]*this.m[11],M=this.m[8]*this.m[14]-this.m[12]*this.m[10],C=this.m[8]*this.m[13]-this.m[12]*this.m[9],N=this.m[6]*this.m[15]-this.m[14]*this.m[7],v=this.m[5]*this.m[15]-this.m[13]*this.m[7],W=this.m[5]*this.m[14]-this.m[13]*this.m[6],S=this.m[4]*this.m[15]-this.m[12]*this.m[7],K=this.m[4]*this.m[14]-this.m[12]*this.m[6],V=this.m[5]*this.m[15]-this.m[13]*this.m[7],H=this.m[4]*this.m[13]-this.m[12]*this.m[5],_=this.m[6]*this.m[11]-this.m[10]*this.m[7],j=this.m[5]*this.m[11]-this.m[9]*this.m[7],O=this.m[5]*this.m[10]-this.m[9]*this.m[6],tt=this.m[4]*this.m[11]-this.m[8]*this.m[7],R=this.m[4]*this.m[10]-this.m[8]*this.m[6],St=this.m[4]*this.m[9]-this.m[8]*this.m[5];t[0]=this.m[5]*r-this.m[6]*u+this.m[7]*d,t[4]=-(this.m[4]*r-this.m[6]*p+this.m[7]*M),t[8]=this.m[4]*u-this.m[5]*p+this.m[7]*C,t[12]=-(this.m[4]*d-this.m[5]*M+this.m[6]*C),t[1]=-(this.m[1]*r-this.m[2]*u+this.m[3]*d),t[5]=this.m[0]*r-this.m[2]*p+this.m[3]*M,t[9]=-(this.m[0]*u-this.m[1]*p+this.m[3]*C),t[13]=this.m[0]*d-this.m[1]*M+this.m[2]*C,t[2]=this.m[1]*N-this.m[2]*v+this.m[3]*W,t[6]=-(this.m[0]*N-this.m[2]*S+this.m[3]*K),t[10]=this.m[0]*V-this.m[1]*S+this.m[3]*H,t[14]=-(this.m[0]*W-this.m[1]*K+this.m[2]*H),t[3]=-(this.m[1]*_-this.m[2]*j+this.m[3]*O),t[7]=this.m[0]*_-this.m[2]*tt+this.m[3]*R,t[11]=-(this.m[0]*j-this.m[1]*tt+this.m[3]*St),t[15]=this.m[0]*O-this.m[1]*R+this.m[2]*St;let F=this.m[0]*t[0]+this.m[1]*t[4]+this.m[2]*t[8]+this.m[3]*t[12];for(let mt=0;mt<4;mt++)for(let ht=0;ht<4;ht++)t[mt*4+ht]*=1/F;return new Dt(t)}clone(){return new Dt([...this.m])}toString(){return this.m.toString()}},o(Dt,"Mat4"),Dt);function Lr(i,t,r,u=d=>-Math.cos(d)){return i+(u(r)+1)/2*(t-i)}o(Lr,"wave");var Eo=1103515245,So=12345,un=2147483648,bi,Sn=(bi=class{constructor(t){x(this,"seed");this.seed=t}gen(){return this.seed=(Eo*this.seed+So)%un,this.seed/un}genNumber(t,r){return t+this.gen()*(r-t)}genVec2(t,r){return new E(this.genNumber(t.x,r.x),this.genNumber(t.y,r.y))}genColor(t,r){return new ot(this.genNumber(t.r,r.r),this.genNumber(t.g,r.g),this.genNumber(t.b,r.b))}genAny(...t){if(t.length===0)return this.gen();if(t.length===1){if(typeof t[0]=="number")return this.genNumber(0,t[0]);if(t[0]instanceof E)return this.genVec2(P(0,0),t[0]);if(t[0]instanceof ot)return this.genColor(et(0,0,0),t[0])}else if(t.length===2){if(typeof t[0]=="number"&&typeof t[1]=="number")return this.genNumber(t[0],t[1]);if(t[0]instanceof E&&t[1]instanceof E)return this.genVec2(t[0],t[1]);if(t[0]instanceof ot&&t[1]instanceof ot)return this.genColor(t[0],t[1])}}},o(bi,"RNG"),bi),Gr=new Sn(Date.now());function Rn(i){return i!=null&&(Gr.seed=i),Gr.seed}o(Rn,"randSeed");function Vi(...i){return Gr.genAny(...i)}o(Vi,"rand");function zr(...i){return Math.floor(Vi(...i))}o(zr,"randi");function Mn(i){return Vi()<=i}o(Mn,"chance");function Bn(i){return i[zr(i.length)]}o(Bn,"choose");function Pn(i,t){return i.pos.x+i.width>t.pos.x&&i.pos.x<t.pos.x+t.width&&i.pos.y+i.height>t.pos.y&&i.pos.y<t.pos.y+t.height}o(Pn,"testRectRect");function Tn(i,t){if(i.p1.x===i.p2.x&&i.p1.y===i.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let r=(t.p2.y-t.p1.y)*(i.p2.x-i.p1.x)-(t.p2.x-t.p1.x)*(i.p2.y-i.p1.y);if(r===0)return null;let u=((t.p2.x-t.p1.x)*(i.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(i.p1.x-t.p1.x))/r,d=((i.p2.x-i.p1.x)*(i.p1.y-t.p1.y)-(i.p2.y-i.p1.y)*(i.p1.x-t.p1.x))/r;return u<0||u>1||d<0||d>1?null:u}o(Tn,"testLineLineT");function Oe(i,t){let r=Tn(i,t);return r?P(i.p1.x+r*(i.p2.x-i.p1.x),i.p1.y+r*(i.p2.y-i.p1.y)):null}o(Oe,"testLineLine");function Fn(i,t){if(xi(i,t.p1)||xi(i,t.p2))return!0;let r=i.points();return!!Oe(t,new Le(r[0],r[1]))||!!Oe(t,new Le(r[1],r[2]))||!!Oe(t,new Le(r[2],r[3]))||!!Oe(t,new Le(r[3],r[0]))}o(Fn,"testRectLine");function xi(i,t){return t.x>i.pos.x&&t.x<i.pos.x+i.width&&t.y>i.pos.y&&t.y<i.pos.y+i.height}o(xi,"testRectPoint");function Cn(i,t){let r=t.sub(i.p1),u=i.p2.sub(i.p1);if(Math.abs(r.cross(u))>Number.EPSILON)return!1;let d=r.dot(u)/u.dot(u);return d>=0&&d<=1}o(Cn,"testLinePoint");function Kr(i,t){let r=i.p2.sub(i.p1),u=r.dot(r),d=i.p1.sub(t.center),p=2*r.dot(d),M=d.dot(d)-t.radius*t.radius,C=p*p-4*u*M;if(u<=Number.EPSILON||C<0)return!1;if(C==0){let N=-p/(2*u);if(N>=0&&N<=1)return!0}else{let N=(-p+Math.sqrt(C))/(2*u),v=(-p-Math.sqrt(C))/(2*u);if(N>=0&&N<=1||v>=0&&v<=1)return!0}return Qr(t,i.p1)}o(Kr,"testLineCircle");function Qr(i,t){return i.center.sdist(t)<i.radius*i.radius}o(Qr,"testCirclePoint");function kn(i,t){let r=t.pts[t.pts.length-1];for(let u of t.pts){if(Kr(new Le(r,u),i))return!0;r=u}return Qr(i,t.pts[0])?!0:Wr(t,i.center)}o(kn,"testCirclePolygon");function Wr(i,t){let r=!1,u=i.pts;for(let d=0,p=u.length-1;d<u.length;p=d++)u[d].y>t.y!=u[p].y>t.y&&t.x<(u[p].x-u[d].x)*(t.y-u[d].y)/(u[p].y-u[d].y)+u[d].x&&(r=!r);return r}o(Wr,"testPolygonPoint");var ye,Le=(ye=class{constructor(t,r){x(this,"p1");x(this,"p2");this.p1=t.clone(),this.p2=r.clone()}transform(t){return new ye(t.multVec2(this.p1),t.multVec2(this.p2))}bbox(){return Tt.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new ye(this.p1,this.p2)}},o(ye,"Line"),ye),ve,Tt=(ve=class{constructor(t,r,u){x(this,"pos");x(this,"width");x(this,"height");this.pos=t.clone(),this.width=r,this.height=u}static fromPoints(t,r){return new ve(t.clone(),r.x-t.x,r.y-t.y)}center(){return new E(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(t){return new wi(this.points().map(r=>t.multVec2(r)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new ve(this.pos.clone(),this.width,this.height)}distToPoint(t){return Math.sqrt(this.sdistToPoint(t))}sdistToPoint(t){let r=this.pos,u=this.pos.add(this.width,this.height),d=Math.max(r.x-t.x,0,t.x-u.x),p=Math.max(r.y-t.y,0,t.y-u.y);return d*d+p*p}},o(ve,"Rect"),ve),qe,ln=(qe=class{constructor(t,r){x(this,"center");x(this,"radius");this.center=t.clone(),this.radius=r}transform(t){return new Ro(this.center,this.radius,this.radius).transform(t)}bbox(){return Tt.fromPoints(this.center.sub(P(this.radius)),this.center.add(P(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new qe(this.center,this.radius)}},o(qe,"Circle"),qe),Ve,Ro=(Ve=class{constructor(t,r,u){x(this,"center");x(this,"radiusX");x(this,"radiusY");this.center=t.clone(),this.radiusX=r,this.radiusY=u}transform(t){return new Ve(t.multVec2(this.center),t.m[0]*this.radiusX,t.m[5]*this.radiusY)}bbox(){return Tt.fromPoints(this.center.sub(P(this.radiusX,this.radiusY)),this.center.add(P(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new Ve(this.center,this.radiusX,this.radiusY)}},o(Ve,"Ellipse"),Ve),xe,wi=(xe=class{constructor(t){x(this,"pts");if(t.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=t}transform(t){return new xe(this.pts.map(r=>t.multVec2(r)))}bbox(){let t=P(Number.MAX_VALUE),r=P(-Number.MAX_VALUE);for(let u of this.pts)t.x=Math.min(t.x,u.x),r.x=Math.max(r.x,u.x),t.y=Math.min(t.y,u.y),r.y=Math.max(r.y,u.y);return Tt.fromPoints(t,r)}area(){let t=0,r=this.pts.length;for(let u=0;u<r;u++){let d=this.pts[u],p=this.pts[(u+1)%r];t+=d.x*p.y*.5,t-=p.x*d.y*.5}return Math.abs(t)}clone(){return new xe(this.pts.map(t=>t.clone()))}},o(xe,"Polygon"),xe);function In(i,t){let r=Number.MAX_VALUE,u=P(0);for(let d of[i,t])for(let p=0;p<d.pts.length;p++){let M=d.pts[p],C=d.pts[(p+1)%d.pts.length].sub(M).normal().unit(),N=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let V=0;V<i.pts.length;V++){let H=i.pts[V].dot(C);N=Math.min(N,H),v=Math.max(v,H)}let W=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let V=0;V<t.pts.length;V++){let H=t.pts[V].dot(C);W=Math.min(W,H),S=Math.max(S,H)}let K=Math.min(v,S)-Math.max(N,W);if(K<0)return null;if(K<Math.abs(r)){let V=S-N,H=W-v;r=Math.abs(V)<Math.abs(H)?V:H,u=C.scale(r)}}return u}o(In,"sat");var Ei,Dn=(Ei=class extends Map{constructor(...r){super(...r);x(this,"lastID");this.lastID=0}push(r){let u=this.lastID;return this.set(u,r),this.lastID++,u}pushd(r){let u=this.push(r);return()=>this.delete(u)}},o(Ei,"Registry"),Ei),Ye,Ne=(Ye=class{constructor(t){x(this,"paused",!1);x(this,"cancel");this.cancel=t}static join(t){let r=new Ye(()=>t.forEach(u=>u.cancel()));return Object.defineProperty(r,"paused",{get:()=>t[0].paused,set:u=>t.forEach(d=>d.paused=u)}),r.paused=!1,r}},o(Ye,"EventController"),Ye),Si,qt=(Si=class{constructor(){x(this,"handlers",new Dn)}add(t){let r=this.handlers.pushd((...d)=>{u.paused||t(...d)}),u=new Ne(r);return u}addOnce(t){let r=this.add((...u)=>{r.cancel(),t(...u)});return r}next(){return new Promise(t=>this.addOnce(t))}trigger(...t){this.handlers.forEach(r=>r(...t))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},o(Si,"Event"),Si),Ri,Ai=(Ri=class{constructor(){x(this,"handlers",{})}on(t,r){return this.handlers[t]||(this.handlers[t]=new qt),this.handlers[t].add(r)}onOnce(t,r){let u=this.on(t,(...d)=>{u.cancel(),r(...d)});return u}next(t){return new Promise(r=>{this.onOnce(t,(...u)=>r(u[0]))})}trigger(t,...r){this.handlers[t]&&this.handlers[t].trigger(...r)}remove(t){delete this.handlers[t]}clear(){this.handlers={}}numListeners(t){var r;return((r=this.handlers[t])==null?void 0:r.numListeners())??0}},o(Ri,"EventHandler"),Ri);function hr(i,t){if(i===t)return!0;let r=typeof i,u=typeof t;if(r!==u)return!1;if(r==="object"&&u==="object"&&i!==null&&t!==null){if(Array.isArray(i)!==Array.isArray(t))return!1;let d=Object.keys(i),p=Object.keys(t);if(d.length!==p.length)return!1;for(let M of d){let C=i[M],N=t[M];if(!hr(C,N))return!1}return!0}return!1}o(hr,"deepEq");function Un(i){let t=window.atob(i),r=t.length,u=new Uint8Array(r);for(let d=0;d<r;d++)u[d]=t.charCodeAt(d);return u.buffer}o(Un,"base64ToArrayBuffer");function Nn(i){return Un(i.split(",")[1])}o(Nn,"dataURLToArrayBuffer");function ur(i,t){let r=document.createElement("a");r.href=t,r.download=i,r.click()}o(ur,"download");function Xr(i,t){ur(i,"data:text/plain;charset=utf-8,"+t)}o(Xr,"downloadText");function On(i,t){Xr(i,JSON.stringify(t))}o(On,"downloadJSON");function jr(i,t){let r=URL.createObjectURL(t);ur(i,r),URL.revokeObjectURL(r)}o(jr,"downloadBlob");var cn=o(i=>i.match(/^data:\w+\/\w+;base64,.+/),"isDataURL"),Mo=o(i=>i.split(".").slice(0,-1).join("."),"getFileName");function Ut(i,t){return(...r)=>{let u=r.length;if(u===i.length)return i(...r);if(u===t.length)return t(...r)}}o(Ut,"overload2");var Bo=(()=>{let i=0;return()=>i++})(),Po=o(i=>i instanceof Error?i.message:String(i),"getErrorMessage"),Mi,To=(Mi=class{constructor(t=(r,u)=>r<u){x(this,"_items");x(this,"_compareFn");this._compareFn=t,this._items=[]}insert(t){this._items.push(t),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let t=this._items[0],r=this._items.pop();return this._items.length!==0&&(this._items[0]=r,this.moveDown(0)),t}clear(){this._items.splice(0,this._items.length)}moveUp(t){for(;t>0;){let r=Math.floor((t-1)/2);if(!this._compareFn(this._items[t],this._items[r])&&this._items[t]>=this._items[r])break;this.swap(t,r),t=r}}moveDown(t){for(;t<Math.floor(this._items.length/2);){let r=2*t+1;if(r<this._items.length-1&&!this._compareFn(this._items[r],this._items[r+1])&&++r,this._compareFn(this._items[t],this._items[r]))break;this.swap(t,r),t=r}}swap(t,r){[this._items[t],this._items[r]]=[this._items[r],this._items[t]]}get length(){return this._items.length}},o(Mi,"BinaryHeap"),Mi),Fo=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function Ln(i){if(typeof i!="string")throw new TypeError("string cannot be undefined or null");let t=[],r=0,u=0;for(;r<i.length;){if(u+=Gn(r+u,i),Qn(i[r+u])&&u++,Yn(i[r+u])&&u++,zn(i[r+u])&&u++,Wn(i[r+u])){u++;continue}t.push(i.substring(r,r+u)),r+=u,u=0}return t}o(Ln,"runes");function Gn(i,t){let r=t[i];if(!jn(r)||i===t.length-1)return 1;let u=r+t[i+1],d=t.substring(i+2,i+5);return Hr(u)&&Hr(d)?4:Hn(u)&&Kn(d)?t.slice(i).indexOf(String.fromCodePoint(917631))+2:qn(d)?4:2}o(Gn,"nextUnits");function jn(i){return i&&ae(i[0].charCodeAt(0),55296,56319)}o(jn,"isFirstOfSurrogatePair");function Hr(i){return ae(lr(i),127462,127487)}o(Hr,"isRegionalIndicator");function Hn(i){return ae(lr(i),127988,127988)}o(Hn,"isSubdivisionFlag");function qn(i){return ae(lr(i),127995,127999)}o(qn,"isFitzpatrickModifier");function Yn(i){return typeof i=="string"&&ae(i.charCodeAt(0),65024,65039)}o(Yn,"isVariationSelector");function zn(i){return typeof i=="string"&&ae(i.charCodeAt(0),8400,8447)}o(zn,"isDiacriticalMark");function Kn(i){let t=i.codePointAt(0);return typeof i=="string"&&typeof t=="number"&&ae(t,917504,917631)}o(Kn,"isSupplementarySpecialpurposePlane");function Qn(i){return typeof i=="string"&&Fo.includes(i.charCodeAt(0))}o(Qn,"isGrapheme");function Wn(i){return typeof i=="string"&&i.charCodeAt(0)===8205}o(Wn,"isZeroWidthJoiner");function lr(i){let t=i.charCodeAt(0)-55296,r=i.charCodeAt(1)-56320;return(t<<10)+r+65536}o(lr,"codePointFromSurrogatePair");function ae(i,t,r){return i>=t&&i<=r}o(ae,"betweenInclusive");var dn={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},Bi,ir=(Bi=class{constructor(){x(this,"pressed",new Set([]));x(this,"pressedRepeat",new Set([]));x(this,"released",new Set([]));x(this,"down",new Set([]))}update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(t){this.pressed.add(t),this.pressedRepeat.add(t),this.down.add(t)}pressRepeat(t){this.pressedRepeat.add(t)}release(t){this.down.delete(t),this.pressed.delete(t),this.released.add(t)}},o(Bi,"ButtonState"),Bi),Pi,Co=(Pi=class{constructor(){x(this,"buttonState",new ir);x(this,"stickState",new Map)}},o(Pi,"GamepadState"),Pi),Ti,ko=(Ti=class{constructor(){x(this,"dts",[]);x(this,"timer",0);x(this,"fps",0)}tick(t){this.dts.push(t),this.timer+=t,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((r,u)=>r+u)/this.dts.length)),this.dts=[])}},o(Ti,"FPSCounter"),Ti),Io=o(i=>{if(!i.canvas)throw new Error("Please provide a canvas");let t={canvas:i.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new ko,timeScale:1,skipTime:!1,numFrames:0,mousePos:new E(0),mouseDeltaPos:new E(0),keyState:new ir,mouseState:new ir,mergedGamepadState:new Co,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:i.canvas.offsetWidth,lastHeight:i.canvas.offsetHeight,events:new Ai};function r(){return t.dt*t.timeScale}o(r,"dt");function u(){return t.time}o(u,"time");function d(){return t.fpsCounter.fps}o(d,"fps");function p(){return t.numFrames}o(p,"numFrames");function M(){return t.canvas.toDataURL()}o(M,"screenshot");function C(f){t.canvas.style.cursor=f}o(C,"setCursor");function N(){return t.canvas.style.cursor}o(N,"getCursor");function v(f){if(f)try{let b=t.canvas.requestPointerLock();b.catch&&b.catch(B=>console.error(B))}catch(b){console.error(b)}else document.exitPointerLock()}o(v,"setCursorLocked");function W(){return!!document.pointerLockElement}o(W,"isCursorLocked");function S(f){f.requestFullscreen?f.requestFullscreen():f.webkitRequestFullscreen&&f.webkitRequestFullscreen()}o(S,"enterFullscreen");function K(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}o(K,"exitFullscreen");function V(){return document.fullscreenElement||document.webkitFullscreenElement}o(V,"getFullscreenElement");function H(f=!0){f?S(t.canvas):K()}o(H,"setFullscreen");function _(){return!!V()}o(_,"isFullscreen");function j(){t.stopped=!0;for(let f in ut)t.canvas.removeEventListener(f,ut[f]);for(let f in At)document.removeEventListener(f,At[f]);for(let f in gt)window.removeEventListener(f,gt[f]);Rt.disconnect()}o(j,"quit");function O(f){t.loopID!==null&&cancelAnimationFrame(t.loopID);let b=0,B=o(Q=>{if(t.stopped)return;if(document.visibilityState!=="visible"){t.loopID=requestAnimationFrame(B);return}let Z=Q/1e3,vt=Z-t.realTime,Ct=i.maxFPS?1/i.maxFPS:0;t.realTime=Z,b+=vt,b>Ct&&(t.skipTime||(t.dt=b,t.time+=r(),t.fpsCounter.tick(t.dt)),b=0,t.skipTime=!1,t.numFrames++,de(),f(),ni()),t.loopID=requestAnimationFrame(B)},"frame");B(0)}o(O,"run");function tt(){return"ontouchstart"in window||navigator.maxTouchPoints>0}o(tt,"isTouchscreen");function R(){return t.mousePos.clone()}o(R,"mousePos");function St(){return t.mouseDeltaPos.clone()}o(St,"mouseDeltaPos");function F(f="left"){return t.mouseState.pressed.has(f)}o(F,"isMousePressed");function mt(f="left"){return t.mouseState.down.has(f)}o(mt,"isMouseDown");function ht(f="left"){return t.mouseState.released.has(f)}o(ht,"isMouseReleased");function rt(){return t.isMouseMoved}o(rt,"isMouseMoved");function xt(f){return f===void 0?t.keyState.pressed.size>0:t.keyState.pressed.has(f)}o(xt,"isKeyPressed");function Qe(f){return f===void 0?t.keyState.pressedRepeat.size>0:t.keyState.pressedRepeat.has(f)}o(Qe,"isKeyPressedRepeat");function be(f){return f===void 0?t.keyState.down.size>0:t.keyState.down.has(f)}o(be,"isKeyDown");function Ee(f){return f===void 0?t.keyState.released.size>0:t.keyState.released.has(f)}o(Ee,"isKeyReleased");function Se(f){return f===void 0?t.mergedGamepadState.buttonState.pressed.size>0:t.mergedGamepadState.buttonState.pressed.has(f)}o(Se,"isGamepadButtonPressed");function Wt(f){return f===void 0?t.mergedGamepadState.buttonState.down.size>0:t.mergedGamepadState.buttonState.down.has(f)}o(Wt,"isGamepadButtonDown");function We(f){return f===void 0?t.mergedGamepadState.buttonState.released.size>0:t.mergedGamepadState.buttonState.released.has(f)}o(We,"isGamepadButtonReleased");function Xe(f){return t.events.on("resize",f)}o(Xe,"onResize");let Ni=Ut(f=>t.events.on("keyDown",f),(f,b)=>t.events.on("keyDown",B=>B===f&&b(f))),Oi=Ut(f=>t.events.on("keyPress",f),(f,b)=>t.events.on("keyPress",B=>B===f&&b(f))),Li=Ut(f=>t.events.on("keyPressRepeat",f),(f,b)=>t.events.on("keyPressRepeat",B=>B===f&&b(f))),Gi=Ut(f=>t.events.on("keyRelease",f),(f,b)=>t.events.on("keyRelease",B=>B===f&&b(f))),Je=Ut(f=>t.events.on("mouseDown",b=>f(b)),(f,b)=>t.events.on("mouseDown",B=>B===f&&b(B))),Ze=Ut(f=>t.events.on("mousePress",b=>f(b)),(f,b)=>t.events.on("mousePress",B=>B===f&&b(B))),$e=Ut(f=>t.events.on("mouseRelease",b=>f(b)),(f,b)=>t.events.on("mouseRelease",B=>B===f&&b(B)));function Re(f){return t.events.on("mouseMove",()=>f(R(),St()))}o(Re,"onMouseMove");function Me(f){return t.events.on("charInput",f)}o(Me,"onCharInput");function _e(f){return t.events.on("touchStart",f)}o(_e,"onTouchStart");function he(f){return t.events.on("touchMove",f)}o(he,"onTouchMove");function ti(f){return t.events.on("touchEnd",f)}o(ti,"onTouchEnd");function ei(f){return t.events.on("scroll",f)}o(ei,"onScroll");function Be(f){return t.events.on("hide",f)}o(Be,"onHide");function ii(f){return t.events.on("show",f)}o(ii,"onShow");function Pe(f,b){if(typeof f=="function")return t.events.on("gamepadButtonDown",f);if(typeof f=="string"&&typeof b=="function")return t.events.on("gamepadButtonDown",B=>B===f&&b(f))}o(Pe,"onGamepadButtonDown");function Te(f,b){if(typeof f=="function")return t.events.on("gamepadButtonPress",f);if(typeof f=="string"&&typeof b=="function")return t.events.on("gamepadButtonPress",B=>B===f&&b(f))}o(Te,"onGamepadButtonPress");function ri(f,b){if(typeof f=="function")return t.events.on("gamepadButtonRelease",f);if(typeof f=="string"&&typeof b=="function")return t.events.on("gamepadButtonRelease",B=>B===f&&b(f))}o(ri,"onGamepadButtonRelease");function ue(f,b){return t.events.on("gamepadStick",(B,Q)=>B===f&&b(Q))}o(ue,"onGamepadStick");function si(f){t.events.on("gamepadConnect",f)}o(si,"onGamepadConnect");function le(f){t.events.on("gamepadDisconnect",f)}o(le,"onGamepadDisconnect");function Lt(f){return t.mergedGamepadState.stickState.get(f)||new E(0)}o(Lt,"getGamepadStick");function ce(){return[...t.charInputted]}o(ce,"charInputted");function Fe(){return[...t.gamepads]}o(Fe,"getGamepads");function de(){t.events.trigger("input"),t.keyState.down.forEach(f=>t.events.trigger("keyDown",f)),t.mouseState.down.forEach(f=>t.events.trigger("mouseDown",f)),Yt()}o(de,"processInput");function ni(){t.keyState.update(),t.mouseState.update(),t.mergedGamepadState.buttonState.update(),t.mergedGamepadState.stickState.forEach((f,b)=>{t.mergedGamepadState.stickState.set(b,new E(0))}),t.charInputted=[],t.isMouseMoved=!1,t.gamepadStates.forEach(f=>{f.buttonState.update(),f.stickState.forEach((b,B)=>{f.stickState.set(B,new E(0))})})}o(ni,"resetInput");function Ce(f){let b={index:f.index,isPressed:B=>t.gamepadStates.get(f.index).buttonState.pressed.has(B),isDown:B=>t.gamepadStates.get(f.index).buttonState.down.has(B),isReleased:B=>t.gamepadStates.get(f.index).buttonState.released.has(B),getStick:B=>t.gamepadStates.get(f.index).stickState.get(B)};return t.gamepads.push(b),t.gamepadStates.set(f.index,{buttonState:new ir,stickState:new Map([["left",new E(0)],["right",new E(0)]])}),b}o(Ce,"registerGamepad");function st(f){t.gamepads=t.gamepads.filter(b=>b.index!==f.index),t.gamepadStates.delete(f.index)}o(st,"removeGamepad");function Yt(){for(let f of navigator.getGamepads())f&&!t.gamepadStates.has(f.index)&&Ce(f);for(let f of t.gamepads){let b=navigator.getGamepads()[f.index],B=(i.gamepads??{})[b.id]??dn[b.id]??dn.default,Q=t.gamepadStates.get(f.index);for(let Z=0;Z<b.buttons.length;Z++)b.buttons[Z].pressed?(Q.buttonState.down.has(B.buttons[Z])||(t.mergedGamepadState.buttonState.press(B.buttons[Z]),Q.buttonState.press(B.buttons[Z]),t.events.trigger("gamepadButtonPress",B.buttons[Z])),t.events.trigger("gamepadButtonDown",B.buttons[Z])):Q.buttonState.down.has(B.buttons[Z])&&(t.mergedGamepadState.buttonState.release(B.buttons[Z]),Q.buttonState.release(B.buttons[Z]),t.events.trigger("gamepadButtonRelease",B.buttons[Z]));for(let Z in B.sticks){let vt=B.sticks[Z],Ct=new E(b.axes[vt.x],b.axes[vt.y]);Q.stickState.set(Z,Ct),t.mergedGamepadState.stickState.set(Z,Ct),t.events.trigger("gamepadStick",Z,Ct)}}}o(Yt,"processGamepad");let ut={},At={},gt={},zt=i.pixelDensity||window.devicePixelRatio||1;ut.mousemove=f=>{let b=new E(f.offsetX,f.offsetY),B=new E(f.movementX,f.movementY);if(_()){let Q=t.canvas.width/zt,Z=t.canvas.height/zt,vt=window.innerWidth,Ct=window.innerHeight,oi=vt/Ct,ai=Q/Z;if(oi>ai){let jt=Ct/Z,kt=(vt-Q*jt)/2;b.x=oe(f.offsetX-kt,0,Q*jt,0,Q),b.y=oe(f.offsetY,0,Z*jt,0,Z)}else{let jt=vt/Q,kt=(Ct-Z*jt)/2;b.x=oe(f.offsetX,0,Q*jt,0,Q),b.y=oe(f.offsetY-kt,0,Z*jt,0,Z)}}t.events.onOnce("input",()=>{t.isMouseMoved=!0,t.mousePos=b,t.mouseDeltaPos=B,t.events.trigger("mouseMove")})};let ee=["left","middle","right","back","forward"];ut.mousedown=f=>{t.events.onOnce("input",()=>{let b=ee[f.button];b&&(t.mouseState.press(b),t.events.trigger("mousePress",b))})},ut.mouseup=f=>{t.events.onOnce("input",()=>{let b=ee[f.button];b&&(t.mouseState.release(b),t.events.trigger("mouseRelease",b))})};let ji=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),Xt={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};ut.keydown=f=>{ji.has(f.key)&&f.preventDefault(),t.events.onOnce("input",()=>{let b=Xt[f.key]||f.key.toLowerCase();b.length===1?(t.events.trigger("charInput",b),t.charInputted.push(b)):b==="space"&&(t.events.trigger("charInput"," "),t.charInputted.push(" ")),f.repeat?(t.keyState.pressRepeat(b),t.events.trigger("keyPressRepeat",b)):(t.keyState.press(b),t.events.trigger("keyPressRepeat",b),t.events.trigger("keyPress",b))})},ut.keyup=f=>{t.events.onOnce("input",()=>{let b=Xt[f.key]||f.key.toLowerCase();t.keyState.release(b),t.events.trigger("keyRelease",b)})},ut.touchstart=f=>{f.preventDefault(),t.events.onOnce("input",()=>{let b=[...f.changedTouches],B=t.canvas.getBoundingClientRect();i.touchToMouse!==!1&&(t.mousePos=new E(b[0].clientX-B.x,b[0].clientY-B.y),t.mouseState.press("left"),t.events.trigger("mousePress","left")),b.forEach(Q=>{t.events.trigger("touchStart",new E(Q.clientX-B.x,Q.clientY-B.y),Q)})})},ut.touchmove=f=>{f.preventDefault(),t.events.onOnce("input",()=>{let b=[...f.changedTouches],B=t.canvas.getBoundingClientRect();i.touchToMouse!==!1&&(t.mousePos=new E(b[0].clientX-B.x,b[0].clientY-B.y),t.events.trigger("mouseMove")),b.forEach(Q=>{t.events.trigger("touchMove",new E(Q.clientX-B.x,Q.clientY-B.y),Q)})})},ut.touchend=f=>{t.events.onOnce("input",()=>{let b=[...f.changedTouches],B=t.canvas.getBoundingClientRect();i.touchToMouse!==!1&&(t.mousePos=new E(b[0].clientX-B.x,b[0].clientY-B.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),b.forEach(Q=>{t.events.trigger("touchEnd",new E(Q.clientX-B.x,Q.clientY-B.y),Q)})})},ut.touchcancel=f=>{t.events.onOnce("input",()=>{let b=[...f.changedTouches],B=t.canvas.getBoundingClientRect();i.touchToMouse!==!1&&(t.mousePos=new E(b[0].clientX-B.x,b[0].clientY-B.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),b.forEach(Q=>{t.events.trigger("touchEnd",new E(Q.clientX-B.x,Q.clientY-B.y),Q)})})},ut.wheel=f=>{f.preventDefault(),t.events.onOnce("input",()=>{t.events.trigger("scroll",new E(f.deltaX,f.deltaY))})},ut.contextmenu=f=>f.preventDefault(),At.visibilitychange=()=>{document.visibilityState==="visible"?(t.skipTime=!0,t.events.trigger("show")):t.events.trigger("hide")},gt.gamepadconnected=f=>{let b=Ce(f.gamepad);t.events.onOnce("input",()=>{t.events.trigger("gamepadConnect",b)})},gt.gamepaddisconnected=f=>{let b=Fe().filter(B=>B.index===f.gamepad.index)[0];st(f.gamepad),t.events.onOnce("input",()=>{t.events.trigger("gamepadDisconnect",b)})};for(let f in ut)t.canvas.addEventListener(f,ut[f]);for(let f in At)document.addEventListener(f,At[f]);for(let f in gt)window.addEventListener(f,gt[f]);let Rt=new ResizeObserver(f=>{for(let b of f)if(b.target===t.canvas){if(t.lastWidth===t.canvas.offsetWidth&&t.lastHeight===t.canvas.offsetHeight)return;t.lastWidth=t.canvas.offsetWidth,t.lastHeight=t.canvas.offsetHeight,t.events.onOnce("input",()=>{t.events.trigger("resize")})}});return Rt.observe(t.canvas),{dt:r,time:u,run:O,canvas:t.canvas,fps:d,numFrames:p,quit:j,setFullscreen:H,isFullscreen:_,setCursor:C,screenshot:M,getGamepads:Fe,getCursor:N,setCursorLocked:v,isCursorLocked:W,isTouchscreen:tt,mousePos:R,mouseDeltaPos:St,isKeyDown:be,isKeyPressed:xt,isKeyPressedRepeat:Qe,isKeyReleased:Ee,isMouseDown:mt,isMousePressed:F,isMouseReleased:ht,isMouseMoved:rt,isGamepadButtonPressed:Se,isGamepadButtonDown:Wt,isGamepadButtonReleased:We,getGamepadStick:Lt,charInputted:ce,onResize:Xe,onKeyDown:Ni,onKeyPress:Oi,onKeyPressRepeat:Li,onKeyRelease:Gi,onMouseDown:Je,onMousePress:Ze,onMouseRelease:$e,onMouseMove:Re,onCharInput:Me,onTouchStart:_e,onTouchMove:he,onTouchEnd:ti,onScroll:ei,onHide:Be,onShow:ii,onGamepadButtonDown:Pe,onGamepadButtonPress:Te,onGamepadButtonRelease:ri,onGamepadStick:ue,onGamepadConnect:si,onGamepadDisconnect:le,events:t.events}},"default"),ze,we=(ze=class{constructor(t,r,u,d={}){x(this,"ctx");x(this,"src",null);x(this,"glTex");x(this,"width");x(this,"height");this.ctx=t;let p=t.gl;this.glTex=t.gl.createTexture(),t.onDestroy(()=>this.free()),this.width=r,this.height=u;let M={linear:p.LINEAR,nearest:p.NEAREST}[d.filter??t.opts.texFilter]??p.NEAREST,C={repeat:p.REPEAT,clampToEadge:p.CLAMP_TO_EDGE}[d.wrap]??p.CLAMP_TO_EDGE;this.bind(),r&&u&&p.texImage2D(p.TEXTURE_2D,0,p.RGBA,r,u,0,p.RGBA,p.UNSIGNED_BYTE,null),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,M),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,M),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,C),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,C),this.unbind()}static fromImage(t,r,u={}){let d=new ze(t,r.width,r.height,u);return d.update(r),d.src=r,d}update(t,r=0,u=0){let d=this.ctx.gl;this.bind(),d.texSubImage2D(d.TEXTURE_2D,0,r,u,d.RGBA,d.UNSIGNED_BYTE,t),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},o(ze,"Texture"),ze),Fi,Xi=(Fi=class{constructor(t,r,u,d={}){x(this,"ctx");x(this,"tex");x(this,"glFramebuffer");x(this,"glRenderbuffer");this.ctx=t;let p=t.gl;t.onDestroy(()=>this.free()),this.tex=new we(t,r,u,d),this.glFramebuffer=p.createFramebuffer(),this.glRenderbuffer=p.createRenderbuffer(),this.bind(),p.renderbufferStorage(p.RENDERBUFFER,p.DEPTH_STENCIL,r,u),p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,this.tex.glTex,0),p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_STENCIL_ATTACHMENT,p.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let t=this.ctx.gl,r=new Uint8ClampedArray(this.width*this.height*4);this.bind(),t.readPixels(0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,r),this.unbind();let u=this.width*4,d=new Uint8Array(u);for(let p=0;p<(this.height/2|0);p++){let M=p*u,C=(this.height-p-1)*u;d.set(r.subarray(M,M+u)),r.copyWithin(M,C,C+u),r.set(d,C)}return new ImageData(r,this.width,this.height)}toDataURL(){let t=document.createElement("canvas"),r=t.getContext("2d");return t.width=this.width,t.height=this.height,r.putImageData(this.toImageData(),0,0),t.toDataURL()}draw(t){this.bind(),t(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let t=this.ctx.gl;t.deleteFramebuffer(this.glFramebuffer),t.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},o(Fi,"FrameBuffer"),Fi),Ci,Do=(Ci=class{constructor(t,r,u,d){x(this,"ctx");x(this,"glProgram");this.ctx=t,t.onDestroy(()=>this.free());let p=t.gl,M=p.createShader(p.VERTEX_SHADER),C=p.createShader(p.FRAGMENT_SHADER);p.shaderSource(M,r),p.shaderSource(C,u),p.compileShader(M),p.compileShader(C);let N=p.createProgram();if(this.glProgram=N,p.attachShader(N,M),p.attachShader(N,C),d.forEach((v,W)=>p.bindAttribLocation(N,W,v)),p.linkProgram(N),!p.getProgramParameter(N,p.LINK_STATUS)){let v=p.getShaderInfoLog(M);if(v)throw new Error("VERTEX SHADER "+v);let W=p.getShaderInfoLog(C);if(W)throw new Error("FRAGMENT SHADER "+W)}p.deleteShader(M),p.deleteShader(C)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(t){let r=this.ctx.gl;for(let u in t){let d=t[u],p=r.getUniformLocation(this.glProgram,u);typeof d=="number"?r.uniform1f(p,d):d instanceof Kt?r.uniformMatrix4fv(p,!1,new Float32Array(d.m)):d instanceof ot?r.uniform3f(p,d.r,d.g,d.b):d instanceof E&&r.uniform2f(p,d.x,d.y)}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},o(Ci,"Shader"),Ci),ki,Uo=(ki=class{constructor(t,r,u,d){x(this,"ctx");x(this,"glVBuf");x(this,"glIBuf");x(this,"vqueue",[]);x(this,"iqueue",[]);x(this,"stride");x(this,"maxVertices");x(this,"maxIndices");x(this,"vertexFormat");x(this,"numDraws",0);x(this,"curPrimitive",null);x(this,"curTex",null);x(this,"curShader",null);x(this,"curUniform",{});let p=t.gl;this.vertexFormat=r,this.ctx=t,this.stride=r.reduce((M,C)=>M+C.size,0),this.maxVertices=u,this.maxIndices=d,this.glVBuf=p.createBuffer(),t.pushArrayBuffer(this.glVBuf),p.bufferData(p.ARRAY_BUFFER,u*4,p.DYNAMIC_DRAW),t.popArrayBuffer(),this.glIBuf=p.createBuffer(),t.pushElementArrayBuffer(this.glIBuf),p.bufferData(p.ELEMENT_ARRAY_BUFFER,d*4,p.DYNAMIC_DRAW),t.popElementArrayBuffer()}push(t,r,u,d,p=null,M={}){(t!==this.curPrimitive||p!==this.curTex||d!==this.curShader||!hr(this.curUniform,M)||this.vqueue.length+r.length*this.stride>this.maxVertices||this.iqueue.length+u.length>this.maxIndices)&&this.flush();let C=this.vqueue.length/this.stride;for(let N of r)this.vqueue.push(N);for(let N of u)this.iqueue.push(N+C);this.curPrimitive=t,this.curShader=d,this.curTex=p,this.curUniform=M}flush(){var r,u;if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let t=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),t.bufferSubData(t.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),(r=this.curTex)==null||r.bind(),t.drawElements(this.curPrimitive,this.iqueue.length,t.UNSIGNED_SHORT,0),(u=this.curTex)==null||u.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let t=this.ctx.gl;t.deleteBuffer(this.glVBuf),t.deleteBuffer(this.glIBuf)}},o(ki,"BatchRenderer"),ki);function ne(i){let t=[],r=o(p=>{t.push(p),i(p)},"push"),u=o(()=>{t.pop(),i(d()??null)},"pop"),d=o(()=>t[t.length-1],"cur");return[r,u,d]}o(ne,"genStack");function Xn(i,t={}){let r=[];function u(F){r.push(F)}o(u,"onDestroy");function d(){r.forEach(F=>F()),i.getExtension("WEBGL_lose_context").loseContext()}o(d,"destroy");let p=null;function M(F){if(hr(F,p))return;p=F;let mt=F.reduce((ht,rt)=>ht+rt.size,0);F.reduce((ht,rt,xt)=>(i.vertexAttribPointer(xt,rt.size,i.FLOAT,!1,mt*4,ht),i.enableVertexAttribArray(xt),ht+rt.size*4),0)}o(M,"setVertexFormat");let[C,N]=ne(F=>i.bindTexture(i.TEXTURE_2D,F)),[v,W]=ne(F=>i.bindBuffer(i.ARRAY_BUFFER,F)),[S,K]=ne(F=>i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,F)),[V,H]=ne(F=>i.bindFramebuffer(i.FRAMEBUFFER,F)),[_,j]=ne(F=>i.bindRenderbuffer(i.RENDERBUFFER,F)),[O,tt]=ne(({x:F,y:mt,w:ht,h:rt})=>{i.viewport(F,mt,ht,rt)}),[R,St]=ne(F=>i.useProgram(F));return O({x:0,y:0,w:i.drawingBufferWidth,h:i.drawingBufferHeight}),{gl:i,opts:t,onDestroy:u,destroy:d,pushTexture2D:C,popTexture2D:N,pushArrayBuffer:v,popArrayBuffer:W,pushElementArrayBuffer:S,popElementArrayBuffer:K,pushFramebuffer:V,popFramebuffer:H,pushRenderbuffer:_,popRenderbuffer:j,pushViewport:O,popViewport:tt,pushProgram:R,popProgram:St,setVertexFormat:M}}o(Xn,"initGfx");var Ke,Gt=(Ke=class{constructor(t){x(this,"loaded",!1);x(this,"data",null);x(this,"error",null);x(this,"onLoadEvents",new qt);x(this,"onErrorEvents",new qt);x(this,"onFinishEvents",new qt);t.then(r=>{this.data=r,this.onLoadEvents.trigger(r)}).catch(r=>{if(this.error=r,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(r);else throw r}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(t){let r=new Ke(Promise.resolve(t));return r.data=t,r.loaded=!0,r}onLoad(t){return this.loaded&&this.data?t(this.data):this.onLoadEvents.add(t),this}onError(t){return this.loaded&&this.error?t(this.error):this.onErrorEvents.add(t),this}onFinish(t){return this.loaded?t():this.onFinishEvents.add(t),this}then(t){return this.onLoad(t)}catch(t){return this.onError(t)}finally(t){return this.onFinish(t)}},o(Ke,"Asset"),Ke),Ii,Ue=(Ii=class{constructor(){x(this,"assets",new Map);x(this,"lastUID",0)}add(t,r){let u=t??this.lastUID+++"",d=new Gt(r);return this.assets.set(u,d),d}addLoaded(t,r){let u=t??this.lastUID+++"",d=Gt.loaded(r);return this.assets.set(u,d),d}get(t){return this.assets.get(t)}progress(){if(this.assets.size===0)return 1;let t=0;return this.assets.forEach(r=>{r.loaded&&t++}),t/this.assets.size}},o(Ii,"AssetBucket"),Ii);function cr(i){return fetch(i).then(t=>{if(!t.ok)throw new Error(`Failed to fetch "${i}"`);return t})}o(cr,"fetchURL");function yi(i){return cr(i).then(t=>t.json())}o(yi,"fetchJSON");function Jn(i){return cr(i).then(t=>t.text())}o(Jn,"fetchText");function Zn(i){return cr(i).then(t=>t.arrayBuffer())}o(Zn,"fetchArrayBuffer");function vi(i){let t=new Image;return t.crossOrigin="anonymous",t.src=i,new Promise((r,u)=>{t.onload=()=>r(t),t.onerror=()=>u(new Error(`Failed to load image from "${i}"`))})}o(vi,"loadImg");var Ji=2.5949095,fn=1.70158+1,pn=2*Math.PI/3,gn=2*Math.PI/4.5,rr={linear:i=>i,easeInSine:i=>1-Math.cos(i*Math.PI/2),easeOutSine:i=>Math.sin(i*Math.PI/2),easeInOutSine:i=>-(Math.cos(Math.PI*i)-1)/2,easeInQuad:i=>i*i,easeOutQuad:i=>1-(1-i)*(1-i),easeInOutQuad:i=>i<.5?2*i*i:1-Math.pow(-2*i+2,2)/2,easeInCubic:i=>i*i*i,easeOutCubic:i=>1-Math.pow(1-i,3),easeInOutCubic:i=>i<.5?4*i*i*i:1-Math.pow(-2*i+2,3)/2,easeInQuart:i=>i*i*i*i,easeOutQuart:i=>1-Math.pow(1-i,4),easeInOutQuart:i=>i<.5?8*i*i*i*i:1-Math.pow(-2*i+2,4)/2,easeInQuint:i=>i*i*i*i*i,easeOutQuint:i=>1-Math.pow(1-i,5),easeInOutQuint:i=>i<.5?16*i*i*i*i*i:1-Math.pow(-2*i+2,5)/2,easeInExpo:i=>i===0?0:Math.pow(2,10*i-10),easeOutExpo:i=>i===1?1:1-Math.pow(2,-10*i),easeInOutExpo:i=>i===0?0:i===1?1:i<.5?Math.pow(2,20*i-10)/2:(2-Math.pow(2,-20*i+10))/2,easeInCirc:i=>1-Math.sqrt(1-Math.pow(i,2)),easeOutCirc:i=>Math.sqrt(1-Math.pow(i-1,2)),easeInOutCirc:i=>i<.5?(1-Math.sqrt(1-Math.pow(2*i,2)))/2:(Math.sqrt(1-Math.pow(-2*i+2,2))+1)/2,easeInBack:i=>fn*i*i*i-1.70158*i*i,easeOutBack:i=>1+fn*Math.pow(i-1,3)+1.70158*Math.pow(i-1,2),easeInOutBack:i=>i<.5?Math.pow(2*i,2)*((Ji+1)*2*i-Ji)/2:(Math.pow(2*i-2,2)*((Ji+1)*(i*2-2)+Ji)+2)/2,easeInElastic:i=>i===0?0:i===1?1:-Math.pow(2,10*i-10)*Math.sin((i*10-10.75)*pn),easeOutElastic:i=>i===0?0:i===1?1:Math.pow(2,-10*i)*Math.sin((i*10-.75)*pn)+1,easeInOutElastic:i=>i===0?0:i===1?1:i<.5?-(Math.pow(2,20*i-10)*Math.sin((20*i-11.125)*gn))/2:Math.pow(2,-20*i+10)*Math.sin((20*i-11.125)*gn)/2+1,easeInBounce:i=>1-rr.easeOutBounce(1-i),easeOutBounce:i=>i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375,easeInOutBounce:i=>i<.5?(1-rr.easeOutBounce(1-2*i))/2:(1+rr.easeOutBounce(2*i-1))/2},Zi=rr,Di,No=(Di=class{constructor(t,r,u){x(this,"textures",[]);x(this,"canvas");x(this,"c2d");x(this,"x",0);x(this,"y",0);x(this,"curHeight",0);x(this,"gfx");this.gfx=t,this.canvas=document.createElement("canvas"),this.canvas.width=r,this.canvas.height=u,this.textures=[we.fromImage(t,this.canvas)],this.c2d=this.canvas.getContext("2d")}add(t){if(t.width>this.canvas.width||t.height>this.canvas.height)throw new Error(`Texture size (${t.width} x ${t.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+t.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+t.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(we.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let r=this.textures[this.textures.length-1],u=new E(this.x,this.y);return this.x+=t.width,t.height>this.curHeight&&(this.curHeight=t.height),t instanceof ImageData?this.c2d.putImageData(t,u.x,u.y):this.c2d.drawImage(t,u.x,u.y),r.update(this.canvas),[r,new Et(u.x/this.canvas.width,u.y/this.canvas.height,t.width/this.canvas.width,t.height/this.canvas.height)]}free(){for(let t of this.textures)t.free()}},o(Di,"TexPacker"),Di),Oo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==",Lo=xo("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),Go="data:image/png;base64,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",jo="data:image/png;base64,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",Ho="3000.1.17",mn=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",$i="topleft",wn=64,qo="monospace",_i="monospace",Yo=36,tr=64,er=256,An=2048,yn=2048,vn=2048,Vn=2048,xn=.1,zo=64,Ur="linear",Ko=8,Qo=4,qr=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],Wo=qr.reduce((i,t)=>i+t.size,0),$n=2048,Xo=$n*4*Wo,Jo=$n*6,Zo=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,$o=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,Nr=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,Or=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,_o=new Set(["id","require"]),ta=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function me(i){switch(i){case"topleft":return new E(-1,-1);case"top":return new E(0,-1);case"topright":return new E(1,-1);case"left":return new E(-1,0);case"center":return new E(0,0);case"right":return new E(1,0);case"botleft":return new E(-1,1);case"bot":return new E(0,1);case"botright":return new E(1,1);default:return i}}o(me,"anchorPt");function _n(i){switch(i){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}o(_n,"alignPt");function to(i){return i.createBuffer(1,1,44100)}o(to,"createEmptyAudioBuffer");var ea=o((i={})=>{let t=i.root??document.body;t===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let r=i.canvas??(()=>{let e=document.createElement("canvas");return t.appendChild(e),e})(),u=i.scale??1,d=i.width&&i.height&&!i.stretch&&!i.letterbox;d?(r.width=i.width*u,r.height=i.height*u):(r.width=r.parentElement.offsetWidth,r.height=r.parentElement.offsetHeight);let p=["outline: none","cursor: default"];if(d){let e=r.width,s=r.height;p.push(`width: ${e}px`),p.push(`height: ${s}px`)}else p.push("width: 100%"),p.push("height: 100%");i.crisp&&(p.push("image-rendering: pixelated"),p.push("image-rendering: crisp-edges")),r.style.cssText=p.join(";");let M=i.pixelDensity||window.devicePixelRatio;r.width*=M,r.height*=M,r.tabIndex=0;let C=document.createElement("canvas");C.width=er,C.height=er;let N=C.getContext("2d",{willReadFrequently:!0}),v=Io({canvas:r,touchToMouse:i.touchToMouse,gamepads:i.gamepads,pixelDensity:i.pixelDensity,maxFPS:i.maxFPS}),W=[],S=v.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0}),K=Xn(S,{texFilter:i.texFilter}),V=(()=>{let e=ue(Nr,Or),s=we.fromImage(K,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),n=i.width&&i.height?new Xi(K,i.width*M*u,i.height*M*u):new Xi(K,S.drawingBufferWidth,S.drawingBufferHeight),a=null,h=1;i.background&&(a=et(i.background),h=Array.isArray(i.background)?i.background[3]:1,S.clearColor(a.r/255,a.g/255,a.b/255,h??1)),S.enable(S.BLEND),S.blendFuncSeparate(S.SRC_ALPHA,S.ONE_MINUS_SRC_ALPHA,S.ONE,S.ONE_MINUS_SRC_ALPHA);let l=new Uo(K,qr,Xo,Jo),g=we.fromImage(K,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,defShader:e,defTex:s,frameBuffer:n,postShader:null,postShaderUniform:null,renderer:l,transform:new Kt,transformStack:[],bgTex:g,bgColor:a,bgAlpha:h,width:i.width??S.drawingBufferWidth/M/u,height:i.height??S.drawingBufferHeight/M/u,viewport:{x:0,y:0,width:S.drawingBufferWidth,height:S.drawingBufferHeight},fixed:!1}})();const pe=class pe{constructor(s,n,a={},h=null){x(this,"tex");x(this,"frames",[new Et(0,0,1,1)]);x(this,"anims",{});x(this,"slice9",null);this.tex=s,n&&(this.frames=n),this.anims=a,this.slice9=h}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(s,n={}){return typeof s=="string"?pe.fromURL(s,n):Promise.resolve(pe.fromImage(s,n))}static fromImage(s,n={}){let[a,h]=O.packer.add(s),l=n.frames?n.frames.map(g=>new Et(h.x+g.x*h.w,h.y+g.y*h.h,g.w*h.w,g.h*h.h)):be(n.sliceX||1,n.sliceY||1,h.x,h.y,h.w,h.h);return new pe(a,l,n.anims,n.slice9)}static fromURL(s,n={}){return vi(s).then(a=>pe.fromImage(a,n))}};o(pe,"SpriteData");let H=pe;const De=class De{constructor(s){x(this,"buf");this.buf=s}static fromArrayBuffer(s){return new Promise((n,a)=>j.ctx.decodeAudioData(s,n,a)).then(n=>new De(n))}static fromURL(s){return cn(s)?De.fromArrayBuffer(Nn(s)):Zn(s).then(n=>De.fromArrayBuffer(n))}};o(De,"SoundData");let _=De,j=(()=>{let e=new(window.AudioContext||window.webkitAudioContext),s=e.createGain();s.connect(e.destination);let n=new _(to(e));return e.decodeAudioData(Lo.buffer.slice(0)).then(a=>{n.buf=a}).catch(a=>{console.error("Failed to load burp: ",a)}),{ctx:e,masterNode:s,burpSnd:n}})(),O={urlPrefix:"",sprites:new Ue,fonts:new Ue,bitmapFonts:new Ue,sounds:new Ue,shaders:new Ue,custom:new Ue,packer:new No(K,vn,Vn),loaded:!1};function tt(e){return typeof e!="string"||cn(e)?e:O.urlPrefix+e}o(tt,"fixURL");let R={events:new Ai,objEvents:new Ai,root:Hi([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new E(1),angle:0,shake:0,transform:new Kt}};R.root.use(zi());function St(e){return O.custom.add(null,e)}o(St,"load");function F(){let e=[O.sprites,O.sounds,O.shaders,O.fonts,O.bitmapFonts,O.custom];return e.reduce((s,n)=>s+n.progress(),0)/e.length}o(F,"loadProgress");function mt(e){return e!==void 0&&(O.urlPrefix=e),O.urlPrefix}o(mt,"loadRoot");function ht(e,s){return O.custom.add(e,yi(s))}o(ht,"loadJSON");const Cr=class Cr{constructor(s,n={}){x(this,"fontface");x(this,"filter",Ur);x(this,"outline",null);x(this,"size",tr);if(this.fontface=s,this.filter=n.filter??Ur,this.size=n.size??tr,this.size>er)throw new Error(`Max font size: ${er}`);n.outline&&(this.outline={width:1,color:et(0,0,0)},typeof n.outline=="number"?this.outline.width=n.outline:typeof n.outline=="object"&&(n.outline.width&&(this.outline.width=n.outline.width),n.outline.color&&(this.outline.color=n.outline.color)))}};o(Cr,"FontData");let rt=Cr;function xt(e,s,n={}){let a=new FontFace(e,typeof s=="string"?`url(${s})`:s);return document.fonts.add(a),O.fonts.add(e,a.load().catch(h=>{throw new Error(`Failed to load font from "${s}": ${h}`)}).then(h=>new rt(h,n)))}o(xt,"loadFont");function Qe(e,s,n,a,h={}){return O.bitmapFonts.add(e,vi(s).then(l=>si(we.fromImage(K,l,h),n,a,h.chars??mn)))}o(Qe,"loadBitmapFont");function be(e=1,s=1,n=0,a=0,h=1,l=1){let g=[],y=h/e,m=l/s;for(let c=0;c<s;c++)for(let w=0;w<e;w++)g.push(new Et(n+w*y,a+c*m,y,m));return g}o(be,"slice");function Ee(e,s){return e=tt(e),St(typeof s=="string"?new Promise((n,a)=>{yi(s).then(h=>{Ee(e,h).then(n).catch(a)})}):H.from(e).then(n=>{let a={};for(let h in s){let l=s[h],g=n.frames[0],y=vn*g.w,m=Vn*g.h,c=l.frames?l.frames.map(T=>new Et(g.x+(l.x+T.x)/y*g.w,g.y+(l.y+T.y)/m*g.h,T.w/y*g.w,T.h/m*g.h)):be(l.sliceX||1,l.sliceY||1,g.x+l.x/y*g.w,g.y+l.y/m*g.h,l.width/y*g.w,l.height/m*g.h),w=new H(n.tex,c,l.anims);O.sprites.addLoaded(h,w),a[h]=w}return a}))}o(Ee,"loadSpriteAtlas");function Se(e,s={}){let n=document.createElement("canvas"),a=e[0].width,h=e[0].height;n.width=a*e.length,n.height=h;let l=n.getContext("2d");e.forEach((y,m)=>{y instanceof ImageData?l.putImageData(y,m*a,0):l.drawImage(y,m*a,0)});let g=l.getImageData(0,0,e.length*a,h);return H.fromImage(g,{...s,sliceX:e.length,sliceY:1})}o(Se,"createSpriteSheet");function Wt(e,s,n={sliceX:1,sliceY:1,anims:{}}){return s=tt(s),Array.isArray(s)?s.some(a=>typeof a=="string")?O.sprites.add(e,Promise.all(s.map(a=>typeof a=="string"?vi(a):Promise.resolve(a))).then(a=>Se(a,n))):O.sprites.addLoaded(e,Se(s,n)):typeof s=="string"?O.sprites.add(e,H.from(s,n)):O.sprites.addLoaded(e,H.fromImage(s,n))}o(Wt,"loadSprite");function We(e,s){return s=tt(s),O.sprites.add(e,new Promise(async n=>{let a=typeof s=="string"?await yi(s):s,h=await Promise.all(a.frames.map(vi)),l=document.createElement("canvas");l.width=a.width,l.height=a.height*a.frames.length;let g=l.getContext("2d");h.forEach((m,c)=>{g.drawImage(m,0,c*a.height)});let y=await Wt(null,l,{sliceY:a.frames.length,anims:a.anims});n(y)}))}o(We,"loadPedit");function Xe(e,s,n){s=tt(s),n=tt(n),typeof s=="string"&&!n&&(n=Mo(s)+".json");let a=typeof n=="string"?yi(n):Promise.resolve(n);return O.sprites.add(e,a.then(h=>{let l=h.meta.size,g=h.frames.map(m=>new Et(m.frame.x/l.w,m.frame.y/l.h,m.frame.w/l.w,m.frame.h/l.h)),y={};for(let m of h.meta.frameTags)m.from===m.to?y[m.name]=m.from:y[m.name]={from:m.from,to:m.to,speed:10,loop:!0,pingpong:m.direction==="pingpong"};return H.from(s,{frames:g,anims:y})}))}o(Xe,"loadAseprite");function Ni(e,s,n){return O.shaders.addLoaded(e,ue(s,n))}o(Ni,"loadShader");function Oi(e,s,n){s=tt(s),n=tt(n);let a=o(l=>l?Jn(l):Promise.resolve(null),"resolveUrl"),h=Promise.all([a(s),a(n)]).then(([l,g])=>ue(l,g));return O.shaders.add(e,h)}o(Oi,"loadShaderURL");function Li(e,s){return s=tt(s),O.sounds.add(e,typeof s=="string"?_.fromURL(s):_.fromArrayBuffer(s))}o(Li,"loadSound");function Gi(e="bean"){return Wt(e,Oo)}o(Gi,"loadBean");function Je(e){return O.sprites.get(e)}o(Je,"getSprite");function Ze(e){return O.sounds.get(e)}o(Ze,"getSound");function $e(e){return O.fonts.get(e)}o($e,"getFont");function Re(e){return O.bitmapFonts.get(e)}o(Re,"getBitmapFont");function Me(e){return O.shaders.get(e)}o(Me,"getShader");function _e(e){return O.custom.get(e)}o(_e,"getAsset");function he(e){if(typeof e=="string"){let s=Je(e);if(s)return s;if(F()<1)return null;throw new Error(`Sprite not found: ${e}`)}else{if(e instanceof H)return Gt.loaded(e);if(e instanceof Gt)return e;throw new Error(`Invalid sprite: ${e}`)}}o(he,"resolveSprite");function ti(e){if(typeof e=="string"){let s=Ze(e);if(s)return s;if(F()<1)return null;throw new Error(`Sound not found: ${e}`)}else{if(e instanceof _)return Gt.loaded(e);if(e instanceof Gt)return e;throw new Error(`Invalid sound: ${e}`)}}o(ti,"resolveSound");function ei(e){if(!e)return V.defShader;if(typeof e=="string"){let s=Me(e);if(s)return s.data??s;if(F()<1)return null;throw new Error(`Shader not found: ${e}`)}else if(e instanceof Gt)return e.data?e.data:e;return e}o(ei,"resolveShader");function Be(e){if(!e)return Be(i.font??qo);if(typeof e=="string"){let s=Re(e),n=$e(e);if(s)return s.data??s;if(n)return n.data??n;if(document.fonts.check(`${tr}px ${e}`))return e;if(F()<1)return null;throw new Error(`Font not found: ${e}`)}else if(e instanceof Gt)return e.data?e.data:e;return e}o(Be,"resolveFont");function ii(e){return e!==void 0&&(j.masterNode.gain.value=e),j.masterNode.gain.value}o(ii,"volume");function Pe(e,s={}){let n=j.ctx,a=s.paused??!1,h=n.createBufferSource(),l=new qt,g=n.createGain(),y=s.seek??0,m=0,c=0,w=!1;h.loop=!!s.loop,h.detune.value=s.detune??0,h.playbackRate.value=s.speed??1,h.connect(g),h.onended=()=>{var I;q()>=((I=h.buffer)==null?void 0:I.duration)&&l.trigger()},g.connect(j.masterNode),g.gain.value=s.volume??1;let T=o(I=>{h.buffer=I.buf,a||(m=n.currentTime,h.start(0,y),w=!0)},"start"),U=ti(e);U instanceof Gt&&U.onLoad(T);let q=o(()=>{if(!h.buffer)return 0;let I=a?c-m:n.currentTime-m,G=h.buffer.duration;return h.loop?I%G:Math.min(I,G)},"getTime"),Y=o(I=>{let G=n.createBufferSource();return G.buffer=I.buffer,G.loop=I.loop,G.playbackRate.value=I.playbackRate.value,G.detune.value=I.detune.value,G.onended=I.onended,G.connect(g),G},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(I){if(a!==I)if(a=I,I)w&&(h.stop(),w=!1),c=n.currentTime;else{h=Y(h);let G=c-m;h.start(0,G),w=!0,m=n.currentTime-G,c=0}},get paused(){return a},play(I=0){this.seek(I),this.paused=!1},seek(I){var G;(G=h.buffer)!=null&&G.duration&&(I>h.buffer.duration||(a?(h=Y(h),m=c-I):(h.stop(),h=Y(h),m=n.currentTime-I,h.start(0,I),w=!0,c=0)))},set speed(I){h.playbackRate.value=I},get speed(){return h.playbackRate.value},set detune(I){h.detune.value=I},get detune(){return h.detune.value},set volume(I){g.gain.value=Math.max(I,0)},get volume(){return g.gain.value},set loop(I){h.loop=I},get loop(){return h.loop},duration(){var I;return((I=h.buffer)==null?void 0:I.duration)??0},time(){return q()%this.duration()},onEnd(I){return l.add(I)},then(I){return this.onEnd(I)}}}o(Pe,"play");function Te(e){return Pe(j.burpSnd,e)}o(Te,"burp");function ri(e,s){return new Xi(K,e,s)}o(ri,"makeCanvas");function ue(e=Nr,s=Or){let n=Zo.replace("{{user}}",e??Nr),a=$o.replace("{{user}}",s??Or);try{return new Do(K,n,a,qr.map(h=>h.name))}catch(h){let l=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,g=Po(h).match(l),y=Number(g.groups.line)-14,m=g.groups.msg.trim(),c=g.groups.type.toLowerCase();throw new Error(`${c} shader line ${y}: ${m}`)}}o(ue,"makeShader");function si(e,s,n,a){let h=e.width/s,l={},g=a.split("").entries();for(let[y,m]of g)l[m]=new Et(y%h*s,Math.floor(y/h)*n,s,n);return{tex:e,map:l,size:n}}o(si,"makeFont");function le(e,s,n,a=V.defTex,h=V.defShader,l={}){let g=ei(h);if(!g||g instanceof Gt)return;let y=V.fixed||n?V.transform:R.cam.transform.mult(V.transform),m=[];for(let c of e){let w=ni(y.multVec2(c.pos));m.push(w.x,w.y,c.uv.x,c.uv.y,c.color.r/255,c.color.g/255,c.color.b/255,c.opacity)}V.renderer.push(S.TRIANGLES,m,s,g,a,l)}o(le,"drawRaw");function Lt(){V.renderer.flush()}o(Lt,"flush");function ce(){S.clear(S.COLOR_BUFFER_BIT),V.frameBuffer.bind(),S.clear(S.COLOR_BUFFER_BIT),V.bgColor||kt(()=>{zt({width:Mt(),height:Pt(),quad:new Et(0,0,Mt()/wn,Pt()/wn),tex:V.bgTex,fixed:!0})}),V.renderer.numDraws=0,V.fixed=!1,V.transformStack.length=0,V.transform=new Kt}o(ce,"frameStart");function Fe(e,s){V.postShader=e,V.postShaderUniform=s??null}o(Fe,"usePostEffect");function de(){Lt(),V.lastDrawCalls=V.renderer.numDraws,V.frameBuffer.unbind(),S.viewport(0,0,S.drawingBufferWidth,S.drawingBufferHeight);let e=V.width,s=V.height;V.width=S.drawingBufferWidth/M,V.height=S.drawingBufferHeight/M,ee({flipY:!0,tex:V.frameBuffer.tex,pos:new E(V.viewport.x,V.viewport.y),width:V.viewport.width,height:V.viewport.height,shader:V.postShader,uniform:typeof V.postShaderUniform=="function"?V.postShaderUniform():V.postShaderUniform,fixed:!0}),Lt(),V.width=e,V.height=s}o(de,"frameEnd");function ni(e){return new E(e.x/Mt()*2-1,-e.y/Pt()*2+1)}o(ni,"screen2ndc");function Ce(e){V.transform=e.clone()}o(Ce,"pushMatrix");function st(...e){if(e[0]===void 0)return;let s=P(...e);s.x===0&&s.y===0||V.transform.translate(s)}o(st,"pushTranslate");function Yt(...e){if(e[0]===void 0)return;let s=P(...e);s.x===1&&s.y===1||V.transform.scale(s)}o(Yt,"pushScale");function ut(e){e&&V.transform.rotate(e)}o(ut,"pushRotate");function At(){V.transformStack.push(V.transform.clone())}o(At,"pushTransform");function gt(){V.transformStack.length>0&&(V.transform=V.transformStack.pop())}o(gt,"popTransform");function zt(e){if(e.width===void 0||e.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let s=e.width,n=e.height,a=me(e.anchor||$i).scale(new E(s,n).scale(-.5)),h=e.quad||new Et(0,0,1,1),l=e.color||et(255,255,255),g=e.opacity??1,y=e.tex?xn/e.tex.width:0,m=e.tex?xn/e.tex.height:0,c=h.x+y,w=h.y+m,T=h.w-y*2,U=h.h-m*2;At(),st(e.pos),ut(e.angle),Yt(e.scale),st(a),le([{pos:new E(-s/2,n/2),uv:new E(e.flipX?c+T:c,e.flipY?w:w+U),color:l,opacity:g},{pos:new E(-s/2,-n/2),uv:new E(e.flipX?c+T:c,e.flipY?w+U:w),color:l,opacity:g},{pos:new E(s/2,-n/2),uv:new E(e.flipX?c:c+T,e.flipY?w+U:w),color:l,opacity:g},{pos:new E(s/2,n/2),uv:new E(e.flipX?c:c+T,e.flipY?w:w+U),color:l,opacity:g}],[0,1,3,1,2,3],e.fixed,e.tex,e.shader,e.uniform),gt()}o(zt,"drawUVQuad");function ee(e){if(!e.tex)throw new Error('drawTexture() requires property "tex".');let s=e.quad??new Et(0,0,1,1),n=e.tex.width*s.w,a=e.tex.height*s.h,h=new E(1);if(e.tiled){let l=Math.ceil((e.width||n)/n),g=Math.ceil((e.height||a)/a),y=me(e.anchor||$i).add(new E(1,1)).scale(.5).scale(l*n,g*a);for(let m=0;m<l;m++)for(let c=0;c<g;c++)zt(Object.assign({},e,{pos:(e.pos||new E(0)).add(new E(n*m,a*c)).sub(y),scale:h.scale(e.scale||new E(1)),tex:e.tex,quad:s,width:n,height:a,anchor:"topleft"}))}else e.width&&e.height?(h.x=e.width/n,h.y=e.height/a):e.width?(h.x=e.width/n,h.y=h.x):e.height&&(h.y=e.height/a,h.x=h.y),zt(Object.assign({},e,{scale:h.scale(e.scale||new E(1)),tex:e.tex,quad:s,width:n,height:a}))}o(ee,"drawTexture");function ji(e){if(!e.sprite)throw new Error('drawSprite() requires property "sprite"');let s=he(e.sprite);if(!s||!s.data)return;let n=s.data.frames[e.frame??0];if(!n)throw new Error(`Frame not found: ${e.frame??0}`);ee(Object.assign({},e,{tex:s.data.tex,quad:n.scale(e.quad??new Et(0,0,1,1))}))}o(ji,"drawSprite");function Xt(e,s,n,a,h,l=1){a=Qt(a%360),h=Qt(h%360),h<=a&&(h+=Math.PI*2);let g=[],y=Math.ceil((h-a)/Qt(8)*l),m=(h-a)/y;for(let c=a;c<h;c+=m)g.push(e.add(s*Math.cos(c),n*Math.sin(c)));return g.push(e.add(s*Math.cos(h),n*Math.sin(h))),g}o(Xt,"getArcPts");function Rt(e){if(e.width===void 0||e.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let s=e.width,n=e.height,a=me(e.anchor||$i).add(1,1).scale(new E(s,n).scale(-.5)),h=[new E(0,0),new E(s,0),new E(s,n),new E(0,n)];if(e.radius){let l=Math.min(Math.min(s,n)/2,e.radius);h=[new E(l,0),new E(s-l,0),...Xt(new E(s-l,l),l,l,270,360),new E(s,l),new E(s,n-l),...Xt(new E(s-l,n-l),l,l,0,90),new E(s-l,n),new E(l,n),...Xt(new E(l,n-l),l,l,90,180),new E(0,n-l),new E(0,l),...Xt(new E(l,l),l,l,180,270)]}vt(Object.assign({},e,{offset:a,pts:h,...e.gradient?{colors:e.horizontal?[e.gradient[0],e.gradient[1],e.gradient[1],e.gradient[0]]:[e.gradient[0],e.gradient[0],e.gradient[1],e.gradient[1]]}:{}}))}o(Rt,"drawRect");function f(e){let{p1:s,p2:n}=e;if(!s||!n)throw new Error('drawLine() requires properties "p1" and "p2".');let a=e.width||1,h=n.sub(s).unit().normal().scale(a*.5),l=[s.sub(h),s.add(h),n.add(h),n.sub(h)].map(g=>({pos:new E(g.x,g.y),uv:new E(0),color:e.color??ot.WHITE,opacity:e.opacity??1}));le(l,[0,1,3,1,2,3],e.fixed,V.defTex,e.shader,e.uniform)}o(f,"drawLine");function b(e){let s=e.pts;if(!s)throw new Error('drawLines() requires property "pts".');if(!(s.length<2))if(e.radius&&s.length>=3){let n=s[0].sdist(s[1]);for(let a=1;a<s.length-1;a++)n=Math.min(s[a].sdist(s[a+1]),n);Math.min(e.radius,Math.sqrt(n)/2),f(Object.assign({},e,{p1:s[0],p2:s[1]}));for(let a=1;a<s.length-2;a++){let h=s[a],l=s[a+1];f(Object.assign({},e,{p1:h,p2:l}))}f(Object.assign({},e,{p1:s[s.length-2],p2:s[s.length-1]}))}else for(let n=0;n<s.length-1;n++)f(Object.assign({},e,{p1:s[n],p2:s[n+1]})),e.join!=="none"&&Q(Object.assign({},e,{pos:s[n],radius:e.width/2}))}o(b,"drawLines");function B(e){if(!e.p1||!e.p2||!e.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return vt(Object.assign({},e,{pts:[e.p1,e.p2,e.p3]}))}o(B,"drawTriangle");function Q(e){if(typeof e.radius!="number")throw new Error('drawCircle() requires property "radius".');e.radius!==0&&Z(Object.assign({},e,{radiusX:e.radius,radiusY:e.radius,angle:0}))}o(Q,"drawCircle");function Z(e){if(e.radiusX===void 0||e.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(e.radiusX===0||e.radiusY===0)return;let s=e.start??0,n=e.end??360,a=me(e.anchor??"center").scale(new E(-e.radiusX,-e.radiusY)),h=Xt(a,e.radiusX,e.radiusY,s,n,e.resolution);h.unshift(a);let l=Object.assign({},e,{pts:h,radius:0,...e.gradient?{colors:[e.gradient[0],...Array(h.length-1).fill(e.gradient[1])]}:{}});if(n-s>=360&&e.outline){e.fill!==!1&&vt(Object.assign(l,{outline:null})),vt(Object.assign(l,{pts:h.slice(1),fill:!1}));return}vt(l)}o(Z,"drawEllipse");function vt(e){if(!e.pts)throw new Error('drawPolygon() requires property "pts".');let s=e.pts.length;if(!(s<3)){if(At(),st(e.pos),Yt(e.scale),ut(e.angle),st(e.offset),e.fill!==!1){let n=e.color??ot.WHITE,a=e.pts.map((l,g)=>({pos:new E(l.x,l.y),uv:new E(0,0),color:e.colors&&e.colors[g]?e.colors[g].mult(n):n,opacity:e.opacity??1})),h=[...Array(s-2).keys()].map(l=>[0,l+1,l+2]).flat();le(a,e.indices??h,e.fixed,V.defTex,e.shader,e.uniform)}e.outline&&b({pts:[...e.pts,e.pts[0]],radius:e.radius,width:e.outline.width,color:e.outline.color,join:e.outline.join,uniform:e.uniform,fixed:e.fixed,opacity:e.opacity}),gt()}}o(vt,"drawPolygon");function Ct(e,s,n){Lt(),S.clear(S.STENCIL_BUFFER_BIT),S.enable(S.STENCIL_TEST),S.stencilFunc(S.NEVER,1,255),S.stencilOp(S.REPLACE,S.REPLACE,S.REPLACE),s(),Lt(),S.stencilFunc(n,1,255),S.stencilOp(S.KEEP,S.KEEP,S.KEEP),e(),Lt(),S.disable(S.STENCIL_TEST)}o(Ct,"drawStenciled");function oi(e,s){Ct(e,s,S.EQUAL)}o(oi,"drawMasked");function ai(e,s){Ct(e,s,S.NOTEQUAL)}o(ai,"drawSubtracted");function jt(){return(V.viewport.width+V.viewport.height)/(V.width+V.height)}o(jt,"getViewportScale");function kt(e){Lt();let s=V.width,n=V.height;V.width=V.viewport.width,V.height=V.viewport.height,e(),Lt(),V.width=s,V.height=n}o(kt,"drawUnscaled");function pr(e,s){s.pos&&(e.pos=e.pos.add(s.pos)),s.scale&&(e.scale=e.scale.scale(P(s.scale))),s.angle&&(e.angle+=s.angle),s.color&&e.ch.length===1&&(e.color=e.color.mult(s.color)),s.opacity&&(e.opacity*=s.opacity)}o(pr,"applyCharTransform");let Jr=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g;function Zr(e){let s={},n=e.replace(Jr,"$2"),a=0;for(let h of e.matchAll(Jr)){let l=h.index-a;for(let g=0;g<h.groups.text.length;g++)s[g+l]=[h.groups.style];a+=h[0].length-h.groups.text.length}return{charStyleMap:s,text:n}}o(Zr,"compileStyledText");let gr={};function ie(e){var yt,Vt;if(e.text===void 0)throw new Error('formatText() requires property "text".');let s=Be(e.font);if(e.text===""||s instanceof Gt||!s)return{width:0,height:0,chars:[],opt:e};let{charStyleMap:n,text:a}=Zr(e.text+""),h=Ln(a);if(s instanceof rt||typeof s=="string"){let ct=s instanceof rt?s.fontface.family:s,at=s instanceof rt?{outline:s.outline,filter:s.filter}:{outline:null,filter:Ur},A=gr[ct]??{font:{tex:new we(K,An,yn,{filter:at.filter}),map:{},size:tr},cursor:new E(0),outline:at.outline};gr[ct]||(gr[ct]=A),s=A.font;for(let D of h)if(!A.font.map[D]){let k=N;k.clearRect(0,0,C.width,C.height),k.font=`${s.size}px ${ct}`,k.textBaseline="top",k.textAlign="left",k.fillStyle="#ffffff";let L=k.measureText(D),J=Math.ceil(L.width),X=s.size;A.outline&&(k.lineJoin="round",k.lineWidth=A.outline.width*2,k.strokeStyle=A.outline.color.toHex(),k.strokeText(D,A.outline.width,A.outline.width),J+=A.outline.width*2,X+=A.outline.width*3),k.fillText(D,((yt=A.outline)==null?void 0:yt.width)??0,((Vt=A.outline)==null?void 0:Vt.width)??0);let nt=k.getImageData(0,0,J,X);if(A.cursor.x+J>An&&(A.cursor.x=0,A.cursor.y+=X,A.cursor.y>yn))throw new Error("Font atlas exceeds character limit");s.tex.update(nt,A.cursor.x,A.cursor.y),s.map[D]=new Et(A.cursor.x,A.cursor.y,J,X),A.cursor.x+=J}}let l=e.size||s.size,g=P(e.scale??1).scale(l/s.size),y=e.lineSpacing??0,m=e.letterSpacing??0,c=0,w=0,T=0,U=[],q=[],Y=0,I=null,G=null;for(;Y<h.length;){let ct=h[Y];if(ct===`
`)T+=l+y,U.push({width:c-m,chars:q}),I=null,G=null,c=0,q=[];else{let at=s.map[ct];if(at){let A=at.w*g.x;e.width&&c+A>e.width&&(T+=l+y,I!=null&&(Y-=q.length-I,ct=h[Y],at=s.map[ct],A=at.w*g.x,q=q.slice(0,I-1),c=G),I=null,G=null,U.push({width:c-m,chars:q}),c=0,q=[]),q.push({tex:s.tex,width:at.w,height:at.h,quad:new Et(at.x/s.tex.width,at.y/s.tex.height,at.w/s.tex.width,at.h/s.tex.height),ch:ct,pos:new E(c,T),opacity:e.opacity??1,color:e.color??ot.WHITE,scale:P(g),angle:0}),ct===" "&&(I=q.length,G=c),c+=A,w=Math.max(w,c),c+=m}}Y++}U.push({width:c-m,chars:q}),T+=l,e.width&&(w=e.width);let It=[];for(let ct of U){let at=(w-ct.width)*_n(e.align??"left");for(let A of ct.chars){let D=s.map[A.ch],k=It.length;if(A.pos=A.pos.add(at,0).add(D.w*g.x*.5,D.h*g.y*.5),e.transform){let L=typeof e.transform=="function"?e.transform(k,A.ch):e.transform;L&&pr(A,L)}if(n[k]){let L=n[k];for(let J of L){let X=e.styles[J],nt=typeof X=="function"?X(k,A.ch):X;nt&&pr(A,nt)}}It.push(A)}}return{width:w,height:T,chars:It,opt:e}}o(ie,"formatText");function mr(e){re(ie(e))}o(mr,"drawText");function re(e){At(),st(e.opt.pos),ut(e.opt.angle),st(me(e.opt.anchor??"topleft").add(1,1).scale(e.width,e.height).scale(-.5)),e.chars.forEach(s=>{zt({tex:s.tex,width:s.width,height:s.height,pos:s.pos,scale:s.scale,angle:s.angle,color:s.color,opacity:s.opacity,quad:s.quad,anchor:"center",uniform:e.opt.uniform,shader:e.opt.shader,fixed:e.opt.fixed})}),gt()}o(re,"drawFormattedText");function Mt(){return V.width}o(Mt,"width");function Pt(){return V.height}o(Pt,"height");function $r(e){return new E((e.x-V.viewport.x)*Mt()/V.viewport.width,(e.y-V.viewport.y)*Pt()/V.viewport.height)}o($r,"windowToContent");function _r(e){return new E(e.x*V.viewport.width/V.width,e.y*V.viewport.height/V.height)}o(_r,"contentToView");function hi(){return $r(v.mousePos())}o(hi,"mousePos");let ts=!1,lt={inspect:!1,timeScale:1,showLog:!0,fps:()=>v.fps(),numFrames:()=>v.numFrames(),stepFrame:Mr,drawCalls:()=>V.lastDrawCalls,clearLog:()=>R.logs=[],log:e=>{let s=i.logMax??Ko;R.logs.unshift({msg:e,time:v.time()}),R.logs.length>s&&(R.logs=R.logs.slice(0,s))},error:e=>lt.log(new Error(e.toString?e.toString():e)),curRecording:null,numObjects:()=>Er("*",{recursive:!0}).length,get paused(){return ts},set paused(e){ts=e,e?j.ctx.suspend():j.ctx.resume()}};function Ht(){return v.dt()*lt.timeScale}o(Ht,"dt");function es(...e){return e.length>0&&(R.cam.pos=P(...e)),R.cam.pos?R.cam.pos.clone():fi()}o(es,"camPos");function is(...e){return e.length>0&&(R.cam.scale=P(...e)),R.cam.scale.clone()}o(is,"camScale");function rs(e){return e!==void 0&&(R.cam.angle=e),R.cam.angle}o(rs,"camRot");function ss(e=12){R.cam.shake+=e}o(ss,"shake");function wr(e){return R.cam.transform.multVec2(e)}o(wr,"toScreen");function Ar(e){return R.cam.transform.invert().multVec2(e)}o(Ar,"toWorld");function ui(e){let s=new Kt;return e.pos&&s.translate(e.pos),e.scale&&s.scale(e.scale),e.angle&&s.rotate(e.angle),e.parent?s.mult(e.parent.transform):s}o(ui,"calcTransform");function Hi(e=[]){let s=new Map,n={},a=new Ai,h=[],l=null,g=!1,y={id:Bo(),hidden:!1,transform:new Kt,children:[],parent:null,set paused(c){if(c!==g){g=c;for(let w of h)w.paused=c}},get paused(){return g},add(c=[]){let w=Array.isArray(c)?Hi(c):c;if(w.parent)throw new Error("Cannot add a game obj that already has a parent.");return w.parent=this,w.transform=ui(w),this.children.push(w),w.trigger("add",w),R.events.trigger("add",w),w},readd(c){let w=this.children.indexOf(c);return w!==-1&&(this.children.splice(w,1),this.children.push(c)),c},remove(c){let w=this.children.indexOf(c);if(w!==-1){c.parent=null,this.children.splice(w,1);let T=o(U=>{U.trigger("destroy"),R.events.trigger("destroy",U),U.children.forEach(q=>T(q))},"trigger");T(c)}},removeAll(c){if(c)this.get(c).forEach(w=>this.remove(w));else for(let w of[...this.children])this.remove(w)},update(){this.paused||(this.children.sort((c,w)=>(c.z??0)-(w.z??0)).forEach(c=>c.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&this.canvas.bind();let c=V.fixed;this.fixed&&(V.fixed=!0),At(),st(this.pos),Yt(this.scale),ut(this.angle);let w=this.children.sort((T,U)=>(T.z??0)-(U.z??0));if(this.mask){let T={intersect:oi,subtract:ai}[this.mask];if(!T)throw new Error(`Invalid mask func: "${this.mask}"`);T(()=>{w.forEach(U=>U.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),w.forEach(T=>T.draw());gt(),V.fixed=c,this.canvas&&this.canvas.unbind()},drawInspect(){this.hidden||(At(),st(this.pos),Yt(this.scale),ut(this.angle),this.children.sort((c,w)=>(c.z??0)-(w.z??0)).forEach(c=>c.drawInspect()),this.trigger("drawInspect"),gt())},use(c){if(!c)return;if(typeof c=="string")return this.use({id:c});let w=[];c.id&&(this.unuse(c.id),n[c.id]=[],w=n[c.id],s.set(c.id,c));for(let U in c){if(_o.has(U))continue;let q=Object.getOwnPropertyDescriptor(c,U);if(typeof q.value=="function"&&(c[U]=c[U].bind(this)),q.set&&Object.defineProperty(c,U,{set:q.set.bind(this)}),q.get&&Object.defineProperty(c,U,{get:q.get.bind(this)}),ta.has(U)){let Y=U==="add"?()=>{l=o(I=>w.push(I),"onCurCompCleanup"),c[U](),l=null}:c[U];w.push(this.on(U,Y).cancel)}else if(this[U]===void 0)Object.defineProperty(this,U,{get:()=>c[U],set:Y=>c[U]=Y,configurable:!0,enumerable:!0}),w.push(()=>delete this[U]);else throw new Error(`Duplicate component property: "${U}"`)}let T=o(()=>{if(c.require){for(let U of c.require)if(!this.c(U))throw new Error(`Component "${c.id}" requires component "${U}"`)}},"checkDeps");c.destroy&&w.push(c.destroy.bind(this)),this.exists()?(T(),c.add&&(l=o(U=>w.push(U),"onCurCompCleanup"),c.add.call(this),l=null)):c.require&&w.push(this.on("add",T).cancel)},unuse(c){n[c]&&(n[c].forEach(w=>w()),delete n[c]),s.has(c)&&s.delete(c)},c(c){return s.get(c)},get(c,w={}){let T=w.recursive?this.children.flatMap(o(function U(q){return[q,...q.children.flatMap(U)]},"recurse")):this.children;if(T=T.filter(U=>c?U.is(c):!0),w.liveUpdate){let U=o(Y=>w.recursive?this.isAncestorOf(Y):Y.parent===this,"isChild"),q=[];q.push(yr(Y=>{U(Y)&&Y.is(c)&&T.push(Y)})),q.push(ns(Y=>{if(U(Y)&&Y.is(c)){let I=T.findIndex(G=>G.id===Y.id);I!==-1&&T.splice(I,1)}})),this.onDestroy(()=>{for(let Y of q)Y.cancel()})}return T},isAncestorOf(c){return c.parent?c.parent===this||this.isAncestorOf(c.parent):!1},exists(){return R.root.isAncestorOf(this)},is(c){if(c==="*")return!0;if(Array.isArray(c)){for(let w of c)if(!this.c(w))return!1;return!0}else return this.c(c)!=null},on(c,w){let T=a.on(c,w.bind(this));return l&&l(()=>T.cancel()),T},trigger(c,...w){a.trigger(c,...w),R.objEvents.trigger(c,this,...w)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let c={};for(let[w,T]of s)c[w]=T.inspect?T.inspect():null;return c},onAdd(c){return this.on("add",c)},onUpdate(c){return this.on("update",c)},onDraw(c){return this.on("draw",c)},onDestroy(c){return this.on("destroy",c)},clearEvents(){a.clear()}},m=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick"];for(let c of m)y[c]=(...w)=>{let T=v[c](...w);return h.push(T),y.onDestroy(()=>T.cancel()),T};for(let c of e)y.use(c);return y}o(Hi,"make");function Jt(e,s,n){return R.objEvents[e]||(R.objEvents[e]=new Dn),R.objEvents.on(e,(a,...h)=>{a.is(s)&&n(a,...h)})}o(Jt,"on");let no=Ut(e=>{let s=pi([{update:e}]);return{get paused(){return s.paused},set paused(n){s.paused=n},cancel:()=>s.destroy()}},(e,s)=>Jt("update",e,s)),oo=Ut(e=>{let s=pi([{draw:e}]);return{get paused(){return s.hidden},set paused(n){s.hidden=n},cancel:()=>s.destroy()}},(e,s)=>Jt("draw",e,s)),yr=Ut(e=>R.events.on("add",e),(e,s)=>Jt("add",e,s)),ns=Ut(e=>R.events.on("destroy",e),(e,s)=>Jt("destroy",e,s));function os(e,s,n){return Jt("collide",e,(a,h,l)=>h.is(s)&&n(a,h,l))}o(os,"onCollide");function as(e,s,n){return Jt("collideUpdate",e,(a,h,l)=>h.is(s)&&n(a,h,l))}o(as,"onCollideUpdate");function hs(e,s,n){return Jt("collideEnd",e,(a,h,l)=>h.is(s)&&n(a,h,l))}o(hs,"onCollideEnd");function li(e,s){Er(e,{recursive:!0}).forEach(s),yr(e,s)}o(li,"forAllCurrentAndFuture");let ao=Ut(e=>v.onMousePress(e),(e,s)=>{let n=[];return li(e,a=>{if(!a.area)throw new Error("onClick() requires the object to have area() component");n.push(a.onClick(()=>s(a)))}),Ne.join(n)});function us(e,s){let n=[];return li(e,a=>{if(!a.area)throw new Error("onHover() requires the object to have area() component");n.push(a.onHover(()=>s(a)))}),Ne.join(n)}o(us,"onHover");function ls(e,s){let n=[];return li(e,a=>{if(!a.area)throw new Error("onHoverUpdate() requires the object to have area() component");n.push(a.onHoverUpdate(()=>s(a)))}),Ne.join(n)}o(ls,"onHoverUpdate");function cs(e,s){let n=[];return li(e,a=>{if(!a.area)throw new Error("onHoverEnd() requires the object to have area() component");n.push(a.onHoverEnd(()=>s(a)))}),Ne.join(n)}o(cs,"onHoverEnd");function ds(e){R.gravity=e}o(ds,"setGravity");function fs(){return R.gravity}o(fs,"getGravity");function ps(...e){e.length===1||e.length===2?(V.bgColor=et(e[0]),e[1]&&(V.bgAlpha=e[1])):(e.length===3||e.length===4)&&(V.bgColor=et(e[0],e[1],e[2]),e[3]&&(V.bgAlpha=e[3])),S.clearColor(V.bgColor.r/255,V.bgColor.g/255,V.bgColor.b/255,V.bgAlpha)}o(ps,"setBackground");function gs(){return V.bgColor.clone()}o(gs,"getBackground");function ci(...e){return{id:"pos",pos:P(...e),moveBy(...s){this.pos=this.pos.add(P(...s))},move(...s){this.moveBy(P(...s).scale(Ht()))},moveTo(...s){if(typeof s[0]=="number"&&typeof s[1]=="number")return this.moveTo(P(s[0],s[1]),s[2]);let n=s[0],a=s[1];if(a===void 0){this.pos=P(n);return}let h=n.sub(this.pos);if(h.len()<=a*Ht()){this.pos=P(n);return}this.move(h.unit().scale(a))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){let s=this.worldPos();return Ie(this)?s:wr(s)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){Q({color:et(255,0,0),radius:4/jt()})}}}o(ci,"pos");function di(...e){return e.length===0?di(1):{id:"scale",scale:P(...e),scaleTo(...s){this.scale=P(...s)},scaleBy(...s){this.scale.scale(P(...s))},inspect(){return`(${ke(this.scale.x,2)}, ${ke(this.scale.y,2)})`}}}o(di,"scale");function ms(e){return{id:"rotate",angle:e??0,rotateBy(s){this.angle+=s},rotateTo(s){this.angle=s},inspect(){return`${Math.round(this.angle)}`}}}o(ms,"rotate");function ws(...e){return{id:"color",color:et(...e),inspect(){return this.color.toString()}}}o(ws,"color");function ke(e,s){return Number(e.toFixed(s))}o(ke,"toFixed");function As(e){return{id:"opacity",opacity:e??1,inspect(){return`${ke(this.opacity,1)}`},fadeOut(s=1,n=Zi.linear){return Sr(this.opacity,0,s,a=>this.opacity=a,n)}}}o(As,"opacity");function qi(e){if(!e)throw new Error("Please define an anchor");return{id:"anchor",anchor:e,inspect(){return typeof this.anchor=="string"?this.anchor:this.anchor.toString()}}}o(qi,"anchor");function ys(e){return{id:"z",z:e,inspect(){return`${this.z}`}}}o(ys,"z");function vs(e,s){return{id:"follow",require:["pos"],follow:{obj:e,offset:s??P(0)},add(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}o(vs,"follow");function Vs(e,s){let n=typeof e=="number"?E.fromAngle(e):e.unit();return{id:"move",require:["pos"],update(){this.move(n.scale(s))}}}o(Vs,"move");let ho=200;function xs(e={}){let s=e.distance??ho,n=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let a=this.screenPos(),h=new Tt(P(0),Mt(),Pt());return!xi(h,a)&&h.sdistToPoint(a)>s*s},onExitScreen(a){return this.on("exitView",a)},onEnterScreen(a){return this.on("enterView",a)},update(){this.isOffScreen()?(n||(this.trigger("exitView"),n=!0),e.hide&&(this.hidden=!0),e.pause&&(this.paused=!0),e.destroy&&this.destroy()):(n&&(this.trigger("enterView"),n=!1),e.hide&&(this.hidden=!1),e.pause&&(this.paused=!1))}}}o(xs,"offscreen");function Ie(e){return e.fixed?!0:e.parent?Ie(e.parent):!1}o(Ie,"isFixed");function bs(e={}){let s={},n=new Set;return{id:"area",collisionIgnore:e.collisionIgnore??[],add(){this.area.cursor&&this.onHover(()=>v.setCursor(this.area.cursor)),this.onCollideUpdate((a,h)=>{s[a.id]||this.trigger("collide",a,h),s[a.id]=h,n.add(a.id)})},update(){for(let a in s)n.has(Number(a))||(this.trigger("collideEnd",s[a].target),delete s[a]);n.clear()},drawInspect(){let a=this.localArea();At(),Yt(this.area.scale),st(this.area.offset);let h={outline:{width:4/jt(),color:et(0,0,255)},anchor:this.anchor,fill:!1,fixed:Ie(this)};a instanceof Tt?Rt({...h,pos:a.pos,width:a.width,height:a.height}):a instanceof wi?vt({...h,pts:a.pts}):a instanceof ln&&Q({...h,pos:a.center,radius:a.radius}),gt()},area:{shape:e.shape??null,scale:e.scale?P(e.scale):P(1),offset:e.offset??P(0),cursor:e.cursor??null},isClicked(){return v.isMousePressed()&&this.isHovering()},isHovering(){let a=Ie(this)?hi():Ar(hi());return this.hasPoint(a)},checkCollision(a){return s[a.id]??null},getCollisions(){return Object.values(s)},isColliding(a){return!!s[a.id]},isOverlapping(a){let h=s[a.id];return h&&h.hasOverlap()},onClick(a){let h=v.onMousePress("left",()=>{this.isHovering()&&a()});return this.onDestroy(()=>h.cancel()),h},onHover(a){let h=!1;return this.onUpdate(()=>{h?h=this.isHovering():this.isHovering()&&(h=!0,a())})},onHoverUpdate(a){return this.onUpdate(()=>{this.isHovering()&&a()})},onHoverEnd(a){let h=!1;return this.onUpdate(()=>{h?this.isHovering()||(h=!1,a()):h=this.isHovering()})},onCollide(a,h){if(typeof a=="function"&&h===void 0)return this.on("collide",a);if(typeof a=="string")return this.onCollide((l,g)=>{l.is(a)&&h(l,g)})},onCollideUpdate(a,h){if(typeof a=="function"&&h===void 0)return this.on("collideUpdate",a);if(typeof a=="string")return this.on("collideUpdate",(l,g)=>l.is(a)&&h(l,g))},onCollideEnd(a,h){if(typeof a=="function"&&h===void 0)return this.on("collideEnd",a);if(typeof a=="string")return this.on("collideEnd",l=>l.is(a)&&h(l))},hasPoint(a){return Wr(this.worldArea(),a)},resolveCollision(a){let h=this.checkCollision(a);h&&!h.resolved&&(this.pos=this.pos.add(h.displacement),h.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let a=this.localArea();if(!(a instanceof wi||a instanceof Tt))throw new Error("Only support polygon and rect shapes for now");let h=this.transform.clone().scale(P(this.area.scale??1)).translate(this.area.offset);if(a instanceof Tt){let l=me(this.anchor||$i).add(1,1).scale(-.5).scale(a.width,a.height);h.translate(l)}return a.transform(h)},screenArea(){let a=this.worldArea();return Ie(this)?a:a.transform(R.cam.transform)}}}o(bs,"area");function se(e){return{color:e.color,opacity:e.opacity,anchor:e.anchor,outline:e.outline,shader:e.shader,uniform:e.uniform}}o(se,"getRenderProps");function Yi(e,s={}){let n=null,a=null,h=null,l=new qt;if(!e)throw new Error("Please pass the resource name or data to sprite()");let g=o((y,m,c,w)=>{let T=P(1,1);return c&&w?(T.x=c/(y.width*m.w),T.y=w/(y.height*m.h)):c?(T.x=c/(y.width*m.w),T.y=T.x):w&&(T.y=w/(y.height*m.h),T.x=T.y),T},"calcTexScale");return{id:"sprite",width:0,height:0,frame:s.frame||0,quad:s.quad||new Et(0,0,1,1),animSpeed:s.animSpeed??1,flipX:s.flipX??!1,flipY:s.flipY??!1,draw(){if(!n)return;let y=n.frames[this.frame??0];if(!y)throw new Error(`Frame not found: ${this.frame??0}`);if(n.slice9){let{left:m,right:c,top:w,bottom:T}=n.slice9,U=n.tex.width*y.w,q=n.tex.height*y.h,Y=this.width-m-c,I=this.height-w-T,G=m/U,It=c/U,yt=1-G-It,Vt=w/q,ct=T/q,at=1-Vt-ct,A=[wt(0,0,G,Vt),wt(G,0,yt,Vt),wt(G+yt,0,It,Vt),wt(0,Vt,G,at),wt(G,Vt,yt,at),wt(G+yt,Vt,It,at),wt(0,Vt+at,G,ct),wt(G,Vt+at,yt,ct),wt(G+yt,Vt+at,It,ct),wt(0,0,m,w),wt(m,0,Y,w),wt(m+Y,0,c,w),wt(0,w,m,I),wt(m,w,Y,I),wt(m+Y,w,c,I),wt(0,w+I,m,T),wt(m,w+I,Y,T),wt(m+Y,w+I,c,T)];for(let D=0;D<9;D++){let k=A[D],L=A[D+9];ee(Object.assign(se(this),{pos:L.pos(),tex:n.tex,quad:y.scale(k),flipX:this.flipX,flipY:this.flipY,tiled:s.tiled,width:L.w,height:L.h}))}}else ee(Object.assign(se(this),{tex:n.tex,quad:y.scale(this.quad??new Et(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:s.tiled,width:this.width,height:this.height}))},add(){let y=o(c=>{let w=c.frames[0].clone();s.quad&&(w=w.scale(s.quad));let T=g(c.tex,w,s.width,s.height);this.width=c.tex.width*w.w*T.x,this.height=c.tex.height*w.h*T.y,s.anim&&this.play(s.anim),n=c,l.trigger(n)},"setSpriteData"),m=he(e);m?m.onLoad(y):Ki(()=>y(he(e).data))},update(){if(!a)return;let y=n.anims[a.name];if(typeof y=="number"){this.frame=y;return}if(y.speed===0)throw new Error("Sprite anim speed cannot be 0");a.timer+=Ht()*this.animSpeed,a.timer>=1/a.speed&&(a.timer=0,this.frame+=h,(this.frame<Math.min(y.from,y.to)||this.frame>Math.max(y.from,y.to))&&(a.loop?a.pingpong?(this.frame-=h,h*=-1,this.frame+=h):this.frame=y.from:(this.frame=y.to,a.onEnd(),this.stop())))},play(y,m={}){if(!n){l.add(()=>this.play(y,m));return}let c=n.anims[y];if(c===void 0)throw new Error(`Anim not found: ${y}`);a&&this.stop(),a=typeof c=="number"?{name:y,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:y,timer:0,loop:m.loop??c.loop??!1,pingpong:m.pingpong??c.pingpong??!1,speed:m.speed??c.speed??10,onEnd:m.onEnd??(()=>{})},h=typeof c=="number"?null:c.from<c.to?1:-1,this.frame=typeof c=="number"?c:c.from,this.trigger("animStart",y)},stop(){if(!a)return;let y=a.name;a=null,this.trigger("animEnd",y)},numFrames(){return(n==null?void 0:n.frames.length)??0},curAnim(){return a==null?void 0:a.name},onAnimEnd(y){return this.on("animEnd",y)},onAnimStart(y){return this.on("animStart",y)},renderArea(){return new Tt(P(0),this.width,this.height)},inspect(){if(typeof e=="string")return`"${e}"`}}}o(Yi,"sprite");function Es(e,s={}){function n(h){var g,y;let l=ie(Object.assign(se(h),{text:h.text+"",size:h.textSize,font:h.font,width:s.width&&h.width,align:h.align,letterSpacing:h.letterSpacing,lineSpacing:h.lineSpacing,transform:h.textTransform,styles:h.textStyles}));return s.width||(h.width=l.width/(((g=h.scale)==null?void 0:g.x)||1)),h.height=l.height/(((y=h.scale)==null?void 0:y.y)||1),l}o(n,"update");let a={id:"text",set text(h){e=h,n(this)},get text(){return e},textSize:s.size??Yo,font:s.font,width:s.width??0,height:0,align:s.align,lineSpacing:s.lineSpacing,letterSpacing:s.letterSpacing,textTransform:s.transform,textStyles:s.styles,add(){Ki(()=>n(this))},draw(){re(n(this))},renderArea(){return new Tt(P(0),this.width,this.height)}};return n(a),a}o(Es,"text");function Ss(e,s={}){if(e.length<3)throw new Error(`Polygon's need more than two points, ${e.length} points provided`);return{id:"polygon",pts:e,colors:s.colors,radius:s.radius,draw(){vt(Object.assign(se(this),{pts:this.pts,colors:this.colors,radius:this.radius,fill:s.fill}))},renderArea(){return new wi(this.pts)},inspect(){return this.pts.map(n=>`[${n.x},${n.y}]`).join(",")}}}o(Ss,"polygon");function Rs(e,s,n={}){return{id:"rect",width:e,height:s,radius:n.radius||0,draw(){Rt(Object.assign(se(this),{width:this.width,height:this.height,radius:this.radius,fill:n.fill}))},renderArea(){return new Tt(P(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}o(Rs,"rect");function Ms(e,s){return{id:"rect",width:e,height:s,draw(){zt(Object.assign(se(this),{width:this.width,height:this.height}))},renderArea(){return new Tt(P(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}o(Ms,"uvquad");function Bs(e,s={}){return{id:"circle",radius:e,draw(){Q(Object.assign(se(this),{radius:this.radius,fill:s.fill}))},renderArea(){return new Tt(new E(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`${Math.ceil(this.radius)}`}}}o(Bs,"circle");function Ps(e=1,s=et(0,0,0)){return{id:"outline",outline:{width:e,color:s}}}o(Ps,"outline");function zi(){return{id:"timer",wait(e,s){let n=[];s&&n.push(s);let a=0,h=this.onUpdate(()=>{a+=Ht(),a>=e&&(n.forEach(l=>l()),h.cancel())});return{get paused(){return h.paused},set paused(l){h.paused=l},cancel:h.cancel,onEnd(l){n.push(l)},then(l){return this.onEnd(l),this}}},loop(e,s){let n=null,a=o(()=>{n=this.wait(e,a),s()},"newAction");return n=this.wait(0,a),{get paused(){return n.paused},set paused(h){n.paused=h},cancel:()=>n.cancel()}},tween(e,s,n,a,h=Zi.linear){let l=0,g=[],y=this.onUpdate(()=>{l+=Ht();let m=Math.min(l/n,1);a(te(e,s,h(m))),m===1&&(y.cancel(),a(s),g.forEach(c=>c()))});return{get paused(){return y.paused},set paused(m){y.paused=m},onEnd(m){g.push(m)},then(m){return this.onEnd(m),this},cancel(){y.cancel()},finish(){y.cancel(),a(s),g.forEach(m=>m())}}}}}o(zi,"timer");let uo=640,lo=65536;function Ts(e={}){let s=null,n=null,a=!1;return{id:"body",require:["pos","area"],vel:new E(0),jumpForce:e.jumpForce??uo,gravityScale:e.gravityScale??1,isStatic:e.isStatic??!1,mass:e.mass??1,add(){if(this.mass===0)throw new Error("Can't set body mass to 0");this.onCollideUpdate((h,l)=>{if(h.is("body")&&!l.resolved&&(this.trigger("beforePhysicsResolve",l),h.trigger("beforePhysicsResolve",l.reverse()),!l.resolved&&!(this.isStatic&&h.isStatic))){if(!this.isStatic&&!h.isStatic){let g=this.mass+h.mass;this.pos=this.pos.add(l.displacement.scale(h.mass/g)),h.pos=h.pos.add(l.displacement.scale(-this.mass/g)),this.transform=ui(this),h.transform=ui(h)}else{let g=!this.isStatic&&h.isStatic?l:l.reverse();g.source.pos=g.source.pos.add(g.displacement),g.source.transform=ui(g.source)}l.resolved=!0,this.trigger("physicsResolve",l),h.trigger("physicsResolve",l.reverse())}}),this.onPhysicsResolve(h=>{R.gravity&&(h.isBottom()&&this.isFalling()?(this.vel.y=0,s=h.target,n=h.target.pos,a?a=!1:this.trigger("ground",s)):h.isTop()&&this.isJumping()&&(this.vel.y=0,this.trigger("headbutt",h.target)))})},update(){if(!R.gravity||this.isStatic)return;if(a&&(s=null,n=null,this.trigger("fallOff"),a=!1),s)if(!this.isColliding(s)||!s.exists()||!s.is("body"))a=!0;else{!s.pos.eq(n)&&e.stickToPlatform!==!1&&this.moveBy(s.pos.sub(n)),n=s.pos;return}let h=this.vel.y;this.vel.y+=R.gravity*this.gravityScale*Ht(),this.vel.y=Math.min(this.vel.y,e.maxVelocity??lo),h<0&&this.vel.y>=0&&this.trigger("fall"),this.move(this.vel)},onPhysicsResolve(h){return this.on("physicsResolve",h)},onBeforePhysicsResolve(h){return this.on("beforePhysicsResolve",h)},curPlatform(){return s},isGrounded(){return s!==null},isFalling(){return this.vel.y>0},isJumping(){return this.vel.y<0},jump(h){s=null,n=null,this.vel.y=-h||-this.jumpForce},onGround(h){return this.on("ground",h)},onFall(h){return this.on("fall",h)},onFallOff(h){return this.on("fallOff",h)},onHeadbutt(h){return this.on("headbutt",h)}}}o(Ts,"body");function Fs(e=2){let s=e;return{id:"doubleJump",require:["body"],numJumps:e,add(){this.onGround(()=>{s=this.numJumps})},doubleJump(n){s<=0||(s<this.numJumps&&this.trigger("doubleJump"),s--,this.jump(n))},onDoubleJump(n){return this.on("doubleJump",n)},inspect(){return`${s}`}}}o(Fs,"doubleJump");function Cs(e,s){return{id:"shader",shader:e,...typeof s=="function"?{uniform:s(),update(){this.uniform=s()}}:{uniform:s}}}o(Cs,"shader");function ks(){return{id:"fixed",fixed:!0}}o(ks,"fixed");function vr(e){return{id:"stay",stay:!0,scenesToStay:e}}o(vr,"stay");function Is(e,s){if(e==null)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(n=1){this.setHP(e-n),this.trigger("hurt",n)},heal(n=1){let a=e;this.setHP(e+n),this.trigger("heal",e-a)},hp(){return e},maxHP(){return s??null},setMaxHP(n){s=n},setHP(n){e=s?Math.min(s,n):n,e<=0&&this.trigger("death")},onHurt(n){return this.on("hurt",n)},onHeal(n){return this.on("heal",n)},onDeath(n){return this.on("death",n)},inspect(){return`${e}`}}}o(Is,"health");function Ds(e,s={}){if(e==null)throw new Error("lifespan() requires time");let n=s.fade??0;return{id:"lifespan",async add(){await Xs(e),n>0&&this.opacity&&await Sr(this.opacity,0,n,a=>this.opacity=a,Zi.linear),this.destroy()}}}o(Ds,"lifespan");function Us(e,s,n){if(!e)throw new Error("state() requires an initial state");let a={};function h(m){a[m]||(a[m]={enter:new qt,end:new qt,update:new qt,draw:new qt})}o(h,"initStateEvents");function l(m,c,w){return h(c),a[c][m].add(w)}o(l,"on");function g(m,c,...w){h(c),a[c][m].trigger(...w)}o(g,"trigger");let y=!1;return{id:"state",state:e,enterState(m,...c){if(y=!0,s&&!s.includes(m))throw new Error(`State not found: ${m}`);let w=this.state;if(n){if(!(n!=null&&n[w]))return;let T=typeof n[w]=="string"?[n[w]]:n[w];if(!T.includes(m))throw new Error(`Cannot transition state from "${w}" to "${m}". Available transitions: ${T.map(U=>`"${U}"`).join(", ")}`)}g("end",w,...c),this.state=m,g("enter",m,...c),g("enter",`${w} -> ${m}`,...c)},onStateTransition(m,c,w){return l("enter",`${m} -> ${c}`,w)},onStateEnter(m,c){return l("enter",m,c)},onStateUpdate(m,c){return l("update",m,c)},onStateDraw(m,c){return l("draw",m,c)},onStateEnd(m,c){return l("end",m,c)},update(){y||(g("enter",e),y=!0),g("update",this.state)},draw(){g("draw",this.state)},inspect(){return this.state}}}o(Us,"state");function Ns(e=1){let s=0,n=!1;return{require:["opacity"],add(){this.opacity=0},update(){n||(s+=Ht(),this.opacity=oe(s,0,e,0,1),s>=e&&(this.opacity=1,n=!0))}}}o(Ns,"fadeIn");function Os(e="intersect"){return{id:"mask",mask:e}}o(Os,"mask");function Ls(e){return{add(){this.canvas=e}}}o(Ls,"drawon");function Ki(e){O.loaded?e():R.events.on("load",e)}o(Ki,"onLoad");function Gs(e,s){R.scenes[e]=s}o(Gs,"scene");function js(e,...s){if(!R.scenes[e])throw new Error(`Scene not found: ${e}`);R.events.onOnce("frameEnd",()=>{R.events.trigger("sceneLeave",e),v.events.clear(),R.events.clear(),R.objEvents.clear(),[...R.root.children].forEach(n=>{(!n.stay||n.scenesToStay&&!n.scenesToStay.includes(e))&&R.root.remove(n)}),R.root.clearEvents(),Fr(),R.cam={pos:null,scale:P(1),angle:0,shake:0,transform:new Kt},R.scenes[e](...s)})}o(js,"go");function Hs(e){return R.events.on("sceneLeave",e)}o(Hs,"onSceneLeave");function qs(e,s){try{return JSON.parse(window.localStorage[e])}catch{return s?(Vr(e,s),s):null}}o(qs,"getData");function Vr(e,s){window.localStorage[e]=JSON.stringify(s)}o(Vr,"setData");function xr(e,...s){let n=e(fe),a;typeof n=="function"?a=n(...s)(fe):a=n;for(let h in a)fe[h]=a[h],i.global!==!1&&(window[h]=a[h]);return fe}o(xr,"plug");function fi(){return P(Mt()/2,Pt()/2)}o(fi,"center");let co;(e=>(e[e.None=0]="None",e[e.Left=1]="Left",e[e.Top=2]="Top",e[e.LeftTop=3]="LeftTop",e[e.Right=4]="Right",e[e.Horizontal=5]="Horizontal",e[e.RightTop=6]="RightTop",e[e.HorizontalTop=7]="HorizontalTop",e[e.Bottom=8]="Bottom",e[e.LeftBottom=9]="LeftBottom",e[e.Vertical=10]="Vertical",e[e.LeftVertical=11]="LeftVertical",e[e.RightBottom=12]="RightBottom",e[e.HorizontalBottom=13]="HorizontalBottom",e[e.RightVertical=14]="RightVertical",e[e.All=15]="All"))(co||(co={}));function br(e={}){let s=P(0),n=e.isObstacle??!1,a=e.cost??0,h=e.edges??[],l=o(()=>{let y={left:1,top:2,right:4,bottom:8};return h.map(m=>y[m]||0).reduce((m,c)=>m|c,0)},"getEdgeMask"),g=l();return{id:"tile",tilePosOffset:e.offset??P(0),set tilePos(y){let m=this.getLevel();s=y.clone(),this.pos=P(this.tilePos.x*m.tileWidth(),this.tilePos.y*m.tileHeight()).add(this.tilePosOffset)},get tilePos(){return s},set isObstacle(y){n!==y&&(n=y,this.getLevel().invalidateNavigationMap())},get isObstacle(){return n},set cost(y){a!==y&&(a=y,this.getLevel().invalidateNavigationMap())},get cost(){return a},set edges(y){h=y,g=l(),this.getLevel().invalidateNavigationMap()},get edges(){return h},get edgeMask(){return g},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(P(-1,0))},moveRight(){this.tilePos=this.tilePos.add(P(1,0))},moveUp(){this.tilePos=this.tilePos.add(P(0,-1))},moveDown(){this.tilePos=this.tilePos.add(P(0,1))}}}o(br,"tile");function Ys(e,s){if(!s.tileWidth||!s.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let n=pi([ci(s.pos??P(0))]),a=e.length,h=0,l=null,g=null,y=null,m=null,c=o(A=>A.x+A.y*h,"tile2Hash"),w=o(A=>P(Math.floor(A%h),Math.floor(A/h)),"hash2Tile"),T=o(()=>{l=[];for(let A of n.children)U(A)},"createSpatialMap"),U=o(A=>{let D=c(A.tilePos);l[D]?l[D].push(A):l[D]=[A]},"insertIntoSpatialMap"),q=o(A=>{let D=c(A.tilePos);if(l[D]){let k=l[D].indexOf(A);k>=0&&l[D].splice(k,1)}},"removeFromSpatialMap"),Y=o(()=>{let A=!1;for(let D of n.children){let k=n.pos2Tile(D.pos);(D.tilePos.x!=k.x||D.tilePos.y!=k.y)&&(A=!0,q(D),D.tilePos.x=k.x,D.tilePos.y=k.y,U(D))}A&&n.trigger("spatial_map_changed")},"updateSpatialMap"),I=o(()=>{let A=n.getSpatialMap(),D=n.numRows()*n.numColumns();g?g.length=D:g=new Array(D),g.fill(1,0,D);for(let k=0;k<A.length;k++){let L=A[k];if(L){let J=0;for(let X of L)if(X.isObstacle){J=1/0;break}else J+=X.cost;g[k]=J||1}}},"createCostMap"),G=o(()=>{let A=n.getSpatialMap(),D=n.numRows()*n.numColumns();y?y.length=D:y=new Array(D),y.fill(15,0,D);for(let k=0;k<A.length;k++){let L=A[k];if(L){let J=L.length,X=15;for(let nt=0;nt<J;nt++)X|=L[nt].edgeMask;y[k]=X}}},"createEdgeMap"),It=o(()=>{let A=n.numRows()*n.numColumns(),D=o((L,J)=>{let X=[];for(X.push(L);X.length>0;){let nt=X.pop();ct(nt).forEach(bt=>{m[bt]<0&&(m[bt]=J,X.push(bt))})}},"traverse");m?m.length=A:m=new Array(A),m.fill(-1,0,A);let k=0;for(let L=0;L<g.length;L++){if(m[L]>=0){k++;continue}D(L,k),k++}},"createConnectivityMap"),yt=o((A,D)=>g[D],"getCost"),Vt=o((A,D)=>{let k=w(A),L=w(D);return k.dist(L)},"getHeuristic"),ct=o((A,D)=>{let k=[],L=Math.floor(A%h),J=L>0&&y[A]&1&&g[A-1]!==1/0,X=A>=h&&y[A]&2&&g[A-h]!==1/0,nt=L<h-1&&y[A]&4&&g[A+1]!==1/0,bt=A<h*a-h-1&&y[A]&8&&g[A+h]!==1/0;return D?(J&&(X&&k.push(A-h-1),k.push(A-1),bt&&k.push(A+h-1)),X&&k.push(A-h),nt&&(X&&k.push(A-h+1),k.push(A+1),bt&&k.push(A+h+1)),bt&&k.push(A+h)):(J&&k.push(A-1),X&&k.push(A-h),nt&&k.push(A+1),bt&&k.push(A+h)),k},"getNeighbours"),at={id:"level",tileWidth(){return s.tileWidth},tileHeight(){return s.tileHeight},spawn(A,...D){let k=P(...D),L=(()=>{if(typeof A=="string"){if(s.tiles[A]){if(typeof s.tiles[A]!="function")throw new Error("Level symbol def must be a function returning a component list");return s.tiles[A](k)}else if(s.wildcardTile)return s.wildcardTile(A,k)}else{if(Array.isArray(A))return A;throw new Error("Expected a symbol or a component list")}})();if(!L)return null;let J=!1,X=!1;for(let bt of L)bt.id==="tile"&&(X=!0),bt.id==="pos"&&(J=!0);J||L.push(ci()),X||L.push(br());let nt=n.add(L);return J&&(nt.tilePosOffset=nt.pos.clone()),nt.tilePos=k,l&&(U(nt),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),nt},numColumns(){return h},numRows(){return a},levelWidth(){return h*this.tileWidth()},levelHeight(){return a*this.tileHeight()},tile2Pos(...A){return P(...A).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...A){let D=P(...A);return P(Math.floor(D.x/this.tileWidth()),Math.floor(D.y/this.tileHeight()))},getSpatialMap(){return l||T(),l},onSpatialMapChanged(A){return this.on("spatial_map_changed",A)},onNavigationMapInvalid(A){return this.on("navigation_map_invalid",A)},getAt(A){l||T();let D=c(A);return l[D]||[]},update(){l&&Y()},invalidateNavigationMap(){g=null,y=null,m=null},onNavigationMapChanged(A){return this.on("navigation_map_changed",A)},getTilePath(A,D,k={}){var hn;if(g||I(),y||G(),m||It(),A.x<0||A.x>=h||A.y<0||A.y>=a||D.x<0||D.x>=h||D.y<0||D.y>=a)return null;let L=c(A),J=c(D);if(g[J]===1/0)return null;if(L===J)return[];if(m[L]!=-1&&m[L]!==m[J])return null;let X=new To((Zt,Ir)=>Zt.cost<Ir.cost);X.insert({cost:0,node:L});let nt=new Map;nt.set(L,L);let bt=new Map;for(bt.set(L,0);X.length!==0;){let Zt=(hn=X.remove())==null?void 0:hn.node;if(Zt===J)break;let Ir=ct(Zt,k.allowDiagonals);for(let ge of Ir){let Dr=(bt.get(Zt)||0)+yt(Zt,ge)+Vt(ge,J);(!bt.has(ge)||Dr<bt.get(ge))&&(bt.set(ge,Dr),X.insert({cost:Dr,node:ge}),nt.set(ge,Zt))}}let kr=[],gi=J,Ao=w(gi);for(kr.push(Ao);gi!==L;){gi=nt.get(gi);let Zt=w(gi);kr.push(Zt)}return kr.reverse()},getPath(A,D,k={}){let L=this.tileWidth(),J=this.tileHeight(),X=this.getTilePath(this.pos2Tile(A),this.pos2Tile(D),k);return X?[A,...X.slice(1,-1).map(nt=>nt.scale(L,J).add(L/2,J/2)),D]:null}};return n.use(at),n.onNavigationMapInvalid(()=>{n.invalidateNavigationMap(),n.trigger("navigation_map_changed")}),e.forEach((A,D)=>{let k=A.split("");h=Math.max(k.length,h),k.forEach((L,J)=>{n.spawn(L,P(J,D))})}),n}o(Ys,"addLevel");function zs(e={}){let s=null,n=null,a=null,h=null;return{id:"agent",require:["pos","tile"],agentSpeed:e.speed??100,allowDiagonals:e.allowDiagonals??!0,getDistanceToTarget(){return s?this.pos.dist(s):0},getNextLocation(){return n&&a?n[a]:null},getPath(){return n?n.slice():null},getTarget(){return s},isNavigationFinished(){return n?a===null:!0},isTargetReachable(){return n!==null},isTargetReached(){return s?this.pos.eq(s):!0},setTarget(l){s=l,n=this.getLevel().getPath(this.pos,s,{allowDiagonals:this.allowDiagonals}),a=n?0:null,n?(h||(h=this.getLevel().onNavigationMapChanged(()=>{n&&a!==null&&(n=this.getLevel().getPath(this.pos,s,{allowDiagonals:this.allowDiagonals}),a=n?0:null,n?this.trigger("navigation-next",this,n[a]):this.trigger("navigation-ended",this))}),this.onDestroy(()=>h.cancel())),this.trigger("navigation-started",this),this.trigger("navigation-next",this,n[a])):this.trigger("navigation-ended",this)},update(){if(n&&a!==null){if(this.pos.sdist(n[a])<2)if(a===n.length-1){this.pos=s.clone(),a=null,this.trigger("navigation-ended",this),this.trigger("target-reached",this);return}else a++,this.trigger("navigation-next",this,n[a]);this.moveTo(n[a],this.agentSpeed)}},onNavigationStarted(l){return this.on("navigation-started",l)},onNavigationNext(l){return this.on("navigation-next",l)},onNavigationEnded(l){return this.on("navigation-ended",l)},onTargetReached(l){return this.on("target-reached",l)},inspect(){return JSON.stringify({target:JSON.stringify(s),path:JSON.stringify(n)})}}}o(zs,"agent");function Ks(e){let s=v.canvas.captureStream(e),n=j.ctx.createMediaStreamDestination();j.masterNode.connect(n);let a=new MediaRecorder(s),h=[];return a.ondataavailable=l=>{l.data.size>0&&h.push(l.data)},a.onerror=()=>{j.masterNode.disconnect(n),s.getTracks().forEach(l=>l.stop())},a.start(),{resume(){a.resume()},pause(){a.pause()},stop(){return a.stop(),j.masterNode.disconnect(n),s.getTracks().forEach(l=>l.stop()),new Promise(l=>{a.onstop=()=>{l(new Blob(h,{type:"video/mp4"}))}})},download(l="kaboom.mp4"){this.stop().then(g=>jr(l,g))}}}o(Ks,"record");function Qs(){return document.activeElement===v.canvas}o(Qs,"isFocused");function Ws(e){e.destroy()}o(Ws,"destroy");let pi=R.root.add.bind(R.root),fo=R.root.readd.bind(R.root),po=R.root.removeAll.bind(R.root),Er=R.root.get.bind(R.root),Xs=R.root.wait.bind(R.root),go=R.root.loop.bind(R.root),Sr=R.root.tween.bind(R.root);function Rr(e=2,s=1){let n=0;return{require:["scale"],update(){let a=Math.sin(n*e)*s;a<0&&this.destroy(),this.scale=P(a),n+=Ht()}}}o(Rr,"boom");let mo=Wt(null,Go),wo=Wt(null,jo);function Js(e,s={}){let n=pi([ci(e),vr()]),a=(s.speed||1)*5,h=s.scale||1;n.add([Yi(wo),di(0),qi("center"),Rr(a,h),...s.comps??[]]);let l=n.add([Yi(mo),di(0),qi("center"),zi(),...s.comps??[]]);return l.wait(.4/a,()=>l.use(Rr(a,h))),l.onDestroy(()=>n.destroy()),n}o(Js,"addKaboom");function Mr(){R.root.update()}o(Mr,"updateFrame");const Wi=class Wi{constructor(s,n,a,h=!1){x(this,"source");x(this,"target");x(this,"displacement");x(this,"resolved",!1);this.source=s,this.target=n,this.displacement=a,this.resolved=h}reverse(){return new Wi(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}};o(Wi,"Collision");let Br=Wi;function Zs(){let e={},s=i.hashGridSize||zo,n=new Kt,a=[];function h(l){if(a.push(n.clone()),l.pos&&n.translate(l.pos),l.scale&&n.scale(l.scale),l.angle&&n.rotate(l.angle),l.transform=n.clone(),l.c("area")&&!l.paused){let g=l,y=g.worldArea().bbox(),m=Math.floor(y.pos.x/s),c=Math.floor(y.pos.y/s),w=Math.ceil((y.pos.x+y.width)/s),T=Math.ceil((y.pos.y+y.height)/s),U=new Set;for(let q=m;q<=w;q++)for(let Y=c;Y<=T;Y++)if(!e[q])e[q]={},e[q][Y]=[g];else if(!e[q][Y])e[q][Y]=[g];else{let I=e[q][Y];t:for(let G of I){if(G.paused||!G.exists()||U.has(G.id))continue;for(let yt of g.collisionIgnore)if(G.is(yt))continue t;for(let yt of G.collisionIgnore)if(g.is(yt))continue t;let It=In(g.worldArea(),G.worldArea());if(It){let yt=new Br(g,G,It);g.trigger("collideUpdate",G,yt);let Vt=yt.reverse();Vt.resolved=yt.resolved,G.trigger("collideUpdate",g,Vt)}U.add(G.id)}I.push(g)}}l.children.forEach(h),n=a.pop()}o(h,"checkObj"),h(R.root)}o(Zs,"checkFrame");function $s(){let e=R.cam,s=E.fromAngle(Vi(0,360)).scale(e.shake);e.shake=te(e.shake,0,5*Ht()),e.transform=new Kt().translate(fi()).scale(e.scale).rotate(e.angle).translate((e.pos??fi()).scale(-1).add(s)),R.root.draw(),Lt()}o($s,"drawFrame");function _s(){let e=F();R.events.numListeners("loading")>0?R.events.trigger("loading",e):kt(()=>{let s=Mt()/2,n=24,a=P(Mt()/2,Pt()/2).sub(P(s/2,n/2));Rt({pos:P(0),width:Mt(),height:Pt(),color:et(0,0,0)}),Rt({pos:a,width:s,height:n,fill:!1,outline:{width:4}}),Rt({pos:a,width:s*e,height:n})})}o(_s,"drawLoadScreen");function Pr(e,s){kt(()=>{let n=P(8);At(),st(e);let a=ie({text:s,font:_i,size:16,pos:n,color:et(255,255,255),fixed:!0}),h=a.width+n.x*2,l=a.height+n.x*2;e.x+h>=Mt()&&st(P(-h,0)),e.y+l>=Pt()&&st(P(0,-l)),Rt({width:h,height:l,color:et(0,0,0),radius:4,opacity:.8,fixed:!0}),re(a),gt()})}o(Pr,"drawInspectText");function tn(){if(lt.inspect){let e=null;for(let s of R.root.get("*",{recursive:!0}))if(s.c("area")&&s.isHovering()){e=s;break}if(R.root.drawInspect(),e){let s=[],n=e.inspect();for(let a in n)n[a]?s.push(`${a}: ${n[a]}`):s.push(`${a}`);Pr(_r(hi()),s.join(`
`))}Pr(P(8),`FPS: ${lt.fps()}`)}lt.paused&&kt(()=>{At(),st(Mt(),0),st(-8,8);let e=32;Rt({width:e,height:e,anchor:"topright",color:et(0,0,0),opacity:.8,radius:4,fixed:!0});for(let s=1;s<=2;s++)Rt({width:4,height:e*.6,anchor:"center",pos:P(-e/3*s,e*.5),color:et(255,255,255),radius:2,fixed:!0});gt()}),lt.timeScale!==1&&kt(()=>{At(),st(Mt(),Pt()),st(-8,-8);let e=8,s=ie({text:lt.timeScale.toFixed(1),font:_i,size:16,color:et(255,255,255),pos:P(-e),anchor:"botright",fixed:!0});Rt({width:s.width+e*2+e*4,height:s.height+e*2,anchor:"botright",color:et(0,0,0),opacity:.8,radius:4,fixed:!0});for(let n=0;n<2;n++){let a=lt.timeScale<1;B({p1:P(-s.width-e*(a?2:3.5),-e),p2:P(-s.width-e*(a?2:3.5),-e-s.height),p3:P(-s.width-e*(a?3.5:2),-e-s.height/2),pos:P(-n*e*1+(a?-e*.5:0),0),color:et(255,255,255),fixed:!0})}re(s),gt()}),lt.curRecording&&kt(()=>{At(),st(0,Pt()),st(24,-24),Q({radius:12,color:et(255,0,0),opacity:Lr(0,1,v.time()*4),fixed:!0}),gt()}),lt.showLog&&R.logs.length>0&&kt(()=>{var a;At(),st(0,Pt()),st(8,-8);let e=8,s=[];for(let h of R.logs){let l="",g=h.msg instanceof Error?"error":"info";l+=`[time]${h.time.toFixed(2)}[/time]`,l+=" ",l+=`[${g}]${(a=h.msg)!=null&&a.toString?h.msg.toString():h.msg}[/${g}]`,s.push(l)}R.logs=R.logs.filter(h=>v.time()-h.time<(i.logTime||Qo));let n=ie({text:s.join(`
`),font:_i,pos:P(e,-e),anchor:"botleft",size:16,width:Mt()*.6,lineSpacing:e/2,fixed:!0,styles:{time:{color:et(127,127,127)},info:{color:et(255,255,255)},error:{color:et(255,0,127)}}});Rt({width:n.width+e*2,height:n.height+e*2,anchor:"botleft",color:et(0,0,0),radius:4,opacity:.8,fixed:!0}),re(n),gt()})}o(tn,"drawDebug");function en(e){R.events.on("loading",e)}o(en,"onLoading");function rn(e){v.onResize(e)}o(rn,"onResize");function sn(e){R.events.on("error",e)}o(sn,"onError");function nn(e){console.error(e),j.ctx.suspend(),v.run(()=>{ce(),kt(()=>{let s=Mt(),n=Pt(),a={size:36,width:s-32*2,letterSpacing:4,lineSpacing:4,font:_i,fixed:!0};Rt({width:s,height:n,color:et(0,0,255),fixed:!0});let h=ie({...a,text:"Error",pos:P(32),color:et(255,128,0),fixed:!0});re(h),mr({...a,text:e.message,pos:P(32,32+h.height+16),fixed:!0}),gt(),R.events.trigger("error",e)}),de()})}o(nn,"handleErr");function on(e){W.push(e)}o(on,"onCleanup");function an(){R.events.onOnce("frameEnd",()=>{v.quit(),S.clear(S.COLOR_BUFFER_BIT|S.DEPTH_BUFFER_BIT|S.STENCIL_BUFFER_BIT);let e=S.getParameter(S.MAX_TEXTURE_IMAGE_UNITS);for(let s=0;s<e;s++)S.activeTexture(S.TEXTURE0+s),S.bindTexture(S.TEXTURE_2D,null),S.bindTexture(S.TEXTURE_CUBE_MAP,null);S.bindBuffer(S.ARRAY_BUFFER,null),S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,null),S.bindRenderbuffer(S.RENDERBUFFER,null),S.bindFramebuffer(S.FRAMEBUFFER,null),K.destroy(),W.forEach(s=>s())})}o(an,"quit");let Qi=!0;v.run(()=>{try{O.loaded||F()===1&&!Qi&&(O.loaded=!0,R.events.trigger("load")),!O.loaded&&i.loadingScreen!==!1||Qi?(ce(),_s(),de()):(lt.paused||Mr(),Zs(),ce(),$s(),i.debug!==!1&&tn(),de()),Qi&&(Qi=!1),R.events.trigger("frameEnd")}catch(e){nn(e)}});function Tr(){let e=M,s=S.drawingBufferWidth/e,n=S.drawingBufferHeight/e;if(i.letterbox){if(!i.width||!i.height)throw new Error("Letterboxing requires width and height defined.");let a=s/n,h=i.width/i.height;if(a>h){let l=n*h,g=(s-l)/2;V.viewport={x:g,y:0,width:l,height:n}}else{let l=s/h,g=(n-l)/2;V.viewport={x:0,y:g,width:s,height:l}}return}if(i.stretch&&(!i.width||!i.height))throw new Error("Stretching requires width and height defined.");V.viewport={x:0,y:0,width:s,height:n}}o(Tr,"updateViewport");function Fr(){v.onHide(()=>{i.backgroundAudio||j.ctx.suspend()}),v.onShow(()=>{!i.backgroundAudio&&!lt.paused&&j.ctx.resume()}),v.onResize(()=>{if(v.isFullscreen())return;let e=i.width&&i.height;e&&!i.stretch&&!i.letterbox||(r.width=r.offsetWidth*M,r.height=r.offsetHeight*M,Tr(),e||(V.frameBuffer.free(),V.frameBuffer=new Xi(K,S.drawingBufferWidth,S.drawingBufferHeight),V.width=S.drawingBufferWidth/M,V.height=S.drawingBufferHeight/M))}),i.debug!==!1&&(v.onKeyPress("f1",()=>lt.inspect=!lt.inspect),v.onKeyPress("f2",()=>lt.clearLog()),v.onKeyPress("f8",()=>lt.paused=!lt.paused),v.onKeyPress("f7",()=>{lt.timeScale=ke(_t(lt.timeScale-.2,0,2),1)}),v.onKeyPress("f9",()=>{lt.timeScale=ke(_t(lt.timeScale+.2,0,2),1)}),v.onKeyPress("f10",()=>lt.stepFrame())),i.burp&&v.onKeyPress("b",()=>Te())}o(Fr,"initEvents"),Tr(),Fr();let fe={VERSION:Ho,loadRoot:mt,loadProgress:F,loadSprite:Wt,loadSpriteAtlas:Ee,loadSound:Li,loadBitmapFont:Qe,loadFont:xt,loadShader:Ni,loadShaderURL:Oi,loadAseprite:Xe,loadPedit:We,loadBean:Gi,loadJSON:ht,load:St,getSprite:Je,getSound:Ze,getFont:$e,getBitmapFont:Re,getShader:Me,getAsset:_e,Asset:Gt,SpriteData:H,SoundData:_,width:Mt,height:Pt,center:fi,dt:Ht,time:v.time,screenshot:v.screenshot,record:Ks,isFocused:Qs,setCursor:v.setCursor,getCursor:v.getCursor,setCursorLocked:v.setCursorLocked,isCursorLocked:v.isCursorLocked,setFullscreen:v.setFullscreen,isFullscreen:v.isFullscreen,isTouchscreen:v.isTouchscreen,onLoad:Ki,onLoading:en,onResize:rn,onGamepadConnect:v.onGamepadConnect,onGamepadDisconnect:v.onGamepadDisconnect,onError:sn,onCleanup:on,camPos:es,camScale:is,camRot:rs,shake:ss,toScreen:wr,toWorld:Ar,setGravity:ds,getGravity:fs,setBackground:ps,getBackground:gs,getGamepads:v.getGamepads,add:pi,make:Hi,destroy:Ws,destroyAll:po,get:Er,readd:fo,pos:ci,scale:di,rotate:ms,color:ws,opacity:As,anchor:qi,area:bs,sprite:Yi,text:Es,polygon:Ss,rect:Rs,circle:Bs,uvquad:Ms,outline:Ps,body:Ts,doubleJump:Fs,shader:Cs,timer:zi,fixed:ks,stay:vr,health:Is,lifespan:Ds,z:ys,move:Vs,offscreen:xs,follow:vs,state:Us,fadeIn:Ns,mask:Os,drawon:Ls,tile:br,agent:zs,on:Jt,onUpdate:no,onDraw:oo,onAdd:yr,onDestroy:ns,onClick:ao,onCollide:os,onCollideUpdate:as,onCollideEnd:hs,onHover:us,onHoverUpdate:ls,onHoverEnd:cs,onKeyDown:v.onKeyDown,onKeyPress:v.onKeyPress,onKeyPressRepeat:v.onKeyPressRepeat,onKeyRelease:v.onKeyRelease,onMouseDown:v.onMouseDown,onMousePress:v.onMousePress,onMouseRelease:v.onMouseRelease,onMouseMove:v.onMouseMove,onCharInput:v.onCharInput,onTouchStart:v.onTouchStart,onTouchMove:v.onTouchMove,onTouchEnd:v.onTouchEnd,onScroll:v.onScroll,onHide:v.onHide,onShow:v.onShow,onGamepadButtonDown:v.onGamepadButtonDown,onGamepadButtonPress:v.onGamepadButtonPress,onGamepadButtonRelease:v.onGamepadButtonRelease,onGamepadStick:v.onGamepadStick,mousePos:hi,mouseDeltaPos:v.mouseDeltaPos,isKeyDown:v.isKeyDown,isKeyPressed:v.isKeyPressed,isKeyPressedRepeat:v.isKeyPressedRepeat,isKeyReleased:v.isKeyReleased,isMouseDown:v.isMouseDown,isMousePressed:v.isMousePressed,isMouseReleased:v.isMouseReleased,isMouseMoved:v.isMouseMoved,isGamepadButtonPressed:v.isGamepadButtonPressed,isGamepadButtonDown:v.isGamepadButtonDown,isGamepadButtonReleased:v.isGamepadButtonReleased,getGamepadStick:v.getGamepadStick,charInputted:v.charInputted,loop:go,wait:Xs,play:Pe,volume:ii,burp:Te,audioCtx:j.ctx,Line:Le,Rect:Tt,Circle:ln,Polygon:wi,Vec2:E,Color:ot,Mat4:Kt,Quad:Et,RNG:Sn,rand:Vi,randi:zr,randSeed:Rn,vec2:P,rgb:et,hsl2rgb:bo,quad:wt,choose:Bn,chance:Mn,lerp:te,tween:Sr,easings:Zi,map:oe,mapc:En,wave:Lr,deg2rad:Qt,rad2deg:He,clamp:_t,testLineLine:Oe,testRectRect:Pn,testRectLine:Fn,testRectPoint:xi,testCirclePolygon:kn,testLinePoint:Cn,testLineCircle:Kr,drawSprite:ji,drawText:mr,formatText:ie,drawRect:Rt,drawLine:f,drawLines:b,drawTriangle:B,drawCircle:Q,drawEllipse:Z,drawUVQuad:zt,drawPolygon:vt,drawFormattedText:re,drawMasked:oi,drawSubtracted:ai,pushTransform:At,popTransform:gt,pushTranslate:st,pushScale:Yt,pushRotate:ut,pushMatrix:Ce,usePostEffect:Fe,makeCanvas:ri,debug:lt,scene:Gs,go:js,onSceneLeave:Hs,addLevel:Ys,getData:qs,setData:Vr,download:ur,downloadJSON:On,downloadText:Xr,downloadBlob:jr,plug:xr,ASCII_CHARS:mn,canvas:v.canvas,addKaboom:Js,LEFT:E.LEFT,RIGHT:E.RIGHT,UP:E.UP,DOWN:E.DOWN,RED:ot.RED,GREEN:ot.GREEN,BLUE:ot.BLUE,YELLOW:ot.YELLOW,MAGENTA:ot.MAGENTA,CYAN:ot.CYAN,WHITE:ot.WHITE,BLACK:ot.BLACK,quit:an,Event:qt,EventHandler:Ai,EventController:Ne};if(i.plugins&&i.plugins.forEach(xr),i.global!==!1)for(let e in fe)window[e]=fe[e];return i.focus!==!1&&v.canvas.focus(),fe},"default"),eo=()=>({color:rgb(0,0,0),fontFamily:void 0,lineHeight:.9,fontSize:30,opacity:1}),Yr=class{constructor(i,t){x(this,"attrs");x(this,"kaboomObject",null);x(this,"parent");this.text=t,this.attrs=Object.assign({},eo(),i),this.parent=null}setParent(i){this.parent=i}style(i){if(this.attrs=Object.assign({},this.attrs,i),!this.parent)throw new Error("no parent?");this.parent.readd()}setText(i){if(this.text=i,!this.parent)throw new Error("no parent?");this.parent.readd()}},ia=()=>({alignX:"left",alignY:"top",flow:"x",background:rgb(255,255,255),fit:!1,gap:0,padding:{left:0,right:0,top:0,bottom:0},outline:void 0,outlineWidth:0,height:void 0,width:void 0,borderRadius:0,cursor:"default",opacity:1}),Nt=class{constructor(i,t){x(this,"attrs");x(this,"kaboomObject",null);x(this,"parent",null);this.children=t,this.attrs=Object.assign({},ia(),i)}triggerListener(i,...t){switch(i){case"click":this.attrs.onClick&&this.attrs.onClick.bind(this)();break;case"mousedown":this.attrs.onMouseDown&&this.attrs.onMouseDown.bind(this)();break;case"mousepress":this.attrs.onMousePress&&this.attrs.onMousePress.bind(this)();break;case"mouseup":this.attrs.onMouseRelease&&this.attrs.onMouseRelease.bind(this)();break;case"hoverend":this.attrs.onHoverEnd&&this.attrs.onHoverEnd.bind(this)();break;case"hoverupdate":this.attrs.onHoverUpdate&&this.attrs.onHoverUpdate.bind(this)();break;case"hover":this.attrs.onHover&&this.attrs.onHover.bind(this)();break;default:throw new Error(`invalid event '${i}'`)}}setParent(i){this.parent=i}style(i){if(this.attrs=Object.assign({},this.attrs,i),!this.parent)throw new Error("no parent?");this.parent.readd()}getChild(i){return this.children[i]}};function dr(i){return{size:i.fontSize,font:i.fontFamily}}function Ge(i){if(i instanceof Nt){const r=(i.attrs.flow==="x"?i.children.map(Ge).reduce((u,d)=>u+d+i.attrs.gap,-i.attrs.gap):Math.max(...i.children.map(Ge)))+(typeof i.attrs.padding=="number"?i.attrs.padding*2:i.attrs.padding.left+i.attrs.padding.right);return i.attrs.width&&i.attrs.width>r?i.attrs.width:r}return formatText({text:i.text,...dr(i.attrs)}).width}function je(i){if(i instanceof Nt){const r=(i.attrs.flow==="x"?Math.max(...i.children.map(je)):i.children.map(je).reduce((u,d)=>u+d+i.attrs.gap,-i.attrs.gap))+(typeof i.attrs.padding=="number"?i.attrs.padding*2:i.attrs.padding.top+i.attrs.padding.bottom);return i.attrs.height&&i.attrs.height>r?i.attrs.height:r}return formatText({text:i.text,...dr(i.attrs)}).height*i.attrs.lineHeight}function sr(i,t,r,u=0,d,p,M,C){if(r.setParent(i),r instanceof Nt){const N=typeof r.attrs.padding=="number"?r.attrs.padding:r.attrs.padding.top,v=typeof r.attrs.padding=="number"?r.attrs.padding:r.attrs.padding.bottom,W=typeof r.attrs.padding=="number"?r.attrs.padding:r.attrs.padding.left,S=typeof r.attrs.padding=="number"?r.attrs.padding:r.attrs.padding.right,K=je(r),V=Ge(r);let H=C??K,_=M??V;if(H<K&&(H=K),_<V&&(_=V),r.kaboomObject?(r.kaboomObject.pos.x=d,r.kaboomObject.pos.y=p,r.kaboomObject.color=r.attrs.background,r.kaboomObject.width=_,r.kaboomObject.height=H,r.kaboomObject.radius=r.attrs.borderRadius,r.kaboomObject.z=u,r.kaboomObject.opacity=r.attrs.opacity,r.attrs.outline&&r.kaboomObject.outline?(r.kaboomObject.outline.color=r.attrs.outline,r.kaboomObject.outline.width=r.attrs.outlineWidth):r.attrs.outline?r.kaboomObject.use(outline(r.attrs.outlineWidth,r.attrs.outline)):r.kaboomObject.outline&&r.kaboomObject.unuse("outline")):(r.kaboomObject=t.add([pos(d??0,p??0),color(r.attrs.background),rect(_,H,{radius:r.attrs.borderRadius}),z(u),r.attrs.outline&&outline(r.attrs.outlineWidth,r.attrs.outline),area(),opacity(r.attrs.opacity),{uiElement:r},"kaboom-flex-ui-element"]),r.kaboomObject.onClick(()=>r.triggerListener("click")),r.kaboomObject.onHover(()=>{r.attrs.cursor&&setCursor(r.attrs.cursor),r.triggerListener("hover")}),r.kaboomObject.onHoverEnd(()=>{r.attrs.cursor&&setCursor("default"),r.triggerListener("hoverend")}),r.kaboomObject.onMouseDown(()=>r.triggerListener("mousedown")),r.kaboomObject.onMousePress(()=>r.triggerListener("mousepress")),r.kaboomObject.onMouseRelease(()=>r.triggerListener("mouseup")),r.kaboomObject.onHoverUpdate(()=>r.triggerListener("hoverupdate")),r.attrs.onMount&&r.attrs.onMount.bind(r)(r.kaboomObject)),r.attrs.flow==="x"){let j=W,O=0,tt=0;for(let F=0;F<r.children.length;F++)r.children[F]instanceof Nt&&r.children[F].attrs.fit&&tt++,O+=Ge(r.children[F]),F!==r.children.length-1&&(O+=r.attrs.gap);const R=_-W-S-O,St=tt===0?0:R/tt;tt===0&&(r.attrs.alignX==="center"?j+=R/2:r.attrs.alignX==="right"&&(j=_-O-S));for(let F=0;F<r.children.length;F++){let mt=j,ht=N,rt=Ge(r.children[F]),xt=je(r.children[F]);r.children[F]instanceof Nt&&r.children[F].attrs.fit&&(rt+=St),r.attrs.alignY==="center"?ht=(H-xt)/2:r.attrs.alignY==="bottom"&&(ht=H-v-xt),r.children[F]instanceof Nt&&r.children[F].attrs.fit&&(ht=N,xt=H-N-v),j+=rt+r.attrs.gap,sr(i,r.kaboomObject,r.children[F],u+1,mt,ht,rt,xt)}}else{let j=N,O=0,tt=0;for(let F=0;F<r.children.length;F++)r.children[F]instanceof Nt&&r.children[F].attrs.fit&&tt++,O+=je(r.children[F]),F!==r.children.length-1&&(O+=r.attrs.gap);const R=H-N-v-O,St=tt===0?0:R/tt;tt===0&&(r.attrs.alignY==="center"?j+=R/2:r.attrs.alignY==="bottom"&&(j=H-O-v));for(let F=0;F<r.children.length;F++){let mt=W,ht=j,rt=Ge(r.children[F]),xt=je(r.children[F]);r.children[F]instanceof Nt&&r.children[F].attrs.fit&&(xt+=St),r.attrs.alignX==="center"?mt=(_-rt)/2:r.attrs.alignX==="right"&&(mt=_-S-rt),r.children[F]instanceof Nt&&r.children[F].attrs.fit&&(mt=W,rt=_-W-S),j+=xt+r.attrs.gap,sr(i,r.kaboomObject,r.children[F],u+1,mt,ht,rt,xt)}}return r.kaboomObject}else return r.kaboomObject?(r.kaboomObject.pos.x=d,r.kaboomObject.pos.y=p,r.kaboomObject.text=r.text,r.kaboomObject.color=r.attrs.color,r.kaboomObject.opacity=r.attrs.opacity,r.kaboomObject.textSize=r.attrs.fontSize,r.attrs.fontFamily&&(r.kaboomObject.font=r.attrs.fontFamily)):(r.kaboomObject=t.add([text(r.text,dr(r.attrs)),color(r.attrs.color),pos(d,p),z(u),opacity(r.attrs.opacity)]),r.attrs.onMount&&r.attrs.onMount.bind(r)(r.kaboomObject)),r.kaboomObject}function ra(i){let t,r;return{add(u){if(r)return this.readd();t||(t=i());const d=make([fixed(),pos(0,0)]);sr(this,d,t,1e3,0,0),u?u.add(d):add(d),r=d},readd(){const u=make([fixed(),pos(0,0)]);sr(this,u,t,1e3,0,0)},remove(){if(!r)throw new Error("Cannot remove UI since it hasn't been added yet.");const u=[t];for(;u.length>0;){const d=u.shift();if(d instanceof Nt)for(const p of d.children)u.push(p);d.kaboomObject=null}r.destroy(),r=null}}}function nr(...i){return i[0]instanceof Yr||i[0]instanceof Nt?new Nt({},i):new Nt(i[0],i.slice(1))}function or(i,t){return t?new Yr(t,i):new Yr({},i)}function io(i,t){return t.cursor||(t.cursor="pointer"),nr(t,or(i,t.text))}function sa(i){let t=i.checked??!1;return io("",{...i,text:{...i.text,lineHeight:.9,opacity:t?1:0},onClick(){const r=this.getChild(0);t=!t,t?r.style({opacity:1}):r.style({opacity:0}),i.onCheck&&i.onCheck.bind(this)(t)}})}function na(i){var v;const t=Object.assign({},eo(),i.text),r=2,u=2;let d="",p=0,M=!1,C=0,N=!1;return nr({...i,cursor:"text",gap:0,onClick(){i.onFocus&&i.onFocus.bind(this)(),M=!0;const W=this.getChild(1),S=this.getChild(0),K=this.getChild(2);S.setText(d.substring(0,p)),K.setText(d.substring(p)),W.style({opacity:1,width:r,gap:u}),C=0,N=!0},onMount(W){const S=this.getChild(1),K=this.getChild(0),V=this.getChild(2),H=j=>{d!==j&&i.onChange&&i.onChange.bind(this)(j),K.setText(j.substring(0,p)),V.setText(j.substring(p)),d=j},_=[onUpdate(()=>{M&&(i.onFocusUpdate&&i.onFocusUpdate.bind(this)(),C+=dt()*1e3,C>=700&&(N=!N,S.style({opacity:N?1:0}),C=0))}),onClick(()=>{W.isHovering()||(i.onBlur&&i.onBlur.bind(this)(),p=d.length,S.style({opacity:0,width:0}),this.style({gap:0}),M=!1)}),onKeyPressRepeat("left",()=>{!M||p===0||(N=!0,C=0,S.style({opacity:1}),p--,H(d))}),onKeyPressRepeat("right",()=>{!M||p===d.length||(N=!0,C=0,S.style({opacity:1}),p++,H(d))}),onKeyPressRepeat("backspace",()=>{!M||p===0||(N=!0,C=0,S.style({opacity:1}),p--,H(d.substring(0,p)+d.substring(p+1)))}),onCharInput(j=>{M&&(N=!0,C=0,S.style({opacity:1}),p++,isKeyDown("shift")&&(j=j.toUpperCase()),H(d.substring(0,p-1)+j+d.substring(p-1)))})];W.onDestroy(()=>_.forEach(j=>j.cancel()))}},or(d,i.text),nr({opacity:0,background:((v=i.text)==null?void 0:v.color)??rgb(255,255,255),width:0,height:formatText({text:d.length===0?" ":d,...dr(t)}).height-2,cursor:"text"}),or("",i.text))}function oa(i){return{makeUI:ra,$box:nr,$button:io,$text:or,$checkbox:sa,$input:na}}const Ft=ea({width:1e3,height:550,canvas:document.querySelector("#game"),global:!1,debug:!0,plugins:[oa]}),pt={width:1e3,height:550,tileSize:64,mode:"DEV"},Ot={question:"How to get to the starfish",gridWidth:5,gridHeight:5,playerStartX:2,playerStartY:4,finishX:4,finishY:2,usedCodeBlocks:["right","up"]},$t={codeBlockSprites:["down","left","right","up"],styling:{radius:8,borderWidth:3,color:{r:2,g:58,b:71},fontSize:24}},fr={ui:-10,gridElements:10},Bt=2,mi={width:0,height:0,pos:{x:0,y:0},padding:[0,0,0,0]},it={sidebar:{width:120,height:pt.height,pos:{x:pt.width-120,y:0},padding:[0,0,0,0]},coins:{width:pt.width-120-Bt,height:60,pos:{x:0,y:pt.height-60},padding:[10,22,0,20]},gridBox:mi,codeblocksBox:mi,questionBox:mi,algorithmBoxUtilsBox:mi,algorithmBox:mi};it.gridBox={width:(pt.width-it.sidebar.width-2*Bt)/2,height:(pt.height-it.coins.height)/4*3-3*Bt,pos:{x:Bt,y:Bt}};it.codeblocksBox={width:it.gridBox.width,height:pt.height-it.coins.height-it.gridBox.height-2*Bt,pos:{x:Bt,y:it.gridBox.height+Bt}};it.questionBox={width:pt.width-it.sidebar.width-it.gridBox.width-2*Bt,height:100,pos:{x:it.gridBox.width+Bt,y:Bt}};it.algorithmBoxUtilsBox={width:it.questionBox.width,height:100,pos:{x:it.gridBox.width+Bt,y:pt.height-it.coins.height-100-Bt}};it.algorithmBox={width:it.questionBox.width,height:pt.height-it.questionBox.height-it.coins.height-it.algorithmBoxUtilsBox.height-4*Bt,pos:{x:it.gridBox.width+Bt,y:it.questionBox.height+2*Bt}};async function aa(i){i.loadSprite("player","sprites/boat.png",{sliceX:10,sliceY:1,anims:{idle:{from:0,to:0},move:{from:1,to:8}}}),i.loadSprite("finish","sprites/starfish.png",{sliceX:6,sliceY:5,anims:{idle:{from:0,to:19},achieved:{from:20,to:30}}});const t=64;i.loadSpriteAtlas("sprites/tiles.png",{gridTop:{x:t*6,y:0,width:t,height:t},gridBottom:{x:t*2,y:0,width:t,height:t},gridCenter:{x:t*0,y:0,width:t,height:t}});const r=376,u=r/2;for(const d in $t.codeBlockSprites)i.loadSpriteAtlas("sprites/codeblocks.png",{[$t.codeBlockSprites[d]]:{x:Number(d)*r,y:0,width:u,height:u}});i.loadFont("gameFont","fonts/UbuntuMono-Bold.ttf")}function ro(i,t,r,u){const d=u.pos[0],p=u.pos[1],M=d+pt.tileSize*t,C=p+pt.tileSize*r;return i.vec2(M,C)}function ha(i){const t=i.add(["player",i.sprite("player"),i.area(),i.anchor("center"),i.scale(.5),i.pos(0,0),i.z(fr.gridElements)]);return t.play("move",{loop:!0}),t}function ua(i){const t=i.add(["finish",i.sprite("finish"),i.area(),i.anchor("center"),i.scale(.15),i.pos(0,0),i.z(fr.gridElements)]);return t.play("idle",{loop:!0}),t}function la(i){const t=[];t.push("^".repeat(Ot.gridWidth));for(let u=0;u<Ot.gridHeight-2;u++)t.push("-".repeat(Ot.gridWidth));return t.push("v".repeat(Ot.gridWidth)),{layout:t,tiles:{"^":()=>[i.sprite("gridTop"),i.anchor("center")],"-":()=>[i.sprite("gridCenter"),i.anchor("center")],v:()=>[i.sprite("gridBottom"),i.anchor("center")]}}}function ca(i,t){const r=t.pos[0],u=t.pos[1];for(let d=0;d<Ot.gridWidth;d++)for(let p=0;p<Ot.gridHeight;p++)i.add([i.pos(i.vec2(r+d*pt.tileSize,u+p*pt.tileSize)),i.text(`x:${d}
y:${p}`,{size:14,align:"center"}),i.color(17,23,38),i.anchor("center")])}function da(i){for(const t in it){if(t==="game")continue;const r=it[t];if(r){const{x:u,y:d}=r.pos;i.add([t,i.rect(r.width,r.height,{radius:$t.styling.radius}),i.z(fr.ui),i.pos(i.vec2(u,d)),i.opacity(0)])}}}function so(i){for(const t in it){const r=i.get(t)[0],{x:u,y:d}=r.pos,{r:p,g:M,b:C}=$t.styling.color;r.outline={width:$t.styling.borderWidth,color:$t.styling.color},r.opacity=.5,i.add([i.text(t,{size:$t.styling.fontSize,font:"gameFont"}),i.color(p,M,C),i.pos(u,d)])}}function fa(i){let t=i.get("questionBox")[0];const{r,g:u,b:d}=$t.styling.color;return t=i.add(["question",i.text(Ot.question,{size:$t.styling.fontSize,font:"gameFont"}),i.color(r,u,d),i.pos(t.pos.x+t.width/2,t.pos.y+t.height/2),i.anchor("center")]),t}aa(Ft);da(Ft);so(Ft);const bn=la(Ft),ar=Ft.get("gridBox")[0],Ui=Ft.addLevel(bn.layout,{tileWidth:pt.tileSize,tileHeight:pt.tileSize,pos:Ft.vec2(pt.tileSize,pt.tileSize),tiles:bn.tiles}),pa=ar.pos.x+ar.width/2,ga=ar.pos.y+ar.height/2;Ui.pos=[pa-pt.tileSize*Ot.gridWidth/2+pt.tileSize/2,ga-pt.tileSize*Ot.gridHeight/2+pt.tileSize/2];Ui.z=fr.ui;const ma=ha(Ft);ma.pos=ro(Ft,Ot.playerStartX,Ot.playerStartY,Ui);const wa=ua(Ft);wa.pos=ro(Ft,Ot.finishX,Ot.finishY,Ui);fa(Ft);Ft.debug.inspect=!0,so(Ft),ca(Ft,Ui);

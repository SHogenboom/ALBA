(()=>{"use strict";var e=Object.defineProperty,t=(t,r)=>e(t,"name",{value:r,configurable:!0}),r=(()=>{for(var e=new Uint8Array(128),t=0;t<64;t++)e[t<26?t+65:t<52?t+71:t<62?t-4:4*t-205]=t;return t=>{for(var r=t.length,i=new Uint8Array(3*(r-("="==t[r-1])-("="==t[r-2]))/4|0),n=0,s=0;n<r;){var o=e[t.charCodeAt(n++)],a=e[t.charCodeAt(n++)],h=e[t.charCodeAt(n++)],l=e[t.charCodeAt(n++)];i[s++]=o<<2|a>>4,i[s++]=a<<4|h>>2,i[s++]=h<<6|l}return i}})();function i(e){return e*Math.PI/180}function n(e){return 180*e/Math.PI}function s(e,t,r){return t>r?s(e,r,t):Math.min(Math.max(e,t),r)}function o(e,t,r){if("number"==typeof e&&"number"==typeof t)return e+(t-e)*r;if(e instanceof l&&t instanceof l)return e.lerp(t,r);if(e instanceof d&&t instanceof d)return e.lerp(t,r);throw new Error(`Bad value for lerp(): ${e}, ${t}. Only number, Vec2 and Color is supported.`)}function a(e,t,r,i,n){return i+(e-t)/(r-t)*(n-i)}function h(e,t,r,i,n){return s(a(e,t,r,i,n),i,n)}t(i,"deg2rad"),t(n,"rad2deg"),t(s,"clamp"),t(o,"lerp"),t(a,"map"),t(h,"mapc");var l=class e{static{t(this,"Vec2")}x=0;y=0;constructor(e=0,t=e){this.x=e,this.y=t}static fromAngle(t){let r=i(t);return new e(Math.cos(r),Math.sin(r))}static LEFT=new e(-1,0);static RIGHT=new e(1,0);static UP=new e(0,-1);static DOWN=new e(0,1);clone(){return new e(this.x,this.y)}add(...t){let r=u(...t);return new e(this.x+r.x,this.y+r.y)}sub(...t){let r=u(...t);return new e(this.x-r.x,this.y-r.y)}scale(...t){let r=u(...t);return new e(this.x*r.x,this.y*r.y)}dist(...e){let t=u(...e);return this.sub(t).len()}sdist(...e){let t=u(...e);return this.sub(t).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let t=this.len();return 0===t?new e(0):this.scale(1/t)}normal(){return new e(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(...e){let t=u(...e);return n(Math.atan2(this.y-t.y,this.x-t.x))}angleBetween(...e){let t=u(...e);return n(Math.atan2(this.cross(t),this.dot(t)))}lerp(t,r){return new e(o(this.x,t.x,r),o(this.y,t.y,r))}slerp(e,t){let r=this.dot(e),i=this.cross(e),n=Math.atan2(i,r);return this.scale(Math.sin((1-t)*n)).add(e.scale(Math.sin(t*n))).scale(1/i)}isZero(){return 0===this.x&&0===this.y}toFixed(t){return new e(Number(this.x.toFixed(t)),Number(this.y.toFixed(t)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new N(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}};function u(...e){if(1===e.length){if(e[0]instanceof l)return new l(e[0].x,e[0].y);if(Array.isArray(e[0])&&2===e[0].length)return new l(...e[0])}return new l(...e)}t(u,"vec2");var d=class e{static{t(this,"Color")}r=255;g=255;b=255;constructor(e,t,r){this.r=s(e,0,255),this.g=s(t,0,255),this.b=s(r,0,255)}static fromArray(t){return new e(t[0],t[1],t[2])}static fromHex(t){if("number"==typeof t)return new e(t>>16&255,t>>8&255,t>>0&255);if("string"==typeof t){let r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return new e(parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16))}throw new Error("Invalid hex color format")}static fromHSL(r,i,n){if(0==i)return new e(255*n,255*n,255*n);let s=t(((e,t,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e)),"hue2rgb"),o=n<.5?n*(1+i):n+i-n*i,a=2*n-o,h=s(a,o,r+1/3),l=s(a,o,r),u=s(a,o,r-1/3);return new e(Math.round(255*h),Math.round(255*l),Math.round(255*u))}static RED=new e(255,0,0);static GREEN=new e(0,255,0);static BLUE=new e(0,0,255);static YELLOW=new e(255,255,0);static MAGENTA=new e(255,0,255);static CYAN=new e(0,255,255);static WHITE=new e(255,255,255);static BLACK=new e(0,0,0);clone(){return new e(this.r,this.g,this.b)}lighten(t){return new e(this.r+t,this.g+t,this.b+t)}darken(e){return this.lighten(-e)}invert(){return new e(255-this.r,255-this.g,255-this.b)}mult(t){return new e(this.r*t.r/255,this.g*t.g/255,this.b*t.b/255)}lerp(t,r){return new e(o(this.r,t.r,r),o(this.g,t.g,r),o(this.b,t.b,r))}toHSL(){let e=this.r/255,t=this.g/255,r=this.b/255,i=Math.max(e,t,r),n=Math.min(e,t,r),s=(i+n)/2,o=s,a=s;if(i==n)s=o=0;else{let h=i-n;switch(o=a>.5?h/(2-i-n):h/(i+n),i){case e:s=(t-r)/h+(t<r?6:0);break;case t:s=(r-e)/h+2;break;case r:s=(e-t)/h+4}s/=6}return[s,o,a]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}};function c(...e){if(0===e.length)return new d(255,255,255);if(1===e.length){if(e[0]instanceof d)return e[0].clone();if("string"==typeof e[0])return d.fromHex(e[0]);if(Array.isArray(e[0])&&3===e[0].length)return d.fromArray(e[0])}return new d(...e)}t(c,"rgb");var f=t(((e,t,r)=>d.fromHSL(e,t,r)),"hsl2rgb"),p=class e{static{t(this,"Quad")}x=0;y=0;w=1;h=1;constructor(e,t,r,i){this.x=e,this.y=t,this.w=r,this.h=i}scale(t){return new e(this.x+this.w*t.x,this.y+this.h*t.y,this.w*t.w,this.h*t.h)}pos(){return new l(this.x,this.y)}clone(){return new e(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function g(e,t,r,i){return new p(e,t,r,i)}t(g,"quad");var m=class e{static{t(this,"Mat4")}m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(e){e&&(this.m=e)}static translate(t){return new e([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,0,1])}static scale(t){return new e([t.x,0,0,0,0,t.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(t){t=i(-t);let r=Math.cos(t),n=Math.sin(t);return new e([1,0,0,0,0,r,-n,0,0,n,r,0,0,0,0,1])}static rotateY(t){t=i(-t);let r=Math.cos(t),n=Math.sin(t);return new e([r,0,n,0,0,1,0,0,-n,0,r,0,0,0,0,1])}static rotateZ(t){t=i(-t);let r=Math.cos(t),n=Math.sin(t);return new e([r,-n,0,0,n,r,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=i(-e);let t=Math.cos(e),r=Math.sin(e),n=this.m[0],s=this.m[1],o=this.m[4],a=this.m[5];return this.m[0]=n*t+s*r,this.m[1]=-n*r+s*t,this.m[4]=o*t+a*r,this.m[5]=-o*r+a*t,this}mult(t){let r=[];for(let e=0;e<4;e++)for(let i=0;i<4;i++)r[4*e+i]=this.m[0+i]*t.m[4*e+0]+this.m[4+i]*t.m[4*e+1]+this.m[8+i]*t.m[4*e+2]+this.m[12+i]*t.m[4*e+3];return new e(r)}multVec2(e){return new l(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new l(this.m[12],this.m[13])}getScale(){if(0!=this.m[0]||0!=this.m[1]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new l(t,e/t)}if(0!=this.m[4]||0!=this.m[5]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new l(e/t,t)}return new l(0,0)}getRotation(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return n(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return n(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}return 0}getSkew(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new l(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new l(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}return new l(0,0)}invert(){let t=[],r=this.m[10]*this.m[15]-this.m[14]*this.m[11],i=this.m[9]*this.m[15]-this.m[13]*this.m[11],n=this.m[9]*this.m[14]-this.m[13]*this.m[10],s=this.m[8]*this.m[15]-this.m[12]*this.m[11],o=this.m[8]*this.m[14]-this.m[12]*this.m[10],a=this.m[8]*this.m[13]-this.m[12]*this.m[9],h=this.m[6]*this.m[15]-this.m[14]*this.m[7],l=this.m[5]*this.m[15]-this.m[13]*this.m[7],u=this.m[5]*this.m[14]-this.m[13]*this.m[6],d=this.m[4]*this.m[15]-this.m[12]*this.m[7],c=this.m[4]*this.m[14]-this.m[12]*this.m[6],f=this.m[5]*this.m[15]-this.m[13]*this.m[7],p=this.m[4]*this.m[13]-this.m[12]*this.m[5],g=this.m[6]*this.m[11]-this.m[10]*this.m[7],m=this.m[5]*this.m[11]-this.m[9]*this.m[7],w=this.m[5]*this.m[10]-this.m[9]*this.m[6],A=this.m[4]*this.m[11]-this.m[8]*this.m[7],V=this.m[4]*this.m[10]-this.m[8]*this.m[6],v=this.m[4]*this.m[9]-this.m[8]*this.m[5];t[0]=this.m[5]*r-this.m[6]*i+this.m[7]*n,t[4]=-(this.m[4]*r-this.m[6]*s+this.m[7]*o),t[8]=this.m[4]*i-this.m[5]*s+this.m[7]*a,t[12]=-(this.m[4]*n-this.m[5]*o+this.m[6]*a),t[1]=-(this.m[1]*r-this.m[2]*i+this.m[3]*n),t[5]=this.m[0]*r-this.m[2]*s+this.m[3]*o,t[9]=-(this.m[0]*i-this.m[1]*s+this.m[3]*a),t[13]=this.m[0]*n-this.m[1]*o+this.m[2]*a,t[2]=this.m[1]*h-this.m[2]*l+this.m[3]*u,t[6]=-(this.m[0]*h-this.m[2]*d+this.m[3]*c),t[10]=this.m[0]*f-this.m[1]*d+this.m[3]*p,t[14]=-(this.m[0]*u-this.m[1]*c+this.m[2]*p),t[3]=-(this.m[1]*g-this.m[2]*m+this.m[3]*w),t[7]=this.m[0]*g-this.m[2]*A+this.m[3]*V,t[11]=-(this.m[0]*m-this.m[1]*A+this.m[3]*v),t[15]=this.m[0]*w-this.m[1]*V+this.m[2]*v;let y=this.m[0]*t[0]+this.m[1]*t[4]+this.m[2]*t[8]+this.m[3]*t[12];for(let e=0;e<4;e++)for(let r=0;r<4;r++)t[4*e+r]*=1/y;return new e(t)}clone(){return new e([...this.m])}toString(){return this.m.toString()}};function w(e,t,r,i=(e=>-Math.cos(e))){return e+(i(r)+1)/2*(t-e)}t(w,"wave");var A=2147483648,V=class{static{t(this,"RNG")}seed;constructor(e){this.seed=e}gen(){return this.seed=(1103515245*this.seed+12345)%A,this.seed/A}genNumber(e,t){return e+this.gen()*(t-e)}genVec2(e,t){return new l(this.genNumber(e.x,t.x),this.genNumber(e.y,t.y))}genColor(e,t){return new d(this.genNumber(e.r,t.r),this.genNumber(e.g,t.g),this.genNumber(e.b,t.b))}genAny(...e){if(0===e.length)return this.gen();if(1===e.length){if("number"==typeof e[0])return this.genNumber(0,e[0]);if(e[0]instanceof l)return this.genVec2(u(0,0),e[0]);if(e[0]instanceof d)return this.genColor(c(0,0,0),e[0])}else if(2===e.length){if("number"==typeof e[0]&&"number"==typeof e[1])return this.genNumber(e[0],e[1]);if(e[0]instanceof l&&e[1]instanceof l)return this.genVec2(e[0],e[1]);if(e[0]instanceof d&&e[1]instanceof d)return this.genColor(e[0],e[1])}}},v=new V(Date.now());function y(e){return null!=e&&(v.seed=e),v.seed}function x(...e){return v.genAny(...e)}function E(...e){return Math.floor(x(...e))}function S(e){return x()<=e}function b(e){return e[E(e.length)]}function R(e,t){return e.pos.x+e.width>t.pos.x&&e.pos.x<t.pos.x+t.width&&e.pos.y+e.height>t.pos.y&&e.pos.y<t.pos.y+t.height}function M(e,t){if(e.p1.x===e.p2.x&&e.p1.y===e.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let r=(t.p2.y-t.p1.y)*(e.p2.x-e.p1.x)-(t.p2.x-t.p1.x)*(e.p2.y-e.p1.y);if(0===r)return null;let i=((t.p2.x-t.p1.x)*(e.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(e.p1.x-t.p1.x))/r,n=((e.p2.x-e.p1.x)*(e.p1.y-t.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-t.p1.x))/r;return i<0||i>1||n<0||n>1?null:i}function P(e,t){let r=M(e,t);return r?u(e.p1.x+r*(e.p2.x-e.p1.x),e.p1.y+r*(e.p2.y-e.p1.y)):null}function T(e,t){if(B(e,t.p1)||B(e,t.p2))return!0;let r=e.points();return!!(P(t,new U(r[0],r[1]))||P(t,new U(r[1],r[2]))||P(t,new U(r[2],r[3]))||P(t,new U(r[3],r[0])))}function B(e,t){return t.x>e.pos.x&&t.x<e.pos.x+e.width&&t.y>e.pos.y&&t.y<e.pos.y+e.height}function F(e,t){let r=t.sub(e.p1),i=e.p2.sub(e.p1);if(Math.abs(r.cross(i))>Number.EPSILON)return!1;let n=r.dot(i)/i.dot(i);return n>=0&&n<=1}function I(e,t){let r=e.p2.sub(e.p1),i=r.dot(r),n=e.p1.sub(t.center),s=2*r.dot(n),o=s*s-4*i*(n.dot(n)-t.radius*t.radius);if(i<=Number.EPSILON||o<0)return!1;if(0==o){let e=-s/(2*i);if(e>=0&&e<=1)return!0}else{let e=(-s+Math.sqrt(o))/(2*i),t=(-s-Math.sqrt(o))/(2*i);if(e>=0&&e<=1||t>=0&&t<=1)return!0}return D(t,e.p1)}function D(e,t){return e.center.sdist(t)<e.radius*e.radius}function C(e,t){let r=t.pts[t.pts.length-1];for(let i of t.pts){if(I(new U(r,i),e))return!0;r=i}return!!D(e,t.pts[0])||k(t,e.center)}function k(e,t){let r=!1,i=e.pts;for(let e=0,n=i.length-1;e<i.length;n=e++)i[e].y>t.y!=i[n].y>t.y&&t.x<(i[n].x-i[e].x)*(t.y-i[e].y)/(i[n].y-i[e].y)+i[e].x&&(r=!r);return r}t(y,"randSeed"),t(x,"rand"),t(E,"randi"),t(S,"chance"),t(b,"choose"),t(R,"testRectRect"),t(M,"testLineLineT"),t(P,"testLineLine"),t(T,"testRectLine"),t(B,"testRectPoint"),t(F,"testLinePoint"),t(I,"testLineCircle"),t(D,"testCirclePoint"),t(C,"testCirclePolygon"),t(k,"testPolygonPoint");var U=class e{static{t(this,"Line")}p1;p2;constructor(e,t){this.p1=e.clone(),this.p2=t.clone()}transform(t){return new e(t.multVec2(this.p1),t.multVec2(this.p2))}bbox(){return N.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new e(this.p1,this.p2)}},N=class e{static{t(this,"Rect")}pos;width;height;constructor(e,t,r){this.pos=e.clone(),this.width=t,this.height=r}static fromPoints(t,r){return new e(t.clone(),r.x-t.x,r.y-t.y)}center(){return new l(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new G(this.points().map((t=>e.multVec2(t))))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new e(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let t=this.pos,r=this.pos.add(this.width,this.height),i=Math.max(t.x-e.x,0,e.x-r.x),n=Math.max(t.y-e.y,0,e.y-r.y);return i*i+n*n}},L=class e{static{t(this,"Circle")}center;radius;constructor(e,t){this.center=e.clone(),this.radius=t}transform(e){return new O(this.center,this.radius,this.radius).transform(e)}bbox(){return N.fromPoints(this.center.sub(u(this.radius)),this.center.add(u(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new e(this.center,this.radius)}},O=class e{static{t(this,"Ellipse")}center;radiusX;radiusY;constructor(e,t,r){this.center=e.clone(),this.radiusX=t,this.radiusY=r}transform(t){return new e(t.multVec2(this.center),t.m[0]*this.radiusX,t.m[5]*this.radiusY)}bbox(){return N.fromPoints(this.center.sub(u(this.radiusX,this.radiusY)),this.center.add(u(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new e(this.center,this.radiusX,this.radiusY)}},G=class e{static{t(this,"Polygon")}pts;constructor(e){if(e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(t){return new e(this.pts.map((e=>t.multVec2(e))))}bbox(){let e=u(Number.MAX_VALUE),t=u(-Number.MAX_VALUE);for(let r of this.pts)e.x=Math.min(e.x,r.x),t.x=Math.max(t.x,r.x),e.y=Math.min(e.y,r.y),t.y=Math.max(t.y,r.y);return N.fromPoints(e,t)}area(){let e=0,t=this.pts.length;for(let r=0;r<t;r++){let i=this.pts[r],n=this.pts[(r+1)%t];e+=i.x*n.y*.5,e-=n.x*i.y*.5}return Math.abs(e)}clone(){return new e(this.pts.map((e=>e.clone())))}};function q(e,t){let r=Number.MAX_VALUE,i=u(0);for(let n of[e,t])for(let s=0;s<n.pts.length;s++){let o=n.pts[s],a=n.pts[(s+1)%n.pts.length].sub(o).normal().unit(),h=Number.MAX_VALUE,l=-Number.MAX_VALUE;for(let t=0;t<e.pts.length;t++){let r=e.pts[t].dot(a);h=Math.min(h,r),l=Math.max(l,r)}let u=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let e=0;e<t.pts.length;e++){let r=t.pts[e].dot(a);u=Math.min(u,r),d=Math.max(d,r)}let c=Math.min(l,d)-Math.max(h,u);if(c<0)return null;if(c<Math.abs(r)){let e=d-h,t=u-l;r=Math.abs(e)<Math.abs(t)?e:t,i=a.scale(r)}}return i}t(q,"sat");var H=class extends Map{static{t(this,"Registry")}lastID;constructor(...e){super(...e),this.lastID=0}push(e){let t=this.lastID;return this.set(t,e),this.lastID++,t}pushd(e){let t=this.push(e);return()=>this.delete(t)}},K=class e{static{t(this,"EventController")}paused=!1;cancel;constructor(e){this.cancel=e}static join(t){let r=new e((()=>t.forEach((e=>e.cancel()))));return Object.defineProperty(r,"paused",{get:()=>t[0].paused,set:e=>t.forEach((t=>t.paused=e))}),r.paused=!1,r}},Y=class{static{t(this,"Event")}handlers=new H;add(e){let t=this.handlers.pushd(((...t)=>{r.paused||e(...t)})),r=new K(t);return r}addOnce(e){let t=this.add(((...r)=>{t.cancel(),e(...r)}));return t}next(){return new Promise((e=>this.addOnce(e)))}trigger(...e){this.handlers.forEach((t=>t(...e)))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},j=class{static{t(this,"EventHandler")}handlers={};on(e,t){return this.handlers[e]||(this.handlers[e]=new Y),this.handlers[e].add(t)}onOnce(e,t){let r=this.on(e,((...e)=>{r.cancel(),t(...e)}));return r}next(e){return new Promise((t=>{this.onOnce(e,((...e)=>t(e[0])))}))}trigger(e,...t){this.handlers[e]&&this.handlers[e].trigger(...t)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){return this.handlers[e]?.numListeners()??0}};function Q(e,t){if(e===t)return!0;let r=typeof e,i=typeof t;if(r!==i)return!1;if("object"===r&&"object"===i&&null!==e&&null!==t){if(Array.isArray(e)!==Array.isArray(t))return!1;let r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(let i of r)if(!Q(e[i],t[i]))return!1;return!0}return!1}function z(e){let t=window.atob(e),r=t.length,i=new Uint8Array(r);for(let e=0;e<r;e++)i[e]=t.charCodeAt(e);return i.buffer}function J(e){return z(e.split(",")[1])}function X(e,t){let r=document.createElement("a");r.href=t,r.download=e,r.click()}function W(e,t){X(e,"data:text/plain;charset=utf-8,"+t)}function Z(e,t){W(e,JSON.stringify(t))}function _(e,t){let r=URL.createObjectURL(t);X(e,r),URL.revokeObjectURL(r)}t(Q,"deepEq"),t(z,"base64ToArrayBuffer"),t(J,"dataURLToArrayBuffer"),t(X,"download"),t(W,"downloadText"),t(Z,"downloadJSON"),t(_,"downloadBlob");var $=t((e=>e.match(/^data:\w+\/\w+;base64,.+/)),"isDataURL"),ee=t((e=>e.split(".").slice(0,-1).join(".")),"getFileName");function te(e,t){return(...r)=>{let i=r.length;return i===e.length?e(...r):i===t.length?t(...r):void 0}}t(te,"overload2");var re=(()=>{let e=0;return()=>e++})(),ie=t((e=>e instanceof Error?e.message:String(e)),"getErrorMessage"),ne=class{static{t(this,"BinaryHeap")}_items;_compareFn;constructor(e=((e,t)=>e<t)){this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(0===this._items.length)return null;let e=this._items[0],t=this._items.pop();return 0!==this._items.length&&(this._items[0]=t,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let t=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[t])&&this._items[e]>=this._items[t])break;this.swap(e,t),e=t}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let t=2*e+1;if(t<this._items.length-1&&!this._compareFn(this._items[t],this._items[t+1])&&++t,this._compareFn(this._items[e],this._items[t]))break;this.swap(e,t),e=t}}swap(e,t){[this._items[e],this._items[t]]=[this._items[t],this._items[e]]}get length(){return this._items.length}},se=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function oe(e){if("string"!=typeof e)throw new TypeError("string cannot be undefined or null");let t=[],r=0,i=0;for(;r<e.length;)i+=ae(r+i,e),ge(e[r+i])&&i++,ce(e[r+i])&&i++,fe(e[r+i])&&i++,me(e[r+i])?i++:(t.push(e.substring(r,r+i)),r+=i,i=0);return t}function ae(e,t){let r=t[e];if(!he(r)||e===t.length-1)return 1;let i=r+t[e+1],n=t.substring(e+2,e+5);return le(i)&&le(n)?4:ue(i)&&pe(n)?t.slice(e).indexOf(String.fromCodePoint(917631))+2:de(n)?4:2}function he(e){return e&&Ae(e[0].charCodeAt(0),55296,56319)}function le(e){return Ae(we(e),127462,127487)}function ue(e){return Ae(we(e),127988,127988)}function de(e){return Ae(we(e),127995,127999)}function ce(e){return"string"==typeof e&&Ae(e.charCodeAt(0),65024,65039)}function fe(e){return"string"==typeof e&&Ae(e.charCodeAt(0),8400,8447)}function pe(e){let t=e.codePointAt(0);return"string"==typeof e&&"number"==typeof t&&Ae(t,917504,917631)}function ge(e){return"string"==typeof e&&se.includes(e.charCodeAt(0))}function me(e){return"string"==typeof e&&8205===e.charCodeAt(0)}function we(e){return(e.charCodeAt(0)-55296<<10)+(e.charCodeAt(1)-56320)+65536}function Ae(e,t,r){return e>=t&&e<=r}t(oe,"runes"),t(ae,"nextUnits"),t(he,"isFirstOfSurrogatePair"),t(le,"isRegionalIndicator"),t(ue,"isSubdivisionFlag"),t(de,"isFitzpatrickModifier"),t(ce,"isVariationSelector"),t(fe,"isDiacriticalMark"),t(pe,"isSupplementarySpecialpurposePlane"),t(ge,"isGrapheme"),t(me,"isZeroWidthJoiner"),t(we,"codePointFromSurrogatePair"),t(Ae,"betweenInclusive");var Ve={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},ve=class{static{t(this,"ButtonState")}pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},ye=class{static{t(this,"GamepadState")}buttonState=new ve;stickState=new Map},xe=class{static{t(this,"FPSCounter")}dts=[];timer=0;fps=0;tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce(((e,t)=>e+t))/this.dts.length)),this.dts=[])}},Ee=t((e=>{if(!e.canvas)throw new Error("Please provide a canvas");let r={canvas:e.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new xe,timeScale:1,skipTime:!1,numFrames:0,mousePos:new l(0),mouseDeltaPos:new l(0),keyState:new ve,mouseState:new ve,mergedGamepadState:new ye,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:e.canvas.offsetWidth,lastHeight:e.canvas.offsetHeight,events:new j};function i(){return r.dt*r.timeScale}function n(){return r.time}function s(){return r.fpsCounter.fps}function o(){return r.numFrames}function h(){return r.canvas.toDataURL()}function u(e){r.canvas.style.cursor=e}function d(){return r.canvas.style.cursor}function c(e){if(e)try{let e=r.canvas.requestPointerLock();e.catch&&e.catch((e=>console.error(e)))}catch(e){console.error(e)}else document.exitPointerLock()}function f(){return!!document.pointerLockElement}function p(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function g(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}function m(){return document.fullscreenElement||document.webkitFullscreenElement}function w(e=!0){e?p(r.canvas):g()}function A(){return!!m()}function V(){r.stopped=!0;for(let e in fe)r.canvas.removeEventListener(e,fe[e]);for(let e in pe)document.removeEventListener(e,pe[e]);for(let e in ge)window.removeEventListener(e,ge[e]);Se.disconnect()}function v(n){null!==r.loopID&&cancelAnimationFrame(r.loopID);let s=0,o=t((t=>{if(r.stopped)return;if("visible"!==document.visibilityState)return void(r.loopID=requestAnimationFrame(o));let a=t/1e3,h=a-r.realTime,l=e.maxFPS?1/e.maxFPS:0;r.realTime=a,s+=h,s>l&&(r.skipTime||(r.dt=s,r.time+=i(),r.fpsCounter.tick(r.dt)),s=0,r.skipTime=!1,r.numFrames++,he(),n(),le()),r.loopID=requestAnimationFrame(o)}),"frame");o(0)}function y(){return"ontouchstart"in window||navigator.maxTouchPoints>0}function x(){return r.mousePos.clone()}function E(){return r.mouseDeltaPos.clone()}function S(e="left"){return r.mouseState.pressed.has(e)}function b(e="left"){return r.mouseState.down.has(e)}function R(e="left"){return r.mouseState.released.has(e)}function M(){return r.isMouseMoved}function P(e){return void 0===e?r.keyState.pressed.size>0:r.keyState.pressed.has(e)}function T(e){return void 0===e?r.keyState.pressedRepeat.size>0:r.keyState.pressedRepeat.has(e)}function B(e){return void 0===e?r.keyState.down.size>0:r.keyState.down.has(e)}function F(e){return void 0===e?r.keyState.released.size>0:r.keyState.released.has(e)}function I(e){return void 0===e?r.mergedGamepadState.buttonState.pressed.size>0:r.mergedGamepadState.buttonState.pressed.has(e)}function D(e){return void 0===e?r.mergedGamepadState.buttonState.down.size>0:r.mergedGamepadState.buttonState.down.has(e)}function C(e){return void 0===e?r.mergedGamepadState.buttonState.released.size>0:r.mergedGamepadState.buttonState.released.has(e)}function k(e){return r.events.on("resize",e)}t(i,"dt"),t(n,"time"),t(s,"fps"),t(o,"numFrames"),t(h,"screenshot"),t(u,"setCursor"),t(d,"getCursor"),t(c,"setCursorLocked"),t(f,"isCursorLocked"),t(p,"enterFullscreen"),t(g,"exitFullscreen"),t(m,"getFullscreenElement"),t(w,"setFullscreen"),t(A,"isFullscreen"),t(V,"quit"),t(v,"run"),t(y,"isTouchscreen"),t(x,"mousePos"),t(E,"mouseDeltaPos"),t(S,"isMousePressed"),t(b,"isMouseDown"),t(R,"isMouseReleased"),t(M,"isMouseMoved"),t(P,"isKeyPressed"),t(T,"isKeyPressedRepeat"),t(B,"isKeyDown"),t(F,"isKeyReleased"),t(I,"isGamepadButtonPressed"),t(D,"isGamepadButtonDown"),t(C,"isGamepadButtonReleased"),t(k,"onResize");let U=te((e=>r.events.on("keyDown",e)),((e,t)=>r.events.on("keyDown",(r=>r===e&&t(e))))),N=te((e=>r.events.on("keyPress",e)),((e,t)=>r.events.on("keyPress",(r=>r===e&&t(e))))),L=te((e=>r.events.on("keyPressRepeat",e)),((e,t)=>r.events.on("keyPressRepeat",(r=>r===e&&t(e))))),O=te((e=>r.events.on("keyRelease",e)),((e,t)=>r.events.on("keyRelease",(r=>r===e&&t(e))))),G=te((e=>r.events.on("mouseDown",(t=>e(t)))),((e,t)=>r.events.on("mouseDown",(r=>r===e&&t(r))))),q=te((e=>r.events.on("mousePress",(t=>e(t)))),((e,t)=>r.events.on("mousePress",(r=>r===e&&t(r))))),H=te((e=>r.events.on("mouseRelease",(t=>e(t)))),((e,t)=>r.events.on("mouseRelease",(r=>r===e&&t(r)))));function K(e){return r.events.on("mouseMove",(()=>e(x(),E())))}function Y(e){return r.events.on("charInput",e)}function Q(e){return r.events.on("touchStart",e)}function z(e){return r.events.on("touchMove",e)}function J(e){return r.events.on("touchEnd",e)}function X(e){return r.events.on("scroll",e)}function W(e){return r.events.on("hide",e)}function Z(e){return r.events.on("show",e)}function _(e,t){return"function"==typeof e?r.events.on("gamepadButtonDown",e):"string"==typeof e&&"function"==typeof t?r.events.on("gamepadButtonDown",(r=>r===e&&t(e))):void 0}function $(e,t){return"function"==typeof e?r.events.on("gamepadButtonPress",e):"string"==typeof e&&"function"==typeof t?r.events.on("gamepadButtonPress",(r=>r===e&&t(e))):void 0}function ee(e,t){return"function"==typeof e?r.events.on("gamepadButtonRelease",e):"string"==typeof e&&"function"==typeof t?r.events.on("gamepadButtonRelease",(r=>r===e&&t(e))):void 0}function re(e,t){return r.events.on("gamepadStick",((r,i)=>r===e&&t(i)))}function ie(e){r.events.on("gamepadConnect",e)}function ne(e){r.events.on("gamepadDisconnect",e)}function se(e){return r.mergedGamepadState.stickState.get(e)||new l(0)}function oe(){return[...r.charInputted]}function ae(){return[...r.gamepads]}function he(){r.events.trigger("input"),r.keyState.down.forEach((e=>r.events.trigger("keyDown",e))),r.mouseState.down.forEach((e=>r.events.trigger("mouseDown",e))),ce()}function le(){r.keyState.update(),r.mouseState.update(),r.mergedGamepadState.buttonState.update(),r.mergedGamepadState.stickState.forEach(((e,t)=>{r.mergedGamepadState.stickState.set(t,new l(0))})),r.charInputted=[],r.isMouseMoved=!1,r.gamepadStates.forEach((e=>{e.buttonState.update(),e.stickState.forEach(((t,r)=>{e.stickState.set(r,new l(0))}))}))}function ue(e){let t={index:e.index,isPressed:t=>r.gamepadStates.get(e.index).buttonState.pressed.has(t),isDown:t=>r.gamepadStates.get(e.index).buttonState.down.has(t),isReleased:t=>r.gamepadStates.get(e.index).buttonState.released.has(t),getStick:t=>r.gamepadStates.get(e.index).stickState.get(t)};return r.gamepads.push(t),r.gamepadStates.set(e.index,{buttonState:new ve,stickState:new Map([["left",new l(0)],["right",new l(0)]])}),t}function de(e){r.gamepads=r.gamepads.filter((t=>t.index!==e.index)),r.gamepadStates.delete(e.index)}function ce(){for(let e of navigator.getGamepads())e&&!r.gamepadStates.has(e.index)&&ue(e);for(let t of r.gamepads){let i=navigator.getGamepads()[t.index],n=(e.gamepads??{})[i.id]??Ve[i.id]??Ve.default,s=r.gamepadStates.get(t.index);for(let e=0;e<i.buttons.length;e++)i.buttons[e].pressed?(s.buttonState.down.has(n.buttons[e])||(r.mergedGamepadState.buttonState.press(n.buttons[e]),s.buttonState.press(n.buttons[e]),r.events.trigger("gamepadButtonPress",n.buttons[e])),r.events.trigger("gamepadButtonDown",n.buttons[e])):s.buttonState.down.has(n.buttons[e])&&(r.mergedGamepadState.buttonState.release(n.buttons[e]),s.buttonState.release(n.buttons[e]),r.events.trigger("gamepadButtonRelease",n.buttons[e]));for(let e in n.sticks){let t=n.sticks[e],o=new l(i.axes[t.x],i.axes[t.y]);s.stickState.set(e,o),r.mergedGamepadState.stickState.set(e,o),r.events.trigger("gamepadStick",e,o)}}}t(K,"onMouseMove"),t(Y,"onCharInput"),t(Q,"onTouchStart"),t(z,"onTouchMove"),t(J,"onTouchEnd"),t(X,"onScroll"),t(W,"onHide"),t(Z,"onShow"),t(_,"onGamepadButtonDown"),t($,"onGamepadButtonPress"),t(ee,"onGamepadButtonRelease"),t(re,"onGamepadStick"),t(ie,"onGamepadConnect"),t(ne,"onGamepadDisconnect"),t(se,"getGamepadStick"),t(oe,"charInputted"),t(ae,"getGamepads"),t(he,"processInput"),t(le,"resetInput"),t(ue,"registerGamepad"),t(de,"removeGamepad"),t(ce,"processGamepad");let fe={},pe={},ge={},me=e.pixelDensity||window.devicePixelRatio||1;fe.mousemove=e=>{let t=new l(e.offsetX,e.offsetY),i=new l(e.movementX,e.movementY);if(A()){let i=r.canvas.width/me,n=r.canvas.height/me,s=window.innerWidth,o=window.innerHeight;if(s/o>i/n){let r=o/n,h=(s-i*r)/2;t.x=a(e.offsetX-h,0,i*r,0,i),t.y=a(e.offsetY,0,n*r,0,n)}else{let r=s/i,h=(o-n*r)/2;t.x=a(e.offsetX,0,i*r,0,i),t.y=a(e.offsetY-h,0,n*r,0,n)}}r.events.onOnce("input",(()=>{r.isMouseMoved=!0,r.mousePos=t,r.mouseDeltaPos=i,r.events.trigger("mouseMove")}))};let we=["left","middle","right","back","forward"];fe.mousedown=e=>{r.events.onOnce("input",(()=>{let t=we[e.button];t&&(r.mouseState.press(t),r.events.trigger("mousePress",t))}))},fe.mouseup=e=>{r.events.onOnce("input",(()=>{let t=we[e.button];t&&(r.mouseState.release(t),r.events.trigger("mouseRelease",t))}))};let Ae=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),Ee={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};fe.keydown=e=>{Ae.has(e.key)&&e.preventDefault(),r.events.onOnce("input",(()=>{let t=Ee[e.key]||e.key.toLowerCase();1===t.length?(r.events.trigger("charInput",t),r.charInputted.push(t)):"space"===t&&(r.events.trigger("charInput"," "),r.charInputted.push(" ")),e.repeat?(r.keyState.pressRepeat(t),r.events.trigger("keyPressRepeat",t)):(r.keyState.press(t),r.events.trigger("keyPressRepeat",t),r.events.trigger("keyPress",t))}))},fe.keyup=e=>{r.events.onOnce("input",(()=>{let t=Ee[e.key]||e.key.toLowerCase();r.keyState.release(t),r.events.trigger("keyRelease",t)}))},fe.touchstart=t=>{t.preventDefault(),r.events.onOnce("input",(()=>{let i=[...t.changedTouches],n=r.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(r.mousePos=new l(i[0].clientX-n.x,i[0].clientY-n.y),r.mouseState.press("left"),r.events.trigger("mousePress","left")),i.forEach((e=>{r.events.trigger("touchStart",new l(e.clientX-n.x,e.clientY-n.y),e)}))}))},fe.touchmove=t=>{t.preventDefault(),r.events.onOnce("input",(()=>{let i=[...t.changedTouches],n=r.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(r.mousePos=new l(i[0].clientX-n.x,i[0].clientY-n.y),r.events.trigger("mouseMove")),i.forEach((e=>{r.events.trigger("touchMove",new l(e.clientX-n.x,e.clientY-n.y),e)}))}))},fe.touchend=t=>{r.events.onOnce("input",(()=>{let i=[...t.changedTouches],n=r.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(r.mousePos=new l(i[0].clientX-n.x,i[0].clientY-n.y),r.mouseState.release("left"),r.events.trigger("mouseRelease","left")),i.forEach((e=>{r.events.trigger("touchEnd",new l(e.clientX-n.x,e.clientY-n.y),e)}))}))},fe.touchcancel=t=>{r.events.onOnce("input",(()=>{let i=[...t.changedTouches],n=r.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(r.mousePos=new l(i[0].clientX-n.x,i[0].clientY-n.y),r.mouseState.release("left"),r.events.trigger("mouseRelease","left")),i.forEach((e=>{r.events.trigger("touchEnd",new l(e.clientX-n.x,e.clientY-n.y),e)}))}))},fe.wheel=e=>{e.preventDefault(),r.events.onOnce("input",(()=>{r.events.trigger("scroll",new l(e.deltaX,e.deltaY))}))},fe.contextmenu=e=>e.preventDefault(),pe.visibilitychange=()=>{"visible"===document.visibilityState?(r.skipTime=!0,r.events.trigger("show")):r.events.trigger("hide")},ge.gamepadconnected=e=>{let t=ue(e.gamepad);r.events.onOnce("input",(()=>{r.events.trigger("gamepadConnect",t)}))},ge.gamepaddisconnected=e=>{let t=ae().filter((t=>t.index===e.gamepad.index))[0];de(e.gamepad),r.events.onOnce("input",(()=>{r.events.trigger("gamepadDisconnect",t)}))};for(let e in fe)r.canvas.addEventListener(e,fe[e]);for(let e in pe)document.addEventListener(e,pe[e]);for(let e in ge)window.addEventListener(e,ge[e]);let Se=new ResizeObserver((e=>{for(let t of e)if(t.target===r.canvas){if(r.lastWidth===r.canvas.offsetWidth&&r.lastHeight===r.canvas.offsetHeight)return;r.lastWidth=r.canvas.offsetWidth,r.lastHeight=r.canvas.offsetHeight,r.events.onOnce("input",(()=>{r.events.trigger("resize")}))}}));return Se.observe(r.canvas),{dt:i,time:n,run:v,canvas:r.canvas,fps:s,numFrames:o,quit:V,setFullscreen:w,isFullscreen:A,setCursor:u,screenshot:h,getGamepads:ae,getCursor:d,setCursorLocked:c,isCursorLocked:f,isTouchscreen:y,mousePos:x,mouseDeltaPos:E,isKeyDown:B,isKeyPressed:P,isKeyPressedRepeat:T,isKeyReleased:F,isMouseDown:b,isMousePressed:S,isMouseReleased:R,isMouseMoved:M,isGamepadButtonPressed:I,isGamepadButtonDown:D,isGamepadButtonReleased:C,getGamepadStick:se,charInputted:oe,onResize:k,onKeyDown:U,onKeyPress:N,onKeyPressRepeat:L,onKeyRelease:O,onMouseDown:G,onMousePress:q,onMouseRelease:H,onMouseMove:K,onCharInput:Y,onTouchStart:Q,onTouchMove:z,onTouchEnd:J,onScroll:X,onHide:W,onShow:Z,onGamepadButtonDown:_,onGamepadButtonPress:$,onGamepadButtonRelease:ee,onGamepadStick:re,onGamepadConnect:ie,onGamepadDisconnect:ne,events:r.events}}),"default"),Se=class e{static{t(this,"Texture")}ctx;src=null;glTex;width;height;constructor(e,t,r,i={}){this.ctx=e;let n=e.gl;this.glTex=e.gl.createTexture(),e.onDestroy((()=>this.free())),this.width=t,this.height=r;let s={linear:n.LINEAR,nearest:n.NEAREST}[i.filter??e.opts.texFilter]??n.NEAREST,o={repeat:n.REPEAT,clampToEadge:n.CLAMP_TO_EDGE}[i.wrap]??n.CLAMP_TO_EDGE;this.bind(),t&&r&&n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t,r,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,s),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,s),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,o),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,o),this.unbind()}static fromImage(t,r,i={}){let n=new e(t,r.width,r.height,i);return n.update(r),n.src=r,n}update(e,t=0,r=0){let i=this.ctx.gl;this.bind(),i.texSubImage2D(i.TEXTURE_2D,0,t,r,i.RGBA,i.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},be=class{static{t(this,"FrameBuffer")}ctx;tex;glFramebuffer;glRenderbuffer;constructor(e,t,r,i={}){this.ctx=e;let n=e.gl;e.onDestroy((()=>this.free())),this.tex=new Se(e,t,r,i),this.glFramebuffer=n.createFramebuffer(),this.glRenderbuffer=n.createRenderbuffer(),this.bind(),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,t,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.tex.glTex,0),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,t=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,t),this.unbind();let r=4*this.width,i=new Uint8Array(r);for(let e=0;e<(this.height/2|0);e++){let n=e*r,s=(this.height-e-1)*r;i.set(t.subarray(n,n+r)),t.copyWithin(n,s,s+r),t.set(i,s)}return new ImageData(t,this.width,this.height)}toDataURL(){let e=document.createElement("canvas"),t=e.getContext("2d");return e.width=this.width,e.height=this.height,t.putImageData(this.toImageData(),0,0),e.toDataURL()}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},Re=class{static{t(this,"Shader")}ctx;glProgram;constructor(e,t,r,i){this.ctx=e,e.onDestroy((()=>this.free()));let n=e.gl,s=n.createShader(n.VERTEX_SHADER),o=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(s,t),n.shaderSource(o,r),n.compileShader(s),n.compileShader(o);let a=n.createProgram();if(this.glProgram=a,n.attachShader(a,s),n.attachShader(a,o),i.forEach(((e,t)=>n.bindAttribLocation(a,t,e))),n.linkProgram(a),!n.getProgramParameter(a,n.LINK_STATUS)){let e=n.getShaderInfoLog(s);if(e)throw new Error("VERTEX SHADER "+e);let t=n.getShaderInfoLog(o);if(t)throw new Error("FRAGMENT SHADER "+t)}n.deleteShader(s),n.deleteShader(o)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let t=this.ctx.gl;for(let r in e){let i=e[r],n=t.getUniformLocation(this.glProgram,r);"number"==typeof i?t.uniform1f(n,i):i instanceof m?t.uniformMatrix4fv(n,!1,new Float32Array(i.m)):i instanceof d?t.uniform3f(n,i.r,i.g,i.b):i instanceof l&&t.uniform2f(n,i.x,i.y)}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},Me=class{static{t(this,"BatchRenderer")}ctx;glVBuf;glIBuf;vqueue=[];iqueue=[];stride;maxVertices;maxIndices;vertexFormat;numDraws=0;curPrimitive=null;curTex=null;curShader=null;curUniform={};constructor(e,t,r,i){let n=e.gl;this.vertexFormat=t,this.ctx=e,this.stride=t.reduce(((e,t)=>e+t.size),0),this.maxVertices=r,this.maxIndices=i,this.glVBuf=n.createBuffer(),e.pushArrayBuffer(this.glVBuf),n.bufferData(n.ARRAY_BUFFER,4*r,n.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=n.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),n.bufferData(n.ELEMENT_ARRAY_BUFFER,4*i,n.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,t,r,i,n=null,s={}){(e!==this.curPrimitive||n!==this.curTex||i!==this.curShader||!Q(this.curUniform,s)||this.vqueue.length+t.length*this.stride>this.maxVertices||this.iqueue.length+r.length>this.maxIndices)&&this.flush();let o=this.vqueue.length/this.stride;for(let e of t)this.vqueue.push(e);for(let e of r)this.iqueue.push(e+o);this.curPrimitive=e,this.curShader=i,this.curTex=n,this.curUniform=s}flush(){if(!this.curPrimitive||!this.curShader||0===this.vqueue.length||0===this.iqueue.length)return;let e=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),this.curTex?.bind(),e.drawElements(this.curPrimitive,this.iqueue.length,e.UNSIGNED_SHORT,0),this.curTex?.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}};function Pe(e){let r=[],i=t((t=>{r.push(t),e(t)}),"push"),n=t((()=>{r.pop(),e(s()??null)}),"pop"),s=t((()=>r[r.length-1]),"cur");return[i,n,s]}function Te(e,r={}){let i=[];function n(e){i.push(e)}function s(){i.forEach((e=>e())),e.getExtension("WEBGL_lose_context").loseContext()}t(n,"onDestroy"),t(s,"destroy");let o=null;function a(t){if(Q(t,o))return;o=t;let r=t.reduce(((e,t)=>e+t.size),0);t.reduce(((t,i,n)=>(e.vertexAttribPointer(n,i.size,e.FLOAT,!1,4*r,t),e.enableVertexAttribArray(n),t+4*i.size)),0)}t(a,"setVertexFormat");let[h,l]=Pe((t=>e.bindTexture(e.TEXTURE_2D,t))),[u,d]=Pe((t=>e.bindBuffer(e.ARRAY_BUFFER,t))),[c,f]=Pe((t=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t))),[p,g]=Pe((t=>e.bindFramebuffer(e.FRAMEBUFFER,t))),[m,w]=Pe((t=>e.bindRenderbuffer(e.RENDERBUFFER,t))),[A,V]=Pe((({x:t,y:r,w:i,h:n})=>{e.viewport(t,r,i,n)})),[v,y]=Pe((t=>e.useProgram(t)));return A({x:0,y:0,w:e.drawingBufferWidth,h:e.drawingBufferHeight}),{gl:e,opts:r,onDestroy:n,destroy:s,pushTexture2D:h,popTexture2D:l,pushArrayBuffer:u,popArrayBuffer:d,pushElementArrayBuffer:c,popElementArrayBuffer:f,pushFramebuffer:p,popFramebuffer:g,pushRenderbuffer:m,popRenderbuffer:w,pushViewport:A,popViewport:V,pushProgram:v,popProgram:y,setVertexFormat:a}}t(Pe,"genStack"),t(Te,"initGfx");var Be=class e{static{t(this,"Asset")}loaded=!1;data=null;error=null;onLoadEvents=new Y;onErrorEvents=new Y;onFinishEvents=new Y;constructor(e){e.then((e=>{this.data=e,this.onLoadEvents.trigger(e)})).catch((e=>{if(this.error=e,!(this.onErrorEvents.numListeners()>0))throw e;this.onErrorEvents.trigger(e)})).finally((()=>{this.onFinishEvents.trigger(),this.loaded=!0}))}static loaded(t){let r=new e(Promise.resolve(t));return r.data=t,r.loaded=!0,r}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},Fe=class{static{t(this,"AssetBucket")}assets=new Map;lastUID=0;add(e,t){let r=e??this.lastUID+++"",i=new Be(t);return this.assets.set(r,i),i}addLoaded(e,t){let r=e??this.lastUID+++"",i=Be.loaded(t);return this.assets.set(r,i),i}get(e){return this.assets.get(e)}progress(){if(0===this.assets.size)return 1;let e=0;return this.assets.forEach((t=>{t.loaded&&e++})),e/this.assets.size}};function Ie(e){return fetch(e).then((t=>{if(!t.ok)throw new Error(`Failed to fetch "${e}"`);return t}))}function De(e){return Ie(e).then((e=>e.json()))}function Ce(e){return Ie(e).then((e=>e.text()))}function ke(e){return Ie(e).then((e=>e.arrayBuffer()))}function Ue(e){let t=new Image;return t.crossOrigin="anonymous",t.src=e,new Promise(((r,i)=>{t.onload=()=>r(t),t.onerror=()=>i(new Error(`Failed to load image from "${e}"`))}))}t(Ie,"fetchURL"),t(De,"fetchJSON"),t(Ce,"fetchText"),t(ke,"fetchArrayBuffer"),t(Ue,"loadImg");var Ne=2.5949095,Le=2.70158,Oe=2*Math.PI/3,Ge=2*Math.PI/4.5,qe={linear:e=>e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInExpo:e=>0===e?0:Math.pow(2,10*e-10),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>Le*e*e*e-1.70158*e*e,easeOutBack:e=>1+Le*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*(7.189819*e-Ne)/2:(Math.pow(2*e-2,2)*((Ne+1)*(2*e-2)+Ne)+2)/2,easeInElastic:e=>0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*Oe),easeOutElastic:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*Oe)+1,easeInOutElastic:e=>0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*Ge)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*Ge)/2+1,easeInBounce:e=>1-qe.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?(1-qe.easeOutBounce(1-2*e))/2:(1+qe.easeOutBounce(2*e-1))/2},He=qe,Ke=class{static{t(this,"TexPacker")}textures=[];canvas;c2d;x=0;y=0;curHeight=0;gfx;constructor(e,t,r){this.gfx=e,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=r,this.textures=[Se.fromImage(e,this.canvas)],this.c2d=this.canvas.getContext("2d")}add(e){if(e.width>this.canvas.width||e.height>this.canvas.height)throw new Error(`Texture size (${e.width} x ${e.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+e.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+e.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(Se.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let t=this.textures[this.textures.length-1],r=new l(this.x,this.y);return this.x+=e.width,e.height>this.curHeight&&(this.curHeight=e.height),e instanceof ImageData?this.c2d.putImageData(e,r.x,r.y):this.c2d.drawImage(e,r.x,r.y),t.update(this.canvas),[t,new p(r.x/this.canvas.width,r.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height)]}free(){for(let e of this.textures)e.free()}},Ye=r("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),je=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",Qe="topleft",ze="monospace",Je="linear",Xe=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],We=8192*Xe.reduce(((e,t)=>e+t.size),0),Ze="\nvec4 vert(vec2 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n",_e="\nvec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n",$e=new Set(["id","require"]),et=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function tt(e){switch(e){case"topleft":return new l(-1,-1);case"top":return new l(0,-1);case"topright":return new l(1,-1);case"left":return new l(-1,0);case"center":return new l(0,0);case"right":return new l(1,0);case"botleft":return new l(-1,1);case"bot":return new l(0,1);case"botright":return new l(1,1);default:return e}}function rt(e){switch(e){case"left":default:return 0;case"center":return.5;case"right":return 1}}function it(e){return e.createBuffer(1,1,44100)}t(tt,"anchorPt"),t(rt,"alignPt"),t(it,"createEmptyAudioBuffer"),t(((e={})=>{let r=e.root??document.body;r===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let A=e.canvas??(()=>{let e=document.createElement("canvas");return r.appendChild(e),e})(),v=e.scale??1,M=e.width&&e.height&&!e.stretch&&!e.letterbox;M?(A.width=e.width*v,A.height=e.height*v):(A.width=A.parentElement.offsetWidth,A.height=A.parentElement.offsetHeight);let D=["outline: none","cursor: default"];if(M){let e=A.width,t=A.height;D.push(`width: ${e}px`),D.push(`height: ${t}px`)}else D.push("width: 100%"),D.push("height: 100%");e.crisp&&(D.push("image-rendering: pixelated"),D.push("image-rendering: crisp-edges")),A.style.cssText=D.join(";");let O=e.pixelDensity||window.devicePixelRatio;A.width*=O,A.height*=O,A.tabIndex=0;let Q=document.createElement("canvas");Q.width=256,Q.height=256;let z=Q.getContext("2d",{willReadFrequently:!0}),se=Ee({canvas:A,touchToMouse:e.touchToMouse,gamepads:e.gamepads,pixelDensity:e.pixelDensity,maxFPS:e.maxFPS}),ae=[],he=se.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0}),le=Te(he,{texFilter:e.texFilter}),ue=(()=>{let t=xt(Ze,_e),r=Se.fromImage(le,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),i=e.width&&e.height?new be(le,e.width*O*v,e.height*O*v):new be(le,he.drawingBufferWidth,he.drawingBufferHeight),n=null,s=1;e.background&&(n=c(e.background),s=Array.isArray(e.background)?e.background[3]:1,he.clearColor(n.r/255,n.g/255,n.b/255,s??1)),he.enable(he.BLEND),he.blendFuncSeparate(he.SRC_ALPHA,he.ONE_MINUS_SRC_ALPHA,he.ONE,he.ONE_MINUS_SRC_ALPHA);let o=new Me(le,Xe,We,12288),a=Se.fromImage(le,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,defShader:t,defTex:r,frameBuffer:i,postShader:null,postShaderUniform:null,renderer:o,transform:new m,transformStack:[],bgTex:a,bgColor:n,bgAlpha:s,width:e.width??he.drawingBufferWidth/O/v,height:e.height??he.drawingBufferHeight/O/v,viewport:{x:0,y:0,width:he.drawingBufferWidth,height:he.drawingBufferHeight},fixed:!1}})();class de{static{t(this,"SpriteData")}tex;frames=[new p(0,0,1,1)];anims={};slice9=null;constructor(e,t,r={},i=null){this.tex=e,t&&(this.frames=t),this.anims=r,this.slice9=i}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(e,t={}){return"string"==typeof e?de.fromURL(e,t):Promise.resolve(de.fromImage(e,t))}static fromImage(e,t={}){let[r,i]=pe.packer.add(e),n=t.frames?t.frames.map((e=>new p(i.x+e.x*i.w,i.y+e.y*i.h,e.w*i.w,e.h*i.h))):Ie(t.sliceX||1,t.sliceY||1,i.x,i.y,i.w,i.h);return new de(r,n,t.anims,t.slice9)}static fromURL(e,t={}){return Ue(e).then((e=>de.fromImage(e,t)))}}class ce{static{t(this,"SoundData")}buf;constructor(e){this.buf=e}static fromArrayBuffer(e){return new Promise(((t,r)=>fe.ctx.decodeAudioData(e,t,r))).then((e=>new ce(e)))}static fromURL(e){return $(e)?ce.fromArrayBuffer(J(e)):ke(e).then((e=>ce.fromArrayBuffer(e)))}}let fe=(()=>{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain();t.connect(e.destination);let r=new ce(it(e));return e.decodeAudioData(Ye.buffer.slice(0)).then((e=>{r.buf=e})).catch((e=>{console.error("Failed to load burp: ",e)})),{ctx:e,masterNode:t,burpSnd:r}})(),pe={urlPrefix:"",sprites:new Fe,fonts:new Fe,bitmapFonts:new Fe,sounds:new Fe,shaders:new Fe,custom:new Fe,packer:new Ke(le,2048,2048),loaded:!1};function ge(e){return"string"!=typeof e||$(e)?e:pe.urlPrefix+e}t(ge,"fixURL");let me={events:new j,objEvents:new j,root:vr([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new l(1),angle:0,shake:0,transform:new m}};function we(e){return pe.custom.add(null,e)}function Ae(){let e=[pe.sprites,pe.sounds,pe.shaders,pe.fonts,pe.bitmapFonts,pe.custom];return e.reduce(((e,t)=>e+t.progress()),0)/e.length}function Ve(e){return void 0!==e&&(pe.urlPrefix=e),pe.urlPrefix}function ve(e,t){return pe.custom.add(e,De(t))}me.root.use(oi()),t(we,"load"),t(Ae,"loadProgress"),t(Ve,"loadRoot"),t(ve,"loadJSON");class ye{static{t(this,"FontData")}fontface;filter=Je;outline=null;size=64;constructor(e,t={}){if(this.fontface=e,this.filter=t.filter??Je,this.size=t.size??64,this.size>256)throw new Error("Max font size: 256");t.outline&&(this.outline={width:1,color:c(0,0,0)},"number"==typeof t.outline?this.outline.width=t.outline:"object"==typeof t.outline&&(t.outline.width&&(this.outline.width=t.outline.width),t.outline.color&&(this.outline.color=t.outline.color)))}}function xe(e,t,r={}){let i=new FontFace(e,"string"==typeof t?`url(${t})`:t);return document.fonts.add(i),pe.fonts.add(e,i.load().catch((e=>{throw new Error(`Failed to load font from "${t}": ${e}`)})).then((e=>new ye(e,r))))}function Pe(e,t,r,i,n={}){return pe.bitmapFonts.add(e,Ue(t).then((e=>Et(Se.fromImage(le,e,n),r,i,n.chars??je))))}function Ie(e=1,t=1,r=0,i=0,n=1,s=1){let o=[],a=n/e,h=s/t;for(let n=0;n<t;n++)for(let t=0;t<e;t++)o.push(new p(r+t*a,i+n*h,a,h));return o}function Ne(e,t){return e=ge(e),we("string"==typeof t?new Promise(((r,i)=>{De(t).then((t=>{Ne(e,t).then(r).catch(i)}))})):de.from(e).then((e=>{let r={};for(let i in t){let n=t[i],s=e.frames[0],o=2048*s.w,a=2048*s.h,h=n.frames?n.frames.map((e=>new p(s.x+(n.x+e.x)/o*s.w,s.y+(n.y+e.y)/a*s.h,e.w/o*s.w,e.h/a*s.h))):Ie(n.sliceX||1,n.sliceY||1,s.x+n.x/o*s.w,s.y+n.y/a*s.h,n.width/o*s.w,n.height/a*s.h),l=new de(e.tex,h,n.anims);pe.sprites.addLoaded(i,l),r[i]=l}return r})))}function Le(e,t={}){let r=document.createElement("canvas"),i=e[0].width,n=e[0].height;r.width=i*e.length,r.height=n;let s=r.getContext("2d");e.forEach(((e,t)=>{e instanceof ImageData?s.putImageData(e,t*i,0):s.drawImage(e,t*i,0)}));let o=s.getImageData(0,0,e.length*i,n);return de.fromImage(o,{...t,sliceX:e.length,sliceY:1})}function Oe(e,t,r={sliceX:1,sliceY:1,anims:{}}){return t=ge(t),Array.isArray(t)?t.some((e=>"string"==typeof e))?pe.sprites.add(e,Promise.all(t.map((e=>"string"==typeof e?Ue(e):Promise.resolve(e)))).then((e=>Le(e,r)))):pe.sprites.addLoaded(e,Le(t,r)):"string"==typeof t?pe.sprites.add(e,de.from(t,r)):pe.sprites.addLoaded(e,de.fromImage(t,r))}function Ge(e,t){return t=ge(t),pe.sprites.add(e,new Promise((async e=>{let r="string"==typeof t?await De(t):t,i=await Promise.all(r.frames.map(Ue)),n=document.createElement("canvas");n.width=r.width,n.height=r.height*r.frames.length;let s=n.getContext("2d");i.forEach(((e,t)=>{s.drawImage(e,0,t*r.height)})),e(await Oe(null,n,{sliceY:r.frames.length,anims:r.anims}))})))}function qe(e,t,r){t=ge(t),r=ge(r),"string"==typeof t&&!r&&(r=ee(t)+".json");let i="string"==typeof r?De(r):Promise.resolve(r);return pe.sprites.add(e,i.then((e=>{let r=e.meta.size,i=e.frames.map((e=>new p(e.frame.x/r.w,e.frame.y/r.h,e.frame.w/r.w,e.frame.h/r.h))),n={};for(let t of e.meta.frameTags)t.from===t.to?n[t.name]=t.from:n[t.name]={from:t.from,to:t.to,speed:10,loop:!0,pingpong:"pingpong"===t.direction};return de.from(t,{frames:i,anims:n})})))}function nt(e,t,r){return pe.shaders.addLoaded(e,xt(t,r))}function st(e,r,i){r=ge(r),i=ge(i);let n=t((e=>e?Ce(e):Promise.resolve(null)),"resolveUrl"),s=Promise.all([n(r),n(i)]).then((([e,t])=>xt(e,t)));return pe.shaders.add(e,s)}function ot(e,t){return t=ge(t),pe.sounds.add(e,"string"==typeof t?ce.fromURL(t):ce.fromArrayBuffer(t))}function at(e="bean"){return Oe(e,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==")}function ht(e){return pe.sprites.get(e)}function lt(e){return pe.sounds.get(e)}function ut(e){return pe.fonts.get(e)}function dt(e){return pe.bitmapFonts.get(e)}function ct(e){return pe.shaders.get(e)}function ft(e){return pe.custom.get(e)}function pt(e){if("string"==typeof e){let t=ht(e);if(t)return t;if(Ae()<1)return null;throw new Error(`Sprite not found: ${e}`)}if(e instanceof de)return Be.loaded(e);if(e instanceof Be)return e;throw new Error(`Invalid sprite: ${e}`)}function gt(e){if("string"==typeof e){let t=lt(e);if(t)return t;if(Ae()<1)return null;throw new Error(`Sound not found: ${e}`)}if(e instanceof ce)return Be.loaded(e);if(e instanceof Be)return e;throw new Error(`Invalid sound: ${e}`)}function mt(e){if(!e)return ue.defShader;if("string"==typeof e){let t=ct(e);if(t)return t.data??t;if(Ae()<1)return null;throw new Error(`Shader not found: ${e}`)}return e instanceof Be&&e.data?e.data:e}function wt(t){if(!t)return wt(e.font??"monospace");if("string"==typeof t){let e=dt(t),r=ut(t);if(e)return e.data??e;if(r)return r.data??r;if(document.fonts.check(`64px ${t}`))return t;if(Ae()<1)return null;throw new Error(`Font not found: ${t}`)}return t instanceof Be&&t.data?t.data:t}function At(e){return void 0!==e&&(fe.masterNode.gain.value=e),fe.masterNode.gain.value}function Vt(e,r={}){let i=fe.ctx,n=r.paused??!1,s=i.createBufferSource(),o=new Y,a=i.createGain(),h=r.seek??0,l=0,u=0,d=!1;s.loop=!!r.loop,s.detune.value=r.detune??0,s.playbackRate.value=r.speed??1,s.connect(a),s.onended=()=>{p()>=s.buffer?.duration&&o.trigger()},a.connect(fe.masterNode),a.gain.value=r.volume??1;let c=t((e=>{s.buffer=e.buf,n||(l=i.currentTime,s.start(0,h),d=!0)}),"start"),f=gt(e);f instanceof Be&&f.onLoad(c);let p=t((()=>{if(!s.buffer)return 0;let e=n?u-l:i.currentTime-l,t=s.buffer.duration;return s.loop?e%t:Math.min(e,t)}),"getTime"),g=t((e=>{let t=i.createBufferSource();return t.buffer=e.buffer,t.loop=e.loop,t.playbackRate.value=e.playbackRate.value,t.detune.value=e.detune.value,t.onended=e.onended,t.connect(a),t}),"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(e){if(n!==e)if(n=e,e)d&&(s.stop(),d=!1),u=i.currentTime;else{s=g(s);let e=u-l;s.start(0,e),d=!0,l=i.currentTime-e,u=0}},get paused(){return n},play(e=0){this.seek(e),this.paused=!1},seek(e){s.buffer?.duration&&(e>s.buffer.duration||(n?(s=g(s),l=u-e):(s.stop(),s=g(s),l=i.currentTime-e,s.start(0,e),d=!0,u=0)))},set speed(e){s.playbackRate.value=e},get speed(){return s.playbackRate.value},set detune(e){s.detune.value=e},get detune(){return s.detune.value},set volume(e){a.gain.value=Math.max(e,0)},get volume(){return a.gain.value},set loop(e){s.loop=e},get loop(){return s.loop},duration:()=>s.buffer?.duration??0,time(){return p()%this.duration()},onEnd:e=>o.add(e),then(e){return this.onEnd(e)}}}function vt(e){return Vt(fe.burpSnd,e)}function yt(e,t){return new be(le,e,t)}function xt(e=Ze,t=_e){let r="\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 0.0, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n".replace("{{user}}",e??Ze),i="\nprecision mediump float;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\treturn v_color * texture2D(u_tex, v_uv);\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n".replace("{{user}}",t??_e);try{return new Re(le,r,i,Xe.map((e=>e.name)))}catch(e){let t=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,r=ie(e).match(t),i=Number(r.groups.line)-14,n=r.groups.msg.trim(),s=r.groups.type.toLowerCase();throw new Error(`${s} shader line ${i}: ${n}`)}}function Et(e,t,r,i){let n=e.width/t,s={},o=i.split("").entries();for(let[e,i]of o)s[i]=new p(e%n*t,Math.floor(e/n)*r,t,r);return{tex:e,map:s,size:r}}function St(e,t,r,i=ue.defTex,n=ue.defShader,s={}){let o=mt(n);if(!o||o instanceof Be)return;let a=ue.fixed||r?ue.transform:me.cam.transform.mult(ue.transform),h=[];for(let t of e){let e=Tt(a.multVec2(t.pos));h.push(e.x,e.y,t.uv.x,t.uv.y,t.color.r/255,t.color.g/255,t.color.b/255,t.opacity)}ue.renderer.push(he.TRIANGLES,h,t,o,i,s)}function bt(){ue.renderer.flush()}function Rt(){he.clear(he.COLOR_BUFFER_BIT),ue.frameBuffer.bind(),he.clear(he.COLOR_BUFFER_BIT),ue.bgColor||Zt((()=>{Ut({width:sr(),height:or(),quad:new p(0,0,sr()/64,or()/64),tex:ue.bgTex,fixed:!0})})),ue.renderer.numDraws=0,ue.fixed=!1,ue.transformStack.length=0,ue.transform=new m}function Mt(e,t){ue.postShader=e,ue.postShaderUniform=t??null}function Pt(){bt(),ue.lastDrawCalls=ue.renderer.numDraws,ue.frameBuffer.unbind(),he.viewport(0,0,he.drawingBufferWidth,he.drawingBufferHeight);let e=ue.width,t=ue.height;ue.width=he.drawingBufferWidth/O,ue.height=he.drawingBufferHeight/O,Nt({flipY:!0,tex:ue.frameBuffer.tex,pos:new l(ue.viewport.x,ue.viewport.y),width:ue.viewport.width,height:ue.viewport.height,shader:ue.postShader,uniform:"function"==typeof ue.postShaderUniform?ue.postShaderUniform():ue.postShaderUniform,fixed:!0}),bt(),ue.width=e,ue.height=t}function Tt(e){return new l(e.x/sr()*2-1,-e.y/or()*2+1)}function Bt(e){ue.transform=e.clone()}function Ft(...e){if(void 0===e[0])return;let t=u(...e);0===t.x&&0===t.y||ue.transform.translate(t)}function It(...e){if(void 0===e[0])return;let t=u(...e);1===t.x&&1===t.y||ue.transform.scale(t)}function Dt(e){e&&ue.transform.rotate(e)}function Ct(){ue.transformStack.push(ue.transform.clone())}function kt(){ue.transformStack.length>0&&(ue.transform=ue.transformStack.pop())}function Ut(e){if(void 0===e.width||void 0===e.height)throw new Error('drawUVQuad() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,r=e.height,i=tt(e.anchor||Qe).scale(new l(t,r).scale(-.5)),n=e.quad||new p(0,0,1,1),s=e.color||c(255,255,255),o=e.opacity??1,a=e.tex?.1/e.tex.width:0,h=e.tex?.1/e.tex.height:0,u=n.x+a,d=n.y+h,f=n.w-2*a,g=n.h-2*h;Ct(),Ft(e.pos),Dt(e.angle),It(e.scale),Ft(i),St([{pos:new l(-t/2,r/2),uv:new l(e.flipX?u+f:u,e.flipY?d:d+g),color:s,opacity:o},{pos:new l(-t/2,-r/2),uv:new l(e.flipX?u+f:u,e.flipY?d+g:d),color:s,opacity:o},{pos:new l(t/2,-r/2),uv:new l(e.flipX?u:u+f,e.flipY?d+g:d),color:s,opacity:o},{pos:new l(t/2,r/2),uv:new l(e.flipX?u:u+f,e.flipY?d:d+g),color:s,opacity:o}],[0,1,3,1,2,3],e.fixed,e.tex,e.shader,e.uniform),kt()}function Nt(e){if(!e.tex)throw new Error('drawTexture() requires property "tex".');let t=e.quad??new p(0,0,1,1),r=e.tex.width*t.w,i=e.tex.height*t.h,n=new l(1);if(e.tiled){let s=Math.ceil((e.width||r)/r),o=Math.ceil((e.height||i)/i),a=tt(e.anchor||Qe).add(new l(1,1)).scale(.5).scale(s*r,o*i);for(let h=0;h<s;h++)for(let s=0;s<o;s++)Ut(Object.assign({},e,{pos:(e.pos||new l(0)).add(new l(r*h,i*s)).sub(a),scale:n.scale(e.scale||new l(1)),tex:e.tex,quad:t,width:r,height:i,anchor:"topleft"}))}else e.width&&e.height?(n.x=e.width/r,n.y=e.height/i):e.width?(n.x=e.width/r,n.y=n.x):e.height&&(n.y=e.height/i,n.x=n.y),Ut(Object.assign({},e,{scale:n.scale(e.scale||new l(1)),tex:e.tex,quad:t,width:r,height:i}))}function Lt(e){if(!e.sprite)throw new Error('drawSprite() requires property "sprite"');let t=pt(e.sprite);if(!t||!t.data)return;let r=t.data.frames[e.frame??0];if(!r)throw new Error(`Frame not found: ${e.frame??0}`);Nt(Object.assign({},e,{tex:t.data.tex,quad:r.scale(e.quad??new p(0,0,1,1))}))}function Ot(e,t,r,n,s,o=1){n=i(n%360),(s=i(s%360))<=n&&(s+=2*Math.PI);let a=[],h=(s-n)/Math.ceil((s-n)/i(8)*o);for(let i=n;i<s;i+=h)a.push(e.add(t*Math.cos(i),r*Math.sin(i)));return a.push(e.add(t*Math.cos(s),r*Math.sin(s))),a}function Gt(e){if(void 0===e.width||void 0===e.height)throw new Error('drawRect() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,r=e.height,i=tt(e.anchor||Qe).add(1,1).scale(new l(t,r).scale(-.5)),n=[new l(0,0),new l(t,0),new l(t,r),new l(0,r)];if(e.radius){let i=Math.min(Math.min(t,r)/2,e.radius);n=[new l(i,0),new l(t-i,0),...Ot(new l(t-i,i),i,i,270,360),new l(t,i),new l(t,r-i),...Ot(new l(t-i,r-i),i,i,0,90),new l(t-i,r),new l(i,r),...Ot(new l(i,r-i),i,i,90,180),new l(0,r-i),new l(0,i),...Ot(new l(i,i),i,i,180,270)]}Qt(Object.assign({},e,{offset:i,pts:n,...e.gradient?{colors:e.horizontal?[e.gradient[0],e.gradient[1],e.gradient[1],e.gradient[0]]:[e.gradient[0],e.gradient[0],e.gradient[1],e.gradient[1]]}:{}}))}function qt(e){let{p1:t,p2:r}=e;if(!t||!r)throw new Error('drawLine() requires properties "p1" and "p2".');let i=e.width||1,n=r.sub(t).unit().normal().scale(.5*i);St([t.sub(n),t.add(n),r.add(n),r.sub(n)].map((t=>({pos:new l(t.x,t.y),uv:new l(0),color:e.color??d.WHITE,opacity:e.opacity??1}))),[0,1,3,1,2,3],e.fixed,ue.defTex,e.shader,e.uniform)}function Ht(e){let t=e.pts;if(!t)throw new Error('drawLines() requires property "pts".');if(!(t.length<2))if(e.radius&&t.length>=3){let r=t[0].sdist(t[1]);for(let e=1;e<t.length-1;e++)r=Math.min(t[e].sdist(t[e+1]),r);Math.min(e.radius,Math.sqrt(r)/2),qt(Object.assign({},e,{p1:t[0],p2:t[1]}));for(let r=1;r<t.length-2;r++){let i=t[r],n=t[r+1];qt(Object.assign({},e,{p1:i,p2:n}))}qt(Object.assign({},e,{p1:t[t.length-2],p2:t[t.length-1]}))}else for(let r=0;r<t.length-1;r++)qt(Object.assign({},e,{p1:t[r],p2:t[r+1]})),"none"!==e.join&&Yt(Object.assign({},e,{pos:t[r],radius:e.width/2}))}function Kt(e){if(!e.p1||!e.p2||!e.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return Qt(Object.assign({},e,{pts:[e.p1,e.p2,e.p3]}))}function Yt(e){if("number"!=typeof e.radius)throw new Error('drawCircle() requires property "radius".');0!==e.radius&&jt(Object.assign({},e,{radiusX:e.radius,radiusY:e.radius,angle:0}))}function jt(e){if(void 0===e.radiusX||void 0===e.radiusY)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(0===e.radiusX||0===e.radiusY)return;let t=e.start??0,r=e.end??360,i=tt(e.anchor??"center").scale(new l(-e.radiusX,-e.radiusY)),n=Ot(i,e.radiusX,e.radiusY,t,r,e.resolution);n.unshift(i);let s=Object.assign({},e,{pts:n,radius:0,...e.gradient?{colors:[e.gradient[0],...Array(n.length-1).fill(e.gradient[1])]}:{}});if(r-t>=360&&e.outline)return!1!==e.fill&&Qt(Object.assign(s,{outline:null})),void Qt(Object.assign(s,{pts:n.slice(1),fill:!1}));Qt(s)}function Qt(e){if(!e.pts)throw new Error('drawPolygon() requires property "pts".');let t=e.pts.length;if(!(t<3)){if(Ct(),Ft(e.pos),It(e.scale),Dt(e.angle),Ft(e.offset),!1!==e.fill){let r=e.color??d.WHITE,i=e.pts.map(((t,i)=>({pos:new l(t.x,t.y),uv:new l(0,0),color:e.colors&&e.colors[i]?e.colors[i].mult(r):r,opacity:e.opacity??1}))),n=[...Array(t-2).keys()].map((e=>[0,e+1,e+2])).flat();St(i,e.indices??n,e.fixed,ue.defTex,e.shader,e.uniform)}e.outline&&Ht({pts:[...e.pts,e.pts[0]],radius:e.radius,width:e.outline.width,color:e.outline.color,join:e.outline.join,uniform:e.uniform,fixed:e.fixed,opacity:e.opacity}),kt()}}function zt(e,t,r){bt(),he.clear(he.STENCIL_BUFFER_BIT),he.enable(he.STENCIL_TEST),he.stencilFunc(he.NEVER,1,255),he.stencilOp(he.REPLACE,he.REPLACE,he.REPLACE),t(),bt(),he.stencilFunc(r,1,255),he.stencilOp(he.KEEP,he.KEEP,he.KEEP),e(),bt(),he.disable(he.STENCIL_TEST)}function Jt(e,t){zt(e,t,he.EQUAL)}function Xt(e,t){zt(e,t,he.NOTEQUAL)}function Wt(){return(ue.viewport.width+ue.viewport.height)/(ue.width+ue.height)}function Zt(e){bt();let t=ue.width,r=ue.height;ue.width=ue.viewport.width,ue.height=ue.viewport.height,e(),bt(),ue.width=t,ue.height=r}function _t(e,t){t.pos&&(e.pos=e.pos.add(t.pos)),t.scale&&(e.scale=e.scale.scale(u(t.scale))),t.angle&&(e.angle+=t.angle),t.color&&1===e.ch.length&&(e.color=e.color.mult(t.color)),t.opacity&&(e.opacity*=t.opacity)}t(xe,"loadFont"),t(Pe,"loadBitmapFont"),t(Ie,"slice"),t(Ne,"loadSpriteAtlas"),t(Le,"createSpriteSheet"),t(Oe,"loadSprite"),t(Ge,"loadPedit"),t(qe,"loadAseprite"),t(nt,"loadShader"),t(st,"loadShaderURL"),t(ot,"loadSound"),t(at,"loadBean"),t(ht,"getSprite"),t(lt,"getSound"),t(ut,"getFont"),t(dt,"getBitmapFont"),t(ct,"getShader"),t(ft,"getAsset"),t(pt,"resolveSprite"),t(gt,"resolveSound"),t(mt,"resolveShader"),t(wt,"resolveFont"),t(At,"volume"),t(Vt,"play"),t(vt,"burp"),t(yt,"makeCanvas"),t(xt,"makeShader"),t(Et,"makeFont"),t(St,"drawRaw"),t(bt,"flush"),t(Rt,"frameStart"),t(Mt,"usePostEffect"),t(Pt,"frameEnd"),t(Tt,"screen2ndc"),t(Bt,"pushMatrix"),t(Ft,"pushTranslate"),t(It,"pushScale"),t(Dt,"pushRotate"),t(Ct,"pushTransform"),t(kt,"popTransform"),t(Ut,"drawUVQuad"),t(Nt,"drawTexture"),t(Lt,"drawSprite"),t(Ot,"getArcPts"),t(Gt,"drawRect"),t(qt,"drawLine"),t(Ht,"drawLines"),t(Kt,"drawTriangle"),t(Yt,"drawCircle"),t(jt,"drawEllipse"),t(Qt,"drawPolygon"),t(zt,"drawStenciled"),t(Jt,"drawMasked"),t(Xt,"drawSubtracted"),t(Wt,"getViewportScale"),t(Zt,"drawUnscaled"),t(_t,"applyCharTransform");let $t=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g;function er(e){let t={},r=e.replace($t,"$2"),i=0;for(let r of e.matchAll($t)){let e=r.index-i;for(let i=0;i<r.groups.text.length;i++)t[i+e]=[r.groups.style];i+=r[0].length-r.groups.text.length}return{charStyleMap:t,text:r}}t(er,"compileStyledText");let tr={};function rr(e){if(void 0===e.text)throw new Error('formatText() requires property "text".');let t=wt(e.font);if(""===e.text||t instanceof Be||!t)return{width:0,height:0,chars:[],opt:e};let{charStyleMap:r,text:i}=er(e.text+""),n=oe(i);if(t instanceof ye||"string"==typeof t){let e=t instanceof ye?t.fontface.family:t,r=t instanceof ye?{outline:t.outline,filter:t.filter}:{outline:null,filter:Je},i=tr[e]??{font:{tex:new Se(le,2048,2048,{filter:r.filter}),map:{},size:64},cursor:new l(0),outline:r.outline};tr[e]||(tr[e]=i),t=i.font;for(let r of n)if(!i.font.map[r]){let n=z;n.clearRect(0,0,Q.width,Q.height),n.font=`${t.size}px ${e}`,n.textBaseline="top",n.textAlign="left",n.fillStyle="#ffffff";let s=n.measureText(r),o=Math.ceil(s.width),a=t.size;i.outline&&(n.lineJoin="round",n.lineWidth=2*i.outline.width,n.strokeStyle=i.outline.color.toHex(),n.strokeText(r,i.outline.width,i.outline.width),o+=2*i.outline.width,a+=3*i.outline.width),n.fillText(r,i.outline?.width??0,i.outline?.width??0);let h=n.getImageData(0,0,o,a);if(i.cursor.x+o>2048&&(i.cursor.x=0,i.cursor.y+=a,i.cursor.y>2048))throw new Error("Font atlas exceeds character limit");t.tex.update(h,i.cursor.x,i.cursor.y),t.map[r]=new p(i.cursor.x,i.cursor.y,o,a),i.cursor.x+=o}}let s=e.size||t.size,o=u(e.scale??1).scale(s/t.size),a=e.lineSpacing??0,h=e.letterSpacing??0,c=0,f=0,g=0,m=[],w=[],A=0,V=null,v=null;for(;A<n.length;){let r=n[A];if("\n"===r)g+=s+a,m.push({width:c-h,chars:w}),V=null,v=null,c=0,w=[];else{let i=t.map[r];if(i){let y=i.w*o.x;e.width&&c+y>e.width&&(g+=s+a,null!=V&&(A-=w.length-V,r=n[A],i=t.map[r],y=i.w*o.x,w=w.slice(0,V-1),c=v),V=null,v=null,m.push({width:c-h,chars:w}),c=0,w=[]),w.push({tex:t.tex,width:i.w,height:i.h,quad:new p(i.x/t.tex.width,i.y/t.tex.height,i.w/t.tex.width,i.h/t.tex.height),ch:r,pos:new l(c,g),opacity:e.opacity??1,color:e.color??d.WHITE,scale:u(o),angle:0})," "===r&&(V=w.length,v=c),c+=y,f=Math.max(f,c),c+=h}}A++}m.push({width:c-h,chars:w}),g+=s,e.width&&(f=e.width);let y=[];for(let i of m){let n=(f-i.width)*rt(e.align??"left");for(let s of i.chars){let i=t.map[s.ch],a=y.length;if(s.pos=s.pos.add(n,0).add(i.w*o.x*.5,i.h*o.y*.5),e.transform){let t="function"==typeof e.transform?e.transform(a,s.ch):e.transform;t&&_t(s,t)}if(r[a]){let t=r[a];for(let r of t){let t=e.styles[r],i="function"==typeof t?t(a,s.ch):t;i&&_t(s,i)}}y.push(s)}}return{width:f,height:g,chars:y,opt:e}}function ir(e){nr(rr(e))}function nr(e){Ct(),Ft(e.opt.pos),Dt(e.opt.angle),Ft(tt(e.opt.anchor??"topleft").add(1,1).scale(e.width,e.height).scale(-.5)),e.chars.forEach((t=>{Ut({tex:t.tex,width:t.width,height:t.height,pos:t.pos,scale:t.scale,angle:t.angle,color:t.color,opacity:t.opacity,quad:t.quad,anchor:"center",uniform:e.opt.uniform,shader:e.opt.shader,fixed:e.opt.fixed})})),kt()}function sr(){return ue.width}function or(){return ue.height}function ar(e){return new l((e.x-ue.viewport.x)*sr()/ue.viewport.width,(e.y-ue.viewport.y)*or()/ue.viewport.height)}function hr(e){return new l(e.x*ue.viewport.width/ue.width,e.y*ue.viewport.height/ue.height)}function lr(){return ar(se.mousePos())}t(rr,"formatText"),t(ir,"drawText"),t(nr,"drawFormattedText"),t(sr,"width"),t(or,"height"),t(ar,"windowToContent"),t(hr,"contentToView"),t(lr,"mousePos");let ur=!1,dr={inspect:!1,timeScale:1,showLog:!0,fps:()=>se.fps(),numFrames:()=>se.numFrames(),stepFrame:Yi,drawCalls:()=>ue.lastDrawCalls,clearLog:()=>me.logs=[],log:t=>{let r=e.logMax??8;me.logs.unshift({msg:t,time:se.time()}),me.logs.length>r&&(me.logs=me.logs.slice(0,r))},error:e=>dr.log(new Error(e.toString?e.toString():e)),curRecording:null,numObjects:()=>Ui("*",{recursive:!0}).length,get paused(){return ur},set paused(e){ur=e,e?fe.ctx.suspend():fe.ctx.resume()}};function cr(){return se.dt()*dr.timeScale}function fr(...e){return e.length>0&&(me.cam.pos=u(...e)),me.cam.pos?me.cam.pos.clone():bi()}function pr(...e){return e.length>0&&(me.cam.scale=u(...e)),me.cam.scale.clone()}function gr(e){return void 0!==e&&(me.cam.angle=e),me.cam.angle}function mr(e=12){me.cam.shake+=e}function wr(e){return me.cam.transform.multVec2(e)}function Ar(e){return me.cam.transform.invert().multVec2(e)}function Vr(e){let t=new m;return e.pos&&t.translate(e.pos),e.scale&&t.scale(e.scale),e.angle&&t.rotate(e.angle),e.parent?t.mult(e.parent.transform):t}function vr(e=[]){let r=new Map,i={},n=new j,s=[],o=null,a=!1,h={id:re(),hidden:!1,transform:new m,children:[],parent:null,set paused(e){if(e!==a){a=e;for(let t of s)t.paused=e}},get paused(){return a},add(e=[]){let t=Array.isArray(e)?vr(e):e;if(t.parent)throw new Error("Cannot add a game obj that already has a parent.");return t.parent=this,t.transform=Vr(t),this.children.push(t),t.trigger("add",t),me.events.trigger("add",t),t},readd(e){let t=this.children.indexOf(e);return-1!==t&&(this.children.splice(t,1),this.children.push(e)),e},remove(e){let r=this.children.indexOf(e);if(-1!==r){e.parent=null,this.children.splice(r,1);let i=t((e=>{e.trigger("destroy"),me.events.trigger("destroy",e),e.children.forEach((e=>i(e)))}),"trigger");i(e)}},removeAll(e){if(e)this.get(e).forEach((e=>this.remove(e)));else for(let e of[...this.children])this.remove(e)},update(){this.paused||(this.children.sort(((e,t)=>(e.z??0)-(t.z??0))).forEach((e=>e.update())),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&this.canvas.bind();let e=ue.fixed;this.fixed&&(ue.fixed=!0),Ct(),Ft(this.pos),It(this.scale),Dt(this.angle);let t=this.children.sort(((e,t)=>(e.z??0)-(t.z??0)));if(this.mask){let e={intersect:Jt,subtract:Xt}[this.mask];if(!e)throw new Error(`Invalid mask func: "${this.mask}"`);e((()=>{t.forEach((e=>e.draw()))}),(()=>{this.trigger("draw")}))}else this.trigger("draw"),t.forEach((e=>e.draw()));kt(),ue.fixed=e,this.canvas&&this.canvas.unbind()},drawInspect(){this.hidden||(Ct(),Ft(this.pos),It(this.scale),Dt(this.angle),this.children.sort(((e,t)=>(e.z??0)-(t.z??0))).forEach((e=>e.drawInspect())),this.trigger("drawInspect"),kt())},use(e){if(!e)return;if("string"==typeof e)return this.use({id:e});let n=[];e.id&&(this.unuse(e.id),i[e.id]=[],n=i[e.id],r.set(e.id,e));for(let r in e){if($e.has(r))continue;let i=Object.getOwnPropertyDescriptor(e,r);if("function"==typeof i.value&&(e[r]=e[r].bind(this)),i.set&&Object.defineProperty(e,r,{set:i.set.bind(this)}),i.get&&Object.defineProperty(e,r,{get:i.get.bind(this)}),et.has(r)){let i="add"===r?()=>{o=t((e=>n.push(e)),"onCurCompCleanup"),e[r](),o=null}:e[r];n.push(this.on(r,i).cancel)}else{if(void 0!==this[r])throw new Error(`Duplicate component property: "${r}"`);Object.defineProperty(this,r,{get:()=>e[r],set:t=>e[r]=t,configurable:!0,enumerable:!0}),n.push((()=>delete this[r]))}}let s=t((()=>{if(e.require)for(let t of e.require)if(!this.c(t))throw new Error(`Component "${e.id}" requires component "${t}"`)}),"checkDeps");e.destroy&&n.push(e.destroy.bind(this)),this.exists()?(s(),e.add&&(o=t((e=>n.push(e)),"onCurCompCleanup"),e.add.call(this),o=null)):e.require&&n.push(this.on("add",s).cancel)},unuse(e){i[e]&&(i[e].forEach((e=>e())),delete i[e]),r.has(e)&&r.delete(e)},c:e=>r.get(e),get(e,r={}){let i=r.recursive?this.children.flatMap(t((function e(t){return[t,...t.children.flatMap(e)]}),"recurse")):this.children;if(i=i.filter((t=>!e||t.is(e))),r.liveUpdate){let n=t((e=>r.recursive?this.isAncestorOf(e):e.parent===this),"isChild"),s=[];s.push(Sr((t=>{n(t)&&t.is(e)&&i.push(t)}))),s.push(br((t=>{if(n(t)&&t.is(e)){let e=i.findIndex((e=>e.id===t.id));-1!==e&&i.splice(e,1)}}))),this.onDestroy((()=>{for(let e of s)e.cancel()}))}return i},isAncestorOf(e){return!!e.parent&&(e.parent===this||this.isAncestorOf(e.parent))},exists(){return me.root.isAncestorOf(this)},is(e){if("*"===e)return!0;if(Array.isArray(e)){for(let t of e)if(!this.c(t))return!1;return!0}return null!=this.c(e)},on(e,t){let r=n.on(e,t.bind(this));return o&&o((()=>r.cancel())),r},trigger(e,...t){n.trigger(e,...t),me.objEvents.trigger(e,this,...t)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let e={};for(let[t,i]of r)e[t]=i.inspect?i.inspect():null;return e},onAdd(e){return this.on("add",e)},onUpdate(e){return this.on("update",e)},onDraw(e){return this.on("draw",e)},onDestroy(e){return this.on("destroy",e)},clearEvents(){n.clear()}},l=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick"];for(let e of l)h[e]=(...t)=>{let r=se[e](...t);return s.push(r),h.onDestroy((()=>r.cancel())),r};for(let t of e)h.use(t);return h}function yr(e,t,r){return me.objEvents[e]||(me.objEvents[e]=new H),me.objEvents.on(e,((e,...i)=>{e.is(t)&&r(e,...i)}))}t(cr,"dt"),t(fr,"camPos"),t(pr,"camScale"),t(gr,"camRot"),t(mr,"shake"),t(wr,"toScreen"),t(Ar,"toWorld"),t(Vr,"calcTransform"),t(vr,"make"),t(yr,"on");let xr=te((e=>{let t=Di([{update:e}]);return{get paused(){return t.paused},set paused(e){t.paused=e},cancel:()=>t.destroy()}}),((e,t)=>yr("update",e,t))),Er=te((e=>{let t=Di([{draw:e}]);return{get paused(){return t.hidden},set paused(e){t.hidden=e},cancel:()=>t.destroy()}}),((e,t)=>yr("draw",e,t))),Sr=te((e=>me.events.on("add",e)),((e,t)=>yr("add",e,t))),br=te((e=>me.events.on("destroy",e)),((e,t)=>yr("destroy",e,t)));function Rr(e,t,r){return yr("collide",e,((e,i,n)=>i.is(t)&&r(e,i,n)))}function Mr(e,t,r){return yr("collideUpdate",e,((e,i,n)=>i.is(t)&&r(e,i,n)))}function Pr(e,t,r){return yr("collideEnd",e,((e,i,n)=>i.is(t)&&r(e,i,n)))}function Tr(e,t){Ui(e,{recursive:!0}).forEach(t),Sr(e,t)}t(Rr,"onCollide"),t(Mr,"onCollideUpdate"),t(Pr,"onCollideEnd"),t(Tr,"forAllCurrentAndFuture");let Br,Fr=te((e=>se.onMousePress(e)),((e,t)=>{let r=[];return Tr(e,(e=>{if(!e.area)throw new Error("onClick() requires the object to have area() component");r.push(e.onClick((()=>t(e))))})),K.join(r)}));function Ir(e,t){let r=[];return Tr(e,(e=>{if(!e.area)throw new Error("onHover() requires the object to have area() component");r.push(e.onHover((()=>t(e))))})),K.join(r)}function Dr(e,t){let r=[];return Tr(e,(e=>{if(!e.area)throw new Error("onHoverUpdate() requires the object to have area() component");r.push(e.onHoverUpdate((()=>t(e))))})),K.join(r)}function Cr(e,t){let r=[];return Tr(e,(e=>{if(!e.area)throw new Error("onHoverEnd() requires the object to have area() component");r.push(e.onHoverEnd((()=>t(e))))})),K.join(r)}function kr(e){me.gravity=e}function Ur(){return me.gravity}function Nr(...e){1===e.length||2===e.length?(ue.bgColor=c(e[0]),e[1]&&(ue.bgAlpha=e[1])):(3===e.length||4===e.length)&&(ue.bgColor=c(e[0],e[1],e[2]),e[3]&&(ue.bgAlpha=e[3])),he.clearColor(ue.bgColor.r/255,ue.bgColor.g/255,ue.bgColor.b/255,ue.bgAlpha)}function Lr(){return ue.bgColor.clone()}function Or(...e){return{id:"pos",pos:u(...e),moveBy(...e){this.pos=this.pos.add(u(...e))},move(...e){this.moveBy(u(...e).scale(cr()))},moveTo(...e){if("number"==typeof e[0]&&"number"==typeof e[1])return this.moveTo(u(e[0],e[1]),e[2]);let t=e[0],r=e[1];if(void 0===r)return void(this.pos=u(t));let i=t.sub(this.pos);i.len()<=r*cr()?this.pos=u(t):this.move(i.unit().scale(r))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){let e=this.worldPos();return Wr(this)?e:wr(e)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){Yt({color:c(255,0,0),radius:4/Wt()})}}}function Gr(...e){return 0===e.length?Gr(1):{id:"scale",scale:u(...e),scaleTo(...e){this.scale=u(...e)},scaleBy(...e){this.scale.scale(u(...e))},inspect(){return`(${Kr(this.scale.x,2)}, ${Kr(this.scale.y,2)})`}}}function qr(e){return{id:"rotate",angle:e??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`${Math.round(this.angle)}`}}}function Hr(...e){return{id:"color",color:c(...e),inspect(){return this.color.toString()}}}function Kr(e,t){return Number(e.toFixed(t))}function Yr(e){return{id:"opacity",opacity:e??1,inspect(){return`${Kr(this.opacity,1)}`},fadeOut(e=1,t=He.linear){return Oi(this.opacity,0,e,(e=>this.opacity=e),t)}}}function jr(e){if(!e)throw new Error("Please define an anchor");return{id:"anchor",anchor:e,inspect(){return"string"==typeof this.anchor?this.anchor:this.anchor.toString()}}}function Qr(e){return{id:"z",z:e,inspect(){return`${this.z}`}}}function zr(e,t){return{id:"follow",require:["pos"],follow:{obj:e,offset:t??u(0)},add(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function Jr(e,t){let r="number"==typeof e?l.fromAngle(e):e.unit();return{id:"move",require:["pos"],update(){this.move(r.scale(t))}}}function Xr(e={}){let t=e.distance??200,r=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let e=this.screenPos(),r=new N(u(0),sr(),or());return!B(r,e)&&r.sdistToPoint(e)>t*t},onExitScreen(e){return this.on("exitView",e)},onEnterScreen(e){return this.on("enterView",e)},update(){this.isOffScreen()?(r||(this.trigger("exitView"),r=!0),e.hide&&(this.hidden=!0),e.pause&&(this.paused=!0),e.destroy&&this.destroy()):(r&&(this.trigger("enterView"),r=!1),e.hide&&(this.hidden=!1),e.pause&&(this.paused=!1))}}}function Wr(e){return!!e.fixed||!!e.parent&&Wr(e.parent)}function Zr(e={}){let t={},r=new Set;return{id:"area",collisionIgnore:e.collisionIgnore??[],add(){this.area.cursor&&this.onHover((()=>se.setCursor(this.area.cursor))),this.onCollideUpdate(((e,i)=>{t[e.id]||this.trigger("collide",e,i),t[e.id]=i,r.add(e.id)}))},update(){for(let e in t)r.has(Number(e))||(this.trigger("collideEnd",t[e].target),delete t[e]);r.clear()},drawInspect(){let e=this.localArea();Ct(),It(this.area.scale),Ft(this.area.offset);let t={outline:{width:4/Wt(),color:c(0,0,255)},anchor:this.anchor,fill:!1,fixed:Wr(this)};e instanceof N?Gt({...t,pos:e.pos,width:e.width,height:e.height}):e instanceof G?Qt({...t,pts:e.pts}):e instanceof L&&Yt({...t,pos:e.center,radius:e.radius}),kt()},area:{shape:e.shape??null,scale:e.scale?u(e.scale):u(1),offset:e.offset??u(0),cursor:e.cursor??null},isClicked(){return se.isMousePressed()&&this.isHovering()},isHovering(){let e=Wr(this)?lr():Ar(lr());return this.hasPoint(e)},checkCollision:e=>t[e.id]??null,getCollisions:()=>Object.values(t),isColliding:e=>!!t[e.id],isOverlapping(e){let r=t[e.id];return r&&r.hasOverlap()},onClick(e){let t=se.onMousePress("left",(()=>{this.isHovering()&&e()}));return this.onDestroy((()=>t.cancel())),t},onHover(e){let t=!1;return this.onUpdate((()=>{t?t=this.isHovering():this.isHovering()&&(t=!0,e())}))},onHoverUpdate(e){return this.onUpdate((()=>{this.isHovering()&&e()}))},onHoverEnd(e){let t=!1;return this.onUpdate((()=>{t?this.isHovering()||(t=!1,e()):t=this.isHovering()}))},onCollide(e,t){return"function"==typeof e&&void 0===t?this.on("collide",e):"string"==typeof e?this.onCollide(((r,i)=>{r.is(e)&&t(r,i)})):void 0},onCollideUpdate(e,t){return"function"==typeof e&&void 0===t?this.on("collideUpdate",e):"string"==typeof e?this.on("collideUpdate",((r,i)=>r.is(e)&&t(r,i))):void 0},onCollideEnd(e,t){return"function"==typeof e&&void 0===t?this.on("collideEnd",e):"string"==typeof e?this.on("collideEnd",(r=>r.is(e)&&t(r))):void 0},hasPoint(e){return k(this.worldArea(),e)},resolveCollision(e){let t=this.checkCollision(e);t&&!t.resolved&&(this.pos=this.pos.add(t.displacement),t.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let e=this.localArea();if(!(e instanceof G||e instanceof N))throw new Error("Only support polygon and rect shapes for now");let t=this.transform.clone().scale(u(this.area.scale??1)).translate(this.area.offset);if(e instanceof N){let r=tt(this.anchor||Qe).add(1,1).scale(-.5).scale(e.width,e.height);t.translate(r)}return e.transform(t)},screenArea(){let e=this.worldArea();return Wr(this)?e:e.transform(me.cam.transform)}}}function _r(e){return{color:e.color,opacity:e.opacity,anchor:e.anchor,outline:e.outline,shader:e.shader,uniform:e.uniform}}function $r(e,r={}){let i=null,n=null,s=null,o=new Y;if(!e)throw new Error("Please pass the resource name or data to sprite()");let a=t(((e,t,r,i)=>{let n=u(1,1);return r&&i?(n.x=r/(e.width*t.w),n.y=i/(e.height*t.h)):r?(n.x=r/(e.width*t.w),n.y=n.x):i&&(n.y=i/(e.height*t.h),n.x=n.y),n}),"calcTexScale");return{id:"sprite",width:0,height:0,frame:r.frame||0,quad:r.quad||new p(0,0,1,1),animSpeed:r.animSpeed??1,flipX:r.flipX??!1,flipY:r.flipY??!1,draw(){if(!i)return;let e=i.frames[this.frame??0];if(!e)throw new Error(`Frame not found: ${this.frame??0}`);if(i.slice9){let{left:t,right:n,top:s,bottom:o}=i.slice9,a=i.tex.width*e.w,h=i.tex.height*e.h,l=this.width-t-n,u=this.height-s-o,d=t/a,c=n/a,f=1-d-c,p=s/h,m=o/h,w=1-p-m,A=[g(0,0,d,p),g(d,0,f,p),g(d+f,0,c,p),g(0,p,d,w),g(d,p,f,w),g(d+f,p,c,w),g(0,p+w,d,m),g(d,p+w,f,m),g(d+f,p+w,c,m),g(0,0,t,s),g(t,0,l,s),g(t+l,0,n,s),g(0,s,t,u),g(t,s,l,u),g(t+l,s,n,u),g(0,s+u,t,o),g(t,s+u,l,o),g(t+l,s+u,n,o)];for(let t=0;t<9;t++){let n=A[t],s=A[t+9];Nt(Object.assign(_r(this),{pos:s.pos(),tex:i.tex,quad:e.scale(n),flipX:this.flipX,flipY:this.flipY,tiled:r.tiled,width:s.w,height:s.h}))}}else Nt(Object.assign(_r(this),{tex:i.tex,quad:e.scale(this.quad??new p(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:r.tiled,width:this.width,height:this.height}))},add(){let n=t((e=>{let t=e.frames[0].clone();r.quad&&(t=t.scale(r.quad));let n=a(e.tex,t,r.width,r.height);this.width=e.tex.width*t.w*n.x,this.height=e.tex.height*t.h*n.y,r.anim&&this.play(r.anim),i=e,o.trigger(i)}),"setSpriteData"),s=pt(e);s?s.onLoad(n):Ai((()=>n(pt(e).data)))},update(){if(!n)return;let e=i.anims[n.name];if("number"!=typeof e){if(0===e.speed)throw new Error("Sprite anim speed cannot be 0");n.timer+=cr()*this.animSpeed,n.timer>=1/n.speed&&(n.timer=0,this.frame+=s,(this.frame<Math.min(e.from,e.to)||this.frame>Math.max(e.from,e.to))&&(n.loop?n.pingpong?(this.frame-=s,s*=-1,this.frame+=s):this.frame=e.from:(this.frame=e.to,n.onEnd(),this.stop())))}else this.frame=e},play(e,t={}){if(!i)return void o.add((()=>this.play(e,t)));let r=i.anims[e];if(void 0===r)throw new Error(`Anim not found: ${e}`);n&&this.stop(),n="number"==typeof r?{name:e,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:e,timer:0,loop:t.loop??r.loop??!1,pingpong:t.pingpong??r.pingpong??!1,speed:t.speed??r.speed??10,onEnd:t.onEnd??(()=>{})},s="number"==typeof r?null:r.from<r.to?1:-1,this.frame="number"==typeof r?r:r.from,this.trigger("animStart",e)},stop(){if(!n)return;let e=n.name;n=null,this.trigger("animEnd",e)},numFrames:()=>i?.frames.length??0,curAnim:()=>n?.name,onAnimEnd(e){return this.on("animEnd",e)},onAnimStart(e){return this.on("animStart",e)},renderArea(){return new N(u(0),this.width,this.height)},inspect(){if("string"==typeof e)return`"${e}"`}}}function ei(e,r={}){function i(e){let t=rr(Object.assign(_r(e),{text:e.text+"",size:e.textSize,font:e.font,width:r.width&&e.width,align:e.align,letterSpacing:e.letterSpacing,lineSpacing:e.lineSpacing,transform:e.textTransform,styles:e.textStyles}));return r.width||(e.width=t.width/(e.scale?.x||1)),e.height=t.height/(e.scale?.y||1),t}t(i,"update");let n={id:"text",set text(t){e=t,i(this)},get text(){return e},textSize:r.size??36,font:r.font,width:r.width??0,height:0,align:r.align,lineSpacing:r.lineSpacing,letterSpacing:r.letterSpacing,textTransform:r.transform,textStyles:r.styles,add(){Ai((()=>i(this)))},draw(){nr(i(this))},renderArea(){return new N(u(0),this.width,this.height)}};return i(n),n}function ti(e,t={}){if(e.length<3)throw new Error(`Polygon's need more than two points, ${e.length} points provided`);return{id:"polygon",pts:e,colors:t.colors,radius:t.radius,draw(){Qt(Object.assign(_r(this),{pts:this.pts,colors:this.colors,radius:this.radius,fill:t.fill}))},renderArea(){return new G(this.pts)},inspect(){return this.pts.map((e=>`[${e.x},${e.y}]`)).join(",")}}}function ri(e,t,r={}){return{id:"rect",width:e,height:t,radius:r.radius||0,draw(){Gt(Object.assign(_r(this),{width:this.width,height:this.height,radius:this.radius,fill:r.fill}))},renderArea(){return new N(u(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function ii(e,t){return{id:"rect",width:e,height:t,draw(){Ut(Object.assign(_r(this),{width:this.width,height:this.height}))},renderArea(){return new N(u(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function ni(e,t={}){return{id:"circle",radius:e,draw(){Yt(Object.assign(_r(this),{radius:this.radius,fill:t.fill}))},renderArea(){return new N(new l(this.anchor?0:-this.radius),2*this.radius,2*this.radius)},inspect(){return`${Math.ceil(this.radius)}`}}}function si(e=1,t=c(0,0,0)){return{id:"outline",outline:{width:e,color:t}}}function oi(){return{id:"timer",wait(e,t){let r=[];t&&r.push(t);let i=0,n=this.onUpdate((()=>{i+=cr(),i>=e&&(r.forEach((e=>e())),n.cancel())}));return{get paused(){return n.paused},set paused(e){n.paused=e},cancel:n.cancel,onEnd(e){r.push(e)},then(e){return this.onEnd(e),this}}},loop(e,r){let i=null,n=t((()=>{i=this.wait(e,n),r()}),"newAction");return i=this.wait(0,n),{get paused(){return i.paused},set paused(e){i.paused=e},cancel:()=>i.cancel()}},tween(e,t,r,i,n=He.linear){let s=0,a=[],h=this.onUpdate((()=>{s+=cr();let l=Math.min(s/r,1);i(o(e,t,n(l))),1===l&&(h.cancel(),i(t),a.forEach((e=>e())))}));return{get paused(){return h.paused},set paused(e){h.paused=e},onEnd(e){a.push(e)},then(e){return this.onEnd(e),this},cancel(){h.cancel()},finish(){h.cancel(),i(t),a.forEach((e=>e()))}}}}}function ai(e={}){let t=null,r=null,i=!1;return{id:"body",require:["pos","area"],vel:new l(0),jumpForce:e.jumpForce??640,gravityScale:e.gravityScale??1,isStatic:e.isStatic??!1,mass:e.mass??1,add(){if(0===this.mass)throw new Error("Can't set body mass to 0");this.onCollideUpdate(((e,t)=>{if(e.is("body")&&!t.resolved&&(this.trigger("beforePhysicsResolve",t),e.trigger("beforePhysicsResolve",t.reverse()),!(t.resolved||this.isStatic&&e.isStatic))){if(this.isStatic||e.isStatic){let r=!this.isStatic&&e.isStatic?t:t.reverse();r.source.pos=r.source.pos.add(r.displacement),r.source.transform=Vr(r.source)}else{let r=this.mass+e.mass;this.pos=this.pos.add(t.displacement.scale(e.mass/r)),e.pos=e.pos.add(t.displacement.scale(-this.mass/r)),this.transform=Vr(this),e.transform=Vr(e)}t.resolved=!0,this.trigger("physicsResolve",t),e.trigger("physicsResolve",t.reverse())}})),this.onPhysicsResolve((e=>{me.gravity&&(e.isBottom()&&this.isFalling()?(this.vel.y=0,t=e.target,r=e.target.pos,i?i=!1:this.trigger("ground",t)):e.isTop()&&this.isJumping()&&(this.vel.y=0,this.trigger("headbutt",e.target)))}))},update(){if(!me.gravity||this.isStatic)return;if(i&&(t=null,r=null,this.trigger("fallOff"),i=!1),t){if(this.isColliding(t)&&t.exists()&&t.is("body"))return!t.pos.eq(r)&&!1!==e.stickToPlatform&&this.moveBy(t.pos.sub(r)),void(r=t.pos);i=!0}let n=this.vel.y;this.vel.y+=me.gravity*this.gravityScale*cr(),this.vel.y=Math.min(this.vel.y,e.maxVelocity??65536),n<0&&this.vel.y>=0&&this.trigger("fall"),this.move(this.vel)},onPhysicsResolve(e){return this.on("physicsResolve",e)},onBeforePhysicsResolve(e){return this.on("beforePhysicsResolve",e)},curPlatform:()=>t,isGrounded:()=>null!==t,isFalling(){return this.vel.y>0},isJumping(){return this.vel.y<0},jump(e){t=null,r=null,this.vel.y=-e||-this.jumpForce},onGround(e){return this.on("ground",e)},onFall(e){return this.on("fall",e)},onFallOff(e){return this.on("fallOff",e)},onHeadbutt(e){return this.on("headbutt",e)}}}function hi(e=2){let t=e;return{id:"doubleJump",require:["body"],numJumps:e,add(){this.onGround((()=>{t=this.numJumps}))},doubleJump(e){t<=0||(t<this.numJumps&&this.trigger("doubleJump"),t--,this.jump(e))},onDoubleJump(e){return this.on("doubleJump",e)},inspect:()=>`${t}`}}function li(e,t){return{id:"shader",shader:e,..."function"==typeof t?{uniform:t(),update(){this.uniform=t()}}:{uniform:t}}}function ui(){return{id:"fixed",fixed:!0}}function di(e){return{id:"stay",stay:!0,scenesToStay:e}}function ci(e,t){if(null==e)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(t=1){this.setHP(e-t),this.trigger("hurt",t)},heal(t=1){let r=e;this.setHP(e+t),this.trigger("heal",e-r)},hp:()=>e,maxHP:()=>t??null,setMaxHP(e){t=e},setHP(r){(e=t?Math.min(t,r):r)<=0&&this.trigger("death")},onHurt(e){return this.on("hurt",e)},onHeal(e){return this.on("heal",e)},onDeath(e){return this.on("death",e)},inspect:()=>`${e}`}}function fi(e,t={}){if(null==e)throw new Error("lifespan() requires time");let r=t.fade??0;return{id:"lifespan",async add(){await Ni(e),r>0&&this.opacity&&await Oi(this.opacity,0,r,(e=>this.opacity=e),He.linear),this.destroy()}}}function pi(e,r,i){if(!e)throw new Error("state() requires an initial state");let n={};function s(e){n[e]||(n[e]={enter:new Y,end:new Y,update:new Y,draw:new Y})}function o(e,t,r){return s(t),n[t][e].add(r)}function a(e,t,...r){s(t),n[t][e].trigger(...r)}t(s,"initStateEvents"),t(o,"on"),t(a,"trigger");let h=!1;return{id:"state",state:e,enterState(e,...t){if(h=!0,r&&!r.includes(e))throw new Error(`State not found: ${e}`);let n=this.state;if(i){if(!i?.[n])return;let t="string"==typeof i[n]?[i[n]]:i[n];if(!t.includes(e))throw new Error(`Cannot transition state from "${n}" to "${e}". Available transitions: ${t.map((e=>`"${e}"`)).join(", ")}`)}a("end",n,...t),this.state=e,a("enter",e,...t),a("enter",`${n} -> ${e}`,...t)},onStateTransition:(e,t,r)=>o("enter",`${e} -> ${t}`,r),onStateEnter:(e,t)=>o("enter",e,t),onStateUpdate:(e,t)=>o("update",e,t),onStateDraw:(e,t)=>o("draw",e,t),onStateEnd:(e,t)=>o("end",e,t),update(){h||(a("enter",e),h=!0),a("update",this.state)},draw(){a("draw",this.state)},inspect(){return this.state}}}function gi(e=1){let t=0,r=!1;return{require:["opacity"],add(){this.opacity=0},update(){r||(t+=cr(),this.opacity=a(t,0,e,0,1),t>=e&&(this.opacity=1,r=!0))}}}function mi(e="intersect"){return{id:"mask",mask:e}}function wi(e){return{add(){this.canvas=e}}}function Ai(e){pe.loaded?e():me.events.on("load",e)}function Vi(e,t){me.scenes[e]=t}function vi(e,...t){if(!me.scenes[e])throw new Error(`Scene not found: ${e}`);me.events.onOnce("frameEnd",(()=>{me.events.trigger("sceneLeave",e),se.events.clear(),me.events.clear(),me.objEvents.clear(),[...me.root.children].forEach((t=>{(!t.stay||t.scenesToStay&&!t.scenesToStay.includes(e))&&me.root.remove(t)})),me.root.clearEvents(),on(),me.cam={pos:null,scale:u(1),angle:0,shake:0,transform:new m},me.scenes[e](...t)}))}function yi(e){return me.events.on("sceneLeave",e)}function xi(e,t){try{return JSON.parse(window.localStorage[e])}catch{return t?(Ei(e,t),t):null}}function Ei(e,t){window.localStorage[e]=JSON.stringify(t)}function Si(t,...r){let i,n=t(an);i="function"==typeof n?n(...r)(an):n;for(let t in i)an[t]=i[t],!1!==e.global&&(window[t]=i[t]);return an}function bi(){return u(sr()/2,or()/2)}var Ri;function Mi(e={}){let r=u(0),i=e.isObstacle??!1,n=e.cost??0,s=e.edges??[],o=t((()=>{let e={left:1,top:2,right:4,bottom:8};return s.map((t=>e[t]||0)).reduce(((e,t)=>e|t),0)}),"getEdgeMask"),a=o();return{id:"tile",tilePosOffset:e.offset??u(0),set tilePos(e){let t=this.getLevel();r=e.clone(),this.pos=u(this.tilePos.x*t.tileWidth(),this.tilePos.y*t.tileHeight()).add(this.tilePosOffset)},get tilePos(){return r},set isObstacle(e){i!==e&&(i=e,this.getLevel().invalidateNavigationMap())},get isObstacle(){return i},set cost(e){n!==e&&(n=e,this.getLevel().invalidateNavigationMap())},get cost(){return n},set edges(e){s=e,a=o(),this.getLevel().invalidateNavigationMap()},get edges(){return s},get edgeMask(){return a},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(u(-1,0))},moveRight(){this.tilePos=this.tilePos.add(u(1,0))},moveUp(){this.tilePos=this.tilePos.add(u(0,-1))},moveDown(){this.tilePos=this.tilePos.add(u(0,1))}}}function Pi(e,r){if(!r.tileWidth||!r.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let i=Di([Or(r.pos??u(0))]),n=e.length,s=0,o=null,a=null,h=null,l=null,d=t((e=>e.x+e.y*s),"tile2Hash"),c=t((e=>u(Math.floor(e%s),Math.floor(e/s))),"hash2Tile"),f=t((()=>{o=[];for(let e of i.children)p(e)}),"createSpatialMap"),p=t((e=>{let t=d(e.tilePos);o[t]?o[t].push(e):o[t]=[e]}),"insertIntoSpatialMap"),g=t((e=>{let t=d(e.tilePos);if(o[t]){let r=o[t].indexOf(e);r>=0&&o[t].splice(r,1)}}),"removeFromSpatialMap"),m=t((()=>{let e=!1;for(let t of i.children){let r=i.pos2Tile(t.pos);(t.tilePos.x!=r.x||t.tilePos.y!=r.y)&&(e=!0,g(t),t.tilePos.x=r.x,t.tilePos.y=r.y,p(t))}e&&i.trigger("spatial_map_changed")}),"updateSpatialMap"),w=t((()=>{let e=i.getSpatialMap(),t=i.numRows()*i.numColumns();a?a.length=t:a=new Array(t),a.fill(1,0,t);for(let t=0;t<e.length;t++){let r=e[t];if(r){let e=0;for(let t of r){if(t.isObstacle){e=1/0;break}e+=t.cost}a[t]=e||1}}}),"createCostMap"),A=t((()=>{let e=i.getSpatialMap(),t=i.numRows()*i.numColumns();h?h.length=t:h=new Array(t),h.fill(15,0,t);for(let t=0;t<e.length;t++){let r=e[t];if(r){let e=r.length,i=15;for(let t=0;t<e;t++)i|=r[t].edgeMask;h[t]=i}}}),"createEdgeMap"),V=t((()=>{let e=i.numRows()*i.numColumns(),r=t(((e,t)=>{let r=[];for(r.push(e);r.length>0;){let e=r.pop();x(e).forEach((e=>{l[e]<0&&(l[e]=t,r.push(e))}))}}),"traverse");l?l.length=e:l=new Array(e),l.fill(-1,0,e);let n=0;for(let e=0;e<a.length;e++)l[e]>=0||r(e,n),n++}),"createConnectivityMap"),v=t(((e,t)=>a[t]),"getCost"),y=t(((e,t)=>{let r=c(e),i=c(t);return r.dist(i)}),"getHeuristic"),x=t(((e,t)=>{let r=[],i=Math.floor(e%s),o=i>0&&1&h[e]&&a[e-1]!==1/0,l=e>=s&&2&h[e]&&a[e-s]!==1/0,u=i<s-1&&4&h[e]&&a[e+1]!==1/0,d=e<s*n-s-1&&8&h[e]&&a[e+s]!==1/0;return t?(o&&(l&&r.push(e-s-1),r.push(e-1),d&&r.push(e+s-1)),l&&r.push(e-s),u&&(l&&r.push(e-s+1),r.push(e+1),d&&r.push(e+s+1)),d&&r.push(e+s)):(o&&r.push(e-1),l&&r.push(e-s),u&&r.push(e+1),d&&r.push(e+s)),r}),"getNeighbours"),E={id:"level",tileWidth:()=>r.tileWidth,tileHeight:()=>r.tileHeight,spawn(e,...t){let n=u(...t),s=(()=>{if("string"!=typeof e){if(Array.isArray(e))return e;throw new Error("Expected a symbol or a component list")}if(r.tiles[e]){if("function"!=typeof r.tiles[e])throw new Error("Level symbol def must be a function returning a component list");return r.tiles[e](n)}if(r.wildcardTile)return r.wildcardTile(e,n)})();if(!s)return null;let a=!1,h=!1;for(let e of s)"tile"===e.id&&(h=!0),"pos"===e.id&&(a=!0);a||s.push(Or()),h||s.push(Mi());let l=i.add(s);return a&&(l.tilePosOffset=l.pos.clone()),l.tilePos=n,o&&(p(l),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),l},numColumns:()=>s,numRows:()=>n,levelWidth(){return s*this.tileWidth()},levelHeight(){return n*this.tileHeight()},tile2Pos(...e){return u(...e).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...e){let t=u(...e);return u(Math.floor(t.x/this.tileWidth()),Math.floor(t.y/this.tileHeight()))},getSpatialMap:()=>(o||f(),o),onSpatialMapChanged(e){return this.on("spatial_map_changed",e)},onNavigationMapInvalid(e){return this.on("navigation_map_invalid",e)},getAt(e){o||f();let t=d(e);return o[t]||[]},update(){o&&m()},invalidateNavigationMap(){a=null,h=null,l=null},onNavigationMapChanged(e){return this.on("navigation_map_changed",e)},getTilePath(e,t,r={}){if(a||w(),h||A(),l||V(),e.x<0||e.x>=s||e.y<0||e.y>=n||t.x<0||t.x>=s||t.y<0||t.y>=n)return null;let i=d(e),o=d(t);if(a[o]===1/0)return null;if(i===o)return[];if(-1!=l[i]&&l[i]!==l[o])return null;let u=new ne(((e,t)=>e.cost<t.cost));u.insert({cost:0,node:i});let f=new Map;f.set(i,i);let p=new Map;for(p.set(i,0);0!==u.length;){let e=u.remove()?.node;if(e===o)break;let t=x(e,r.allowDiagonals);for(let r of t){let t=(p.get(e)||0)+v(e,r)+y(r,o);(!p.has(r)||t<p.get(r))&&(p.set(r,t),u.insert({cost:t,node:r}),f.set(r,e))}}let g=[],m=o,E=c(m);for(g.push(E);m!==i;){m=f.get(m);let e=c(m);g.push(e)}return g.reverse()},getPath(e,t,r={}){let i=this.tileWidth(),n=this.tileHeight(),s=this.getTilePath(this.pos2Tile(e),this.pos2Tile(t),r);return s?[e,...s.slice(1,-1).map((e=>e.scale(i,n).add(i/2,n/2))),t]:null}};return i.use(E),i.onNavigationMapInvalid((()=>{i.invalidateNavigationMap(),i.trigger("navigation_map_changed")})),e.forEach(((e,t)=>{let r=e.split("");s=Math.max(r.length,s),r.forEach(((e,r)=>{i.spawn(e,u(r,t))}))})),i}function Ti(e={}){let t=null,r=null,i=null,n=null;return{id:"agent",require:["pos","tile"],agentSpeed:e.speed??100,allowDiagonals:e.allowDiagonals??!0,getDistanceToTarget(){return t?this.pos.dist(t):0},getNextLocation:()=>r&&i?r[i]:null,getPath:()=>r?r.slice():null,getTarget:()=>t,isNavigationFinished:()=>!r||null===i,isTargetReachable:()=>null!==r,isTargetReached(){return!t||this.pos.eq(t)},setTarget(e){t=e,r=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),i=r?0:null,r?(n||(n=this.getLevel().onNavigationMapChanged((()=>{r&&null!==i&&(r=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),i=r?0:null,r?this.trigger("navigation-next",this,r[i]):this.trigger("navigation-ended",this))})),this.onDestroy((()=>n.cancel()))),this.trigger("navigation-started",this),this.trigger("navigation-next",this,r[i])):this.trigger("navigation-ended",this)},update(){if(r&&null!==i){if(this.pos.sdist(r[i])<2){if(i===r.length-1)return this.pos=t.clone(),i=null,this.trigger("navigation-ended",this),void this.trigger("target-reached",this);i++,this.trigger("navigation-next",this,r[i])}this.moveTo(r[i],this.agentSpeed)}},onNavigationStarted(e){return this.on("navigation-started",e)},onNavigationNext(e){return this.on("navigation-next",e)},onNavigationEnded(e){return this.on("navigation-ended",e)},onTargetReached(e){return this.on("target-reached",e)},inspect:()=>JSON.stringify({target:JSON.stringify(t),path:JSON.stringify(r)})}}function Bi(e){let t=se.canvas.captureStream(e),r=fe.ctx.createMediaStreamDestination();fe.masterNode.connect(r);let i=new MediaRecorder(t),n=[];return i.ondataavailable=e=>{e.data.size>0&&n.push(e.data)},i.onerror=()=>{fe.masterNode.disconnect(r),t.getTracks().forEach((e=>e.stop()))},i.start(),{resume(){i.resume()},pause(){i.pause()},stop:()=>(i.stop(),fe.masterNode.disconnect(r),t.getTracks().forEach((e=>e.stop())),new Promise((e=>{i.onstop=()=>{e(new Blob(n,{type:"video/mp4"}))}}))),download(e="kaboom.mp4"){this.stop().then((t=>_(e,t)))}}}function Fi(){return document.activeElement===se.canvas}function Ii(e){e.destroy()}t(Ir,"onHover"),t(Dr,"onHoverUpdate"),t(Cr,"onHoverEnd"),t(kr,"setGravity"),t(Ur,"getGravity"),t(Nr,"setBackground"),t(Lr,"getBackground"),t(Or,"pos"),t(Gr,"scale"),t(qr,"rotate"),t(Hr,"color"),t(Kr,"toFixed"),t(Yr,"opacity"),t(jr,"anchor"),t(Qr,"z"),t(zr,"follow"),t(Jr,"move"),t(Xr,"offscreen"),t(Wr,"isFixed"),t(Zr,"area"),t(_r,"getRenderProps"),t($r,"sprite"),t(ei,"text"),t(ti,"polygon"),t(ri,"rect"),t(ii,"uvquad"),t(ni,"circle"),t(si,"outline"),t(oi,"timer"),t(ai,"body"),t(hi,"doubleJump"),t(li,"shader"),t(ui,"fixed"),t(di,"stay"),t(ci,"health"),t(fi,"lifespan"),t(pi,"state"),t(gi,"fadeIn"),t(mi,"mask"),t(wi,"drawon"),t(Ai,"onLoad"),t(Vi,"scene"),t(vi,"go"),t(yi,"onSceneLeave"),t(xi,"getData"),t(Ei,"setData"),t(Si,"plug"),t(bi,"center"),(Ri=Br||={})[Ri.None=0]="None",Ri[Ri.Left=1]="Left",Ri[Ri.Top=2]="Top",Ri[Ri.LeftTop=3]="LeftTop",Ri[Ri.Right=4]="Right",Ri[Ri.Horizontal=5]="Horizontal",Ri[Ri.RightTop=6]="RightTop",Ri[Ri.HorizontalTop=7]="HorizontalTop",Ri[Ri.Bottom=8]="Bottom",Ri[Ri.LeftBottom=9]="LeftBottom",Ri[Ri.Vertical=10]="Vertical",Ri[Ri.LeftVertical=11]="LeftVertical",Ri[Ri.RightBottom=12]="RightBottom",Ri[Ri.HorizontalBottom=13]="HorizontalBottom",Ri[Ri.RightVertical=14]="RightVertical",Ri[Ri.All=15]="All",t(Mi,"tile"),t(Pi,"addLevel"),t(Ti,"agent"),t(Bi,"record"),t(Fi,"isFocused"),t(Ii,"destroy");let Di=me.root.add.bind(me.root),Ci=me.root.readd.bind(me.root),ki=me.root.removeAll.bind(me.root),Ui=me.root.get.bind(me.root),Ni=me.root.wait.bind(me.root),Li=me.root.loop.bind(me.root),Oi=me.root.tween.bind(me.root);function Gi(e=2,t=1){let r=0;return{require:["scale"],update(){let i=Math.sin(r*e)*t;i<0&&this.destroy(),this.scale=u(i),r+=cr()}}}t(Gi,"boom");let qi=Oe(null,"data:image/png;base64,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"),Hi=Oe(null,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOcAAACDCAYAAAB2kQxsAAAAAXNSR0IArs4c6QAABqxJREFUeJztnU1yFDkQRtMEB+AG7Fk6fBPO6ZsQLGc/N5gbMAtosJvqKv2kpPxS763A0W5XSXqVqZ+SngzgF58/fflx/7N///vnacW1gBkFD2Z2LOYNBF3Dx9UXAGs5kxLWwhNxU2qlJHrOhwLfkNZoiaBzIa3dCFJYLXgSboKXmETPeVDQyamR8vX55fe/v37/9vBzCDoH0tqktEpZ+t0IOh4KOBm16euZmETPtVDAiRgRLRF0HRRuEkrFrE1hzR4Lipxj+bD6AqCPz5++/Bgp5tXfdv1CeAdPPmFmSkn0nE+a0drdFm6XiOkdKWEuKRptTXqlLuqqFNaM6Dkb+T5nbb+npo8WjZVinqFantFJk9bWojaRThq7HzKN8wiPJ7aCoJHEZN5zHvJp7RE1DTV6SnZ1fa/PL1MjJtF5HmnT2tJF3GZ/BIj05I8ULUtR6ypER7ogjxpw61rRGxEal4KYjNyORzatbUlHSxr06tFcBTHPiN5NUEJWzlZKG/aKRqYk5tl1IKgPafucZ7w+vxSluLP6olHnL6MQQfYV6bpk/+BRZXm+cXHEiApSipZHlE6tRBDMkxmyysl5VsmtjXiFoJmiZU35ZWK0oNv1OY+omSv0GDDKJCaMI42cHg25dvFCi6QZxVS6ViVSpLUz38A4oiS9ySjlW2althGWKZrN6XNuOVpbwq0ReIzqZhfTrHwE/PZZuEYqcnqO0tZQGxVqRylprLGIEDXNkLOKEakbYsYiiphmiQaEZuD9BghixiKSmGYJIueqBt4TRZEyHtHENCNyNtMaRREzHhHFNBOKnKv7myVcVXKka4WfRBXTjMjpypl8iBmP6MsOmed0Bgk1UHjxXlpORIAWIqeybyGtha1QEdNMRM5s7wLCGpTENBORE6AXNTHNkBM2QFFMM4F5ToX5TYiLqphmRE7YmMhimiEnJEb9XBdJOUlp4Qp1Mc1E5QQ4I/qyvFJCy8n8JnijEjXNAi3fQ0TwIEM6e2OqnAgII8kkptkgOZEQZlN6BquZjqhVFxlBOkZq4Z6WASAFQQ8jZwQJ70FK8CTiaeb3fDSLJyMiwiwiS/q0SkwEBE+85jYjSTpcTiSE2WQRtVlOpAMVemVdtjXmlZxICFlQk/TJjHcmYS96JJ0p6KmcZggKeWmVdPopYwgKuxJVUuQE+EU0Sd99KYICxJH0ry9DUIA/rFy3WyWnGYLCnqyQ9PCXERTgmJmSPvwlBAU4p1bUWklPP1yytA9JYWdGRtLLDyEowDUjomiRwQgKUIZnJC3OgREUoByPSDpkDyEkBfhJj6RNQ7xEUYA6aiS9Cdo8SUoUBaijVtCuFQwICtBGiajdawARFKCNK0HdVtEjKUAd0+Q0q9v/FklhJ1rmP4e8JEoUBejfq2jYNgtEUdgJzwN7u6dSSkBQyMSME7O7FyHUQpoLCqw8rv5o+d6Uw3NvfzjagUkAZvOlLH1lLMyx8wCzWBEhW3ZDmLZ7NTsrwCpmyui5A1+IPidigjcjhZy14/vytBYxwRsPMVcf/2c2QU72wQUVIgj5lqFyIiZEJ5qQb1me1gLMJLKM93wY9cVETYiGkphmg+RETFhJljY2LHICQB/uchI1AXxwlRMxAfwgrYVtUHvxwk1OoiaAL8MjJ2ICtOEip1q6APnJEBS6VwiRzp4vtM5YBvf3m/EeI8DyvUZK33z4+v1bqsZ7dN+3n2W6zwgMO44hY0X1vIqkXh419x7lXh9ds8oyviFyRqmcXrxf2FUtF89ymFkG6nI2p7WZB4FGvUWfLcVt4ahsdy+TR7ifz6lc0F5v0GfalmXldpE3esrr6PrTR84sjNjS4kpQhQhaUi4lD6KR1xK9DHupfoKoR02vSFDy9FWNoKVivv1/lG7OfZkqR043OZUbWgmtFaomaGl51ZTHCnFv5bqNnFGjZvRtEFUEHSHmI1ZHWgVBXZ5+sxvX7ANlPChpjKsknSllKaPlRU4nZo0Yjq6wiIJGFPMML2mj3M8ZRRe4QkzF6FhCJEFbBn4i0iKswn11yenZiLLKeMRqQdWiZSmlkqrcV9d0gPfksAcqBW+2ZqAoq5gZGSrnTtGwlVmCIqUepxWxerj7iIyNZ7SgiKmJhJw7NJpRgiKmLuHl3KnReA4UIaU+y+WkcbzHQ1DEzMGQ9aJH0BDK6RE0y9wlTDp2HuppERQxc0FFBaZGUMTMB5UlQG/fHyk1odJEaBUUMXWh4oSoFRQxtaHyxMi2uBseQwUKciUoYuaAShTlkaCImQcqUph7QREzF/8DSS/2GZ2/N/sAAAAASUVORK5CYII=");function Ki(e,t={}){let r=Di([Or(e),di()]),i=5*(t.speed||1),n=t.scale||1;r.add([$r(Hi),Gr(0),jr("center"),Gi(i,n),...t.comps??[]]);let s=r.add([$r(qi),Gr(0),jr("center"),oi(),...t.comps??[]]);return s.wait(.4/i,(()=>s.use(Gi(i,n)))),s.onDestroy((()=>r.destroy())),r}function Yi(){me.root.update()}t(Ki,"addKaboom"),t(Yi,"updateFrame");class ji{static{t(this,"Collision")}source;target;displacement;resolved=!1;constructor(e,t,r,i=!1){this.source=e,this.target=t,this.displacement=r,this.resolved=i}reverse(){return new ji(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}}function Qi(){let r={},i=e.hashGridSize||64,n=new m,s=[];function o(e){if(s.push(n.clone()),e.pos&&n.translate(e.pos),e.scale&&n.scale(e.scale),e.angle&&n.rotate(e.angle),e.transform=n.clone(),e.c("area")&&!e.paused){let t=e,n=t.worldArea().bbox(),s=Math.floor(n.pos.x/i),o=Math.floor(n.pos.y/i),a=Math.ceil((n.pos.x+n.width)/i),h=Math.ceil((n.pos.y+n.height)/i),l=new Set;for(let e=s;e<=a;e++)for(let i=o;i<=h;i++)if(r[e])if(r[e][i]){let n=r[e][i];e:for(let e of n){if(e.paused||!e.exists()||l.has(e.id))continue;for(let r of t.collisionIgnore)if(e.is(r))continue e;for(let r of e.collisionIgnore)if(t.is(r))continue e;let r=q(t.worldArea(),e.worldArea());if(r){let i=new ji(t,e,r);t.trigger("collideUpdate",e,i);let n=i.reverse();n.resolved=i.resolved,e.trigger("collideUpdate",t,n)}l.add(e.id)}n.push(t)}else r[e][i]=[t];else r[e]={},r[e][i]=[t]}e.children.forEach(o),n=s.pop()}t(o,"checkObj"),o(me.root)}function zi(){let e=me.cam,t=l.fromAngle(x(0,360)).scale(e.shake);e.shake=o(e.shake,0,5*cr()),e.transform=(new m).translate(bi()).scale(e.scale).rotate(e.angle).translate((e.pos??bi()).scale(-1).add(t)),me.root.draw(),bt()}function Ji(){let e=Ae();me.events.numListeners("loading")>0?me.events.trigger("loading",e):Zt((()=>{let t=sr()/2,r=u(sr()/2,or()/2).sub(u(t/2,12));Gt({pos:u(0),width:sr(),height:or(),color:c(0,0,0)}),Gt({pos:r,width:t,height:24,fill:!1,outline:{width:4}}),Gt({pos:r,width:t*e,height:24})}))}function Xi(e,t){Zt((()=>{let r=u(8);Ct(),Ft(e);let i=rr({text:t,font:ze,size:16,pos:r,color:c(255,255,255),fixed:!0}),n=i.width+2*r.x,s=i.height+2*r.x;e.x+n>=sr()&&Ft(u(-n,0)),e.y+s>=or()&&Ft(u(0,-s)),Gt({width:n,height:s,color:c(0,0,0),radius:4,opacity:.8,fixed:!0}),nr(i),kt()}))}function Wi(){if(dr.inspect){let e=null;for(let t of me.root.get("*",{recursive:!0}))if(t.c("area")&&t.isHovering()){e=t;break}if(me.root.drawInspect(),e){let t=[],r=e.inspect();for(let e in r)r[e]?t.push(`${e}: ${r[e]}`):t.push(`${e}`);Xi(hr(lr()),t.join("\n"))}Xi(u(8),`FPS: ${dr.fps()}`)}dr.paused&&Zt((()=>{Ct(),Ft(sr(),0),Ft(-8,8),Gt({width:32,height:32,anchor:"topright",color:c(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=1;e<=2;e++)Gt({width:4,height:19.2,anchor:"center",pos:u(-32/3*e,16),color:c(255,255,255),radius:2,fixed:!0});kt()})),1!==dr.timeScale&&Zt((()=>{Ct(),Ft(sr(),or()),Ft(-8,-8);let e=rr({text:dr.timeScale.toFixed(1),font:ze,size:16,color:c(255,255,255),pos:u(-8),anchor:"botright",fixed:!0});Gt({width:e.width+16+32,height:e.height+16,anchor:"botright",color:c(0,0,0),opacity:.8,radius:4,fixed:!0});for(let t=0;t<2;t++){let r=dr.timeScale<1;Kt({p1:u(-e.width-8*(r?2:3.5),-8),p2:u(-e.width-8*(r?2:3.5),-8-e.height),p3:u(-e.width-8*(r?3.5:2),-8-e.height/2),pos:u(8*-t*1+(r?-4:0),0),color:c(255,255,255),fixed:!0})}nr(e),kt()})),dr.curRecording&&Zt((()=>{Ct(),Ft(0,or()),Ft(24,-24),Yt({radius:12,color:c(255,0,0),opacity:w(0,1,4*se.time()),fixed:!0}),kt()})),dr.showLog&&me.logs.length>0&&Zt((()=>{Ct(),Ft(0,or()),Ft(8,-8);let t=[];for(let e of me.logs){let r="",i=e.msg instanceof Error?"error":"info";r+=`[time]${e.time.toFixed(2)}[/time]`,r+=" ",r+=`[${i}]${e.msg?.toString?e.msg.toString():e.msg}[/${i}]`,t.push(r)}me.logs=me.logs.filter((t=>se.time()-t.time<(e.logTime||4)));let r=rr({text:t.join("\n"),font:ze,pos:u(8,-8),anchor:"botleft",size:16,width:.6*sr(),lineSpacing:4,fixed:!0,styles:{time:{color:c(127,127,127)},info:{color:c(255,255,255)},error:{color:c(255,0,127)}}});Gt({width:r.width+16,height:r.height+16,anchor:"botleft",color:c(0,0,0),radius:4,opacity:.8,fixed:!0}),nr(r),kt()}))}function Zi(e){me.events.on("loading",e)}function _i(e){se.onResize(e)}function $i(e){me.events.on("error",e)}function en(e){console.error(e),fe.ctx.suspend(),se.run((()=>{Rt(),Zt((()=>{let t=sr(),r=or(),i={size:36,width:t-64,letterSpacing:4,lineSpacing:4,font:ze,fixed:!0};Gt({width:t,height:r,color:c(0,0,255),fixed:!0});let n=rr({...i,text:"Error",pos:u(32),color:c(255,128,0),fixed:!0});nr(n),ir({...i,text:e.message,pos:u(32,32+n.height+16),fixed:!0}),kt(),me.events.trigger("error",e)})),Pt()}))}function tn(e){ae.push(e)}function rn(){me.events.onOnce("frameEnd",(()=>{se.quit(),he.clear(he.COLOR_BUFFER_BIT|he.DEPTH_BUFFER_BIT|he.STENCIL_BUFFER_BIT);let e=he.getParameter(he.MAX_TEXTURE_IMAGE_UNITS);for(let t=0;t<e;t++)he.activeTexture(he.TEXTURE0+t),he.bindTexture(he.TEXTURE_2D,null),he.bindTexture(he.TEXTURE_CUBE_MAP,null);he.bindBuffer(he.ARRAY_BUFFER,null),he.bindBuffer(he.ELEMENT_ARRAY_BUFFER,null),he.bindRenderbuffer(he.RENDERBUFFER,null),he.bindFramebuffer(he.FRAMEBUFFER,null),le.destroy(),ae.forEach((e=>e()))}))}t(Qi,"checkFrame"),t(zi,"drawFrame"),t(Ji,"drawLoadScreen"),t(Xi,"drawInspectText"),t(Wi,"drawDebug"),t(Zi,"onLoading"),t(_i,"onResize"),t($i,"onError"),t(en,"handleErr"),t(tn,"onCleanup"),t(rn,"quit");let nn=!0;function sn(){let t=O,r=he.drawingBufferWidth/t,i=he.drawingBufferHeight/t;if(e.letterbox){if(!e.width||!e.height)throw new Error("Letterboxing requires width and height defined.");let t=r/i,n=e.width/e.height;if(t>n){let e=i*n,t=(r-e)/2;ue.viewport={x:t,y:0,width:e,height:i}}else{let e=r/n,t=(i-e)/2;ue.viewport={x:0,y:t,width:r,height:e}}}else{if(e.stretch&&(!e.width||!e.height))throw new Error("Stretching requires width and height defined.");ue.viewport={x:0,y:0,width:r,height:i}}}function on(){se.onHide((()=>{e.backgroundAudio||fe.ctx.suspend()})),se.onShow((()=>{!e.backgroundAudio&&!dr.paused&&fe.ctx.resume()})),se.onResize((()=>{if(se.isFullscreen())return;let t=e.width&&e.height;t&&!e.stretch&&!e.letterbox||(A.width=A.offsetWidth*O,A.height=A.offsetHeight*O,sn(),t||(ue.frameBuffer.free(),ue.frameBuffer=new be(le,he.drawingBufferWidth,he.drawingBufferHeight),ue.width=he.drawingBufferWidth/O,ue.height=he.drawingBufferHeight/O))})),!1!==e.debug&&(se.onKeyPress("f1",(()=>dr.inspect=!dr.inspect)),se.onKeyPress("f2",(()=>dr.clearLog())),se.onKeyPress("f8",(()=>dr.paused=!dr.paused)),se.onKeyPress("f7",(()=>{dr.timeScale=Kr(s(dr.timeScale-.2,0,2),1)})),se.onKeyPress("f9",(()=>{dr.timeScale=Kr(s(dr.timeScale+.2,0,2),1)})),se.onKeyPress("f10",(()=>dr.stepFrame()))),e.burp&&se.onKeyPress("b",(()=>vt()))}se.run((()=>{try{pe.loaded||1===Ae()&&!nn&&(pe.loaded=!0,me.events.trigger("load")),!pe.loaded&&!1!==e.loadingScreen||nn?(Rt(),Ji(),Pt()):(dr.paused||Yi(),Qi(),Rt(),zi(),!1!==e.debug&&Wi(),Pt()),nn&&(nn=!1),me.events.trigger("frameEnd")}catch(e){en(e)}})),t(sn,"updateViewport"),t(on,"initEvents"),sn(),on();let an={VERSION:"3000.1.17",loadRoot:Ve,loadProgress:Ae,loadSprite:Oe,loadSpriteAtlas:Ne,loadSound:ot,loadBitmapFont:Pe,loadFont:xe,loadShader:nt,loadShaderURL:st,loadAseprite:qe,loadPedit:Ge,loadBean:at,loadJSON:ve,load:we,getSprite:ht,getSound:lt,getFont:ut,getBitmapFont:dt,getShader:ct,getAsset:ft,Asset:Be,SpriteData:de,SoundData:ce,width:sr,height:or,center:bi,dt:cr,time:se.time,screenshot:se.screenshot,record:Bi,isFocused:Fi,setCursor:se.setCursor,getCursor:se.getCursor,setCursorLocked:se.setCursorLocked,isCursorLocked:se.isCursorLocked,setFullscreen:se.setFullscreen,isFullscreen:se.isFullscreen,isTouchscreen:se.isTouchscreen,onLoad:Ai,onLoading:Zi,onResize:_i,onGamepadConnect:se.onGamepadConnect,onGamepadDisconnect:se.onGamepadDisconnect,onError:$i,onCleanup:tn,camPos:fr,camScale:pr,camRot:gr,shake:mr,toScreen:wr,toWorld:Ar,setGravity:kr,getGravity:Ur,setBackground:Nr,getBackground:Lr,getGamepads:se.getGamepads,add:Di,make:vr,destroy:Ii,destroyAll:ki,get:Ui,readd:Ci,pos:Or,scale:Gr,rotate:qr,color:Hr,opacity:Yr,anchor:jr,area:Zr,sprite:$r,text:ei,polygon:ti,rect:ri,circle:ni,uvquad:ii,outline:si,body:ai,doubleJump:hi,shader:li,timer:oi,fixed:ui,stay:di,health:ci,lifespan:fi,z:Qr,move:Jr,offscreen:Xr,follow:zr,state:pi,fadeIn:gi,mask:mi,drawon:wi,tile:Mi,agent:Ti,on:yr,onUpdate:xr,onDraw:Er,onAdd:Sr,onDestroy:br,onClick:Fr,onCollide:Rr,onCollideUpdate:Mr,onCollideEnd:Pr,onHover:Ir,onHoverUpdate:Dr,onHoverEnd:Cr,onKeyDown:se.onKeyDown,onKeyPress:se.onKeyPress,onKeyPressRepeat:se.onKeyPressRepeat,onKeyRelease:se.onKeyRelease,onMouseDown:se.onMouseDown,onMousePress:se.onMousePress,onMouseRelease:se.onMouseRelease,onMouseMove:se.onMouseMove,onCharInput:se.onCharInput,onTouchStart:se.onTouchStart,onTouchMove:se.onTouchMove,onTouchEnd:se.onTouchEnd,onScroll:se.onScroll,onHide:se.onHide,onShow:se.onShow,onGamepadButtonDown:se.onGamepadButtonDown,onGamepadButtonPress:se.onGamepadButtonPress,onGamepadButtonRelease:se.onGamepadButtonRelease,onGamepadStick:se.onGamepadStick,mousePos:lr,mouseDeltaPos:se.mouseDeltaPos,isKeyDown:se.isKeyDown,isKeyPressed:se.isKeyPressed,isKeyPressedRepeat:se.isKeyPressedRepeat,isKeyReleased:se.isKeyReleased,isMouseDown:se.isMouseDown,isMousePressed:se.isMousePressed,isMouseReleased:se.isMouseReleased,isMouseMoved:se.isMouseMoved,isGamepadButtonPressed:se.isGamepadButtonPressed,isGamepadButtonDown:se.isGamepadButtonDown,isGamepadButtonReleased:se.isGamepadButtonReleased,getGamepadStick:se.getGamepadStick,charInputted:se.charInputted,loop:Li,wait:Ni,play:Vt,volume:At,burp:vt,audioCtx:fe.ctx,Line:U,Rect:N,Circle:L,Polygon:G,Vec2:l,Color:d,Mat4:m,Quad:p,RNG:V,rand:x,randi:E,randSeed:y,vec2:u,rgb:c,hsl2rgb:f,quad:g,choose:b,chance:S,lerp:o,tween:Oi,easings:He,map:a,mapc:h,wave:w,deg2rad:i,rad2deg:n,clamp:s,testLineLine:P,testRectRect:R,testRectLine:T,testRectPoint:B,testCirclePolygon:C,testLinePoint:F,testLineCircle:I,drawSprite:Lt,drawText:ir,formatText:rr,drawRect:Gt,drawLine:qt,drawLines:Ht,drawTriangle:Kt,drawCircle:Yt,drawEllipse:jt,drawUVQuad:Ut,drawPolygon:Qt,drawFormattedText:nr,drawMasked:Jt,drawSubtracted:Xt,pushTransform:Ct,popTransform:kt,pushTranslate:Ft,pushScale:It,pushRotate:Dt,pushMatrix:Bt,usePostEffect:Mt,makeCanvas:yt,debug:dr,scene:Vi,go:vi,onSceneLeave:yi,addLevel:Pi,getData:xi,setData:Ei,download:X,downloadJSON:Z,downloadText:W,downloadBlob:_,plug:Si,ASCII_CHARS:je,canvas:se.canvas,addKaboom:Ki,LEFT:l.LEFT,RIGHT:l.RIGHT,UP:l.UP,DOWN:l.DOWN,RED:d.RED,GREEN:d.GREEN,BLUE:d.BLUE,YELLOW:d.YELLOW,MAGENTA:d.MAGENTA,CYAN:d.CYAN,WHITE:d.WHITE,BLACK:d.BLACK,quit:rn,Event:Y,EventHandler:j,EventController:K};if(e.plugins&&e.plugins.forEach(Si),!1!==e.global)for(let e in an)window[e]=an[e];return!1!==e.focus&&se.canvas.focus(),an}),"default")({width:960,height:540,canvas:document.querySelector("#game")})})();
//# sourceMappingURL=bundle.js.map